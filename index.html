<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>H-Sound</title>
    <!-- Manifest sadece HTTP/HTTPS'de yükle -->
    <script>
        if (location.protocol === 'http:' || location.protocol === 'https:') {
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = 'manifest.json';
            document.head.appendChild(manifestLink);
        }
    </script>
    <!-- ERKEN GİRİŞ KONTROLÜ - Sayfa yüklenmeden önce -->
    <script>
        (function() {
            var isLoggedIn = localStorage.getItem('h_sound_logged_in') === 'true';
            var username = localStorage.getItem('h_sound_username');
            if (isLoggedIn && username) {
                // Giriş yapılmış - CSS ile login ekranını gizle
                document.documentElement.setAttribute('data-logged-in', 'true');
            }
        })();
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3498DB;
            --primary-hover-color: #5DADE2;
            --background-color: #1A1A1A;
            --sidebar-background-color: #0D0D0D;
            --content-background-color: #1A1A1A;
            --text-color: #ffffff;
            --secondary-text-color: #A9A9A9;
            --border-color: #2C2C2C;
        }

        /* Hidden class - Elementleri gizle */
        .hidden {
            display: none !important;
        }
        
        /* Erken giriş kontrolü - Sayfa yüklenirken flash'ı önle */
        html[data-logged-in="true"] #login-screen {
            display: none !important;
        }
        
        html[data-logged-in="true"] #main-app {
            display: flex !important;
        }

        /* Main App Container */
        .main-app {
            display: flex;
            width: 100% !important;
            height: 100%;
            max-width: 100vw;
        }
        
        .main-app.hidden {
            display: none !important;
        }

        html {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            width: 100%;
            min-height: 100vh;
        }

        /* PC için Body optimizasyonu */
        @media (min-width: 1200px) {
            body {
                overflow-x: hidden; /* PC'de horizontal scroll'u engelle */
            }
        }

        #app-container {
            display: block;
            height: calc(100vh - 80px);
            box-sizing: border-box;
            width: 100% !important;
            max-width: 100vw !important;
            position: relative;
            overflow: hidden;
        }

        /* Sidebar */
        #sidebar {
            width: 230px;
            background-color: var(--sidebar-background-color);
            padding: 24px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease-in-out;
            flex-shrink: 0;
            z-index: 100;
        }

        #sidebar ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }

        #sidebar a {
            color: var(--secondary-text-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 6px;
            transition: background-color 0.2s, color 0.2s;
        }

        #sidebar a:hover,
        #sidebar a.active {
            background-color: #1C1C1C;
            color: var(--text-color);
        }

        #sidebar a i {
            margin-right: 12px;
            font-size: 18px;
        }

        .brand {
            color: var(--primary-color);
            text-align: center;
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 700;
        }

        /* Main Content */
        #main-content {
            flex: 1 1 auto !important;
            padding: 24px;
            overflow-y: auto;
            overflow-x: hidden;
            background-color: var(--content-background-color);
            width: 0; /* flex ile genişlik otomatik */
            min-width: 0;
            max-width: 100%;
        }

        /* PC ve Büyük Ekranlar için Layout İyileştirmeleri */
        @media (min-width: 1200px) {
            body {
                overflow: hidden;
            }
            
            #app-container {
                width: 100% !important;
                max-width: 100vw !important;
                height: calc(100vh - 90px);
                overflow: hidden;
            }
            
            .main-app {
                display: flex !important;
                width: 100% !important;
                height: 100%;
            }
            
            .main-app.hidden {
                display: none !important;
            }

            #sidebar {
                width: 280px;
                padding: 30px;
                flex-shrink: 0;
            }

            #main-content {
                padding: 40px;
                flex: 1 1 auto !important;
                min-width: 0;
                width: 0; /* flex ile genişlik otomatik */
                overflow-y: auto;
                overflow-x: hidden;
            }

            .content-area {
                width: 100%;
                max-width: 100%;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 25px;
            }

            .content-header {
                font-size: 28px;
                margin-bottom: 30px;
            }

            .search-container {
                margin-bottom: 40px;
            }

            #search-bar {
                padding: 15px 20px;
                font-size: 16px;
            }

            .search-btn {
                padding: 15px 30px;
                font-size: 16px;
            }
        }

        .menu-toggle-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            cursor: pointer;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
        }

        /* Search Container */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        #search-bar {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: #2C2C2C;
            color: var(--text-color);
            outline: none;
            transition: border-color 0.2s;
        }

        #search-bar::placeholder {
            color: var(--secondary-text-color);
        }

        #search-bar:focus {
            border-color: var(--primary-color);
        }

        .search-btn {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: #ffffff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-btn:hover {
            background-color: var(--primary-hover-color);
        }

        /* Content Area */
        .content-area {
            min-height: 500px;
            width: 100% !important;
            box-sizing: border-box;
        }

        .content-header {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Song Cards */
        .result-item {
            background-color: #1C1C1C;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
            position: relative;
            cursor: pointer;
        }

        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
        }

        .result-item img {
            width: 100%;
            height: auto;
            display: block;
            aspect-ratio: 16 / 9;
            object-fit: cover;
        }

        .item-title {
            padding: 10px;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            height: 44px;
            line-height: 1.5;
            font-weight: 600;
            text-align: left;
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background-color: #331f1f;
            border: 1px solid #722f2f;
            padding: 25px;
            border-radius: 8px;
            margin-top: 50px;
            text-align: center;
        }

        .error-message h2 {
            color: #E74C3C;
            margin-top: 0;
        }

        .no-content-message {
            text-align: center;
            margin-top: 50px;
            font-size: 16px;
            color: var(--secondary-text-color);
        }

        /* Player Footer */
        .player-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background-color: #111111;
            border-top: 1px solid #2C2C2C;
            z-index: 1000;
            padding: 0 20px;
            box-sizing: border-box;
        }

        /* PC için Player Footer İyileştirmeleri */
        @media (min-width: 1200px) {
            .player-footer {
                padding: 0 40px;
                height: 90px;
            }

            .player-content {
                width: 100%;
                margin: 0 auto;
                padding: 0 20px;
            }

            .song-info {
                width: 35%;
            }

            .progress-container {
                width: 40%;
            }

            .control-btn {
                font-size: 20px;
                padding: 12px;
            }

            #play-pause-btn {
                font-size: 28px;
            }
        }

        .player-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            width: 100%;
            margin: 0 auto;
        }

        /* PC için Player Content genişletme */
        @media (min-width: 1200px) {
            .player-content {
                width: 100%;
            }
        }

        .song-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            width: 30%;
        }

        .song-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            object-fit: cover;
        }

        .text-info {
            overflow: hidden;
        }

        .song-title {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-artist {
            font-size: 12px;
            color: var(--secondary-text-color);
        }

        .player-controls {
            display: flex;
            gap: 15px;
            flex: 1;
            justify-content: center;
            align-items: center;
        }

        .control-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: color 0.2s, background-color 0.2s;
        }

        .control-btn:hover {
            color: var(--primary-color);
            background-color: #2C2C2C;
        }

        .control-btn.active {
            color: var(--primary-color);
            background-color: rgba(52, 152, 219, 0.2);
        }

        #play-pause-btn {
            font-size: 24px;
            color: var(--primary-color);
        }

        #playback-mode-btn.sequential {
            color: #3498db; /* Mavi - Sırayla */
        }

        #playback-mode-btn.shuffle {
            color: #f39c12; /* Turuncu - Karışık */
        }

        #playback-mode-btn.repeat-one {
            color: #e74c3c; /* Kırmızı - Tek Tekrar */
        }

        #playback-mode-btn.repeat-all {
            color: #9b59b6; /* Mor - Tümünü Tekrar */
        }

        .progress-container {
            flex: 1;
            width: 30%;
            display: flex;
            align-items: center;
            height: 100%;
            gap: 10px;
        }

        .progress-time {
            font-size: 12px;
            color: var(--secondary-text-color);
            min-width: 35px;
            text-align: center;
        }

        .progress-bar-bg {
            flex-grow: 1;
            height: 4px;
            background-color: #535353;
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-bar-fg {
            height: 100%;
            width: 0%;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1500;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            #app-container {
                height: calc(100vh - 90px);
                overflow: hidden;
            }

            #sidebar {
                position: fixed;
                height: 100%;
                z-index: 1600;
                transform: translateX(-100%);
                width: 250px;
            }

            #sidebar.open {
                transform: translateX(0);
            }

            /* Ensure super admin link is visible on mobile */
            #superadmin-link {
                display: block !important;
            }

            #superadmin-link.hidden {
                display: none !important;
            }

            .menu-toggle-btn {
                display: block;
                top: 15px;
                left: 15px;
                background-color: rgba(0, 0, 0, 0.5);
                padding: 5px 10px;
                border-radius: 4px;
                z-index: 1001;
            }

            #main-content {
                padding: 60px 15px 15px 15px;
                width: 100%;
                overflow-y: auto;
                overflow-x: hidden;
            }

            .player-footer {
                height: 80px;
            }

            .player-content {
                flex-wrap: nowrap;
                padding: 15px;
                align-items: center;
                justify-content: space-between;
                gap: 15px;
            }

            .song-info {
                margin-top: 0;
                width: 45%;
                flex: 0 0 45%;
                gap: 10px;
                min-width: 0;
            }

            .song-thumbnail {
                width: 55px;
                height: 55px;
                border-radius: 8px;
            }

            .song-title {
                font-size: 12px;
            }

            .song-artist {
                font-size: 11px;
            }

            .player-controls {
                margin-top: 0;
                flex: 0 0 auto;
                justify-content: flex-end;
                gap: 8px;
                display: flex !important;
            }

            .control-btn {
                font-size: 18px;
                padding: 8px;
                display: inline-flex !important;
                align-items: center;
                justify-content: center;
            }

            #play-pause-btn {
                font-size: 22px;
            }

            .progress-container {
                display: none !important;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 15px;
                width: 100%;
            }

            .item-title {
                font-size: 13px;
                padding: 8px;
            }

            .content-header {
                font-size: 20px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .search-container {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .search-btn {
                width: 100%;
            }

            .content-area {
                width: 100%;
            }
        }

        /* SOSYAL ÖZELLİKLER CSS */
        
        /* Modal Stilleri */
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background: linear-gradient(135deg, #1C1C1C 0%, #2C2C2C 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            min-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: modalSlideIn 0.3s ease-out;
            position: relative;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .modal-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Form Stilleri */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: #2C2C2C;
            color: var(--text-color);
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-input::placeholder {
            color: var(--secondary-text-color);
        }

        /* Buton Stilleri */
        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6C757D 0%, #5A6268 100%);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        /* Arkadaş Listesi */
        .friends-container {
            padding: 20px;
        }

        .friend-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: linear-gradient(135deg, #2C2C2C 0%, #1C1C1C 100%);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .friend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: var(--primary-color);
        }

        .friend-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .friend-status {
            display: flex;
            flex-direction: column;
        }

        .friend-name {
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
        }

        .friend-activity {
            font-size: 12px;
            color: var(--secondary-text-color);
            margin-top: 2px;
        }

        .friend-actions {
            display: flex;
            gap: 10px;
        }

        .friend-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .chat-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .chat-btn:hover {
            background-color: var(--primary-hover-color);
            transform: scale(1.05);
        }

        .remove-btn {
            background-color: #E74C3C;
            color: white;
        }

        .remove-btn:hover {
            background-color: #C0392B;
            transform: scale(1.05);
        }

        /* Mesajlaşma */
        .chat-modal-content {
            width: 90%;
            min-width: 500px;
            height: 70vh;
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
            border-radius: 12px 12px 0 0;
        }

        .chat-header h3 {
            color: white;
            margin: 0;
            font-size: 18px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: #1A1A1A;
        }

        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            animation: messageSlideIn 0.3s ease-out;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
            color: white;
        }

        .message.received {
            align-self: flex-start;
            background: linear-gradient(135deg, #2C2C2C 0%, #3C3C3C 100%);
            color: var(--text-color);
        }

        .message.music {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid #E67E22;
        }

        .message.music:hover {
            transform: scale(1.02);
        }

        .message-time {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* Mesaj silme butonları */
        .message-container {
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }

        .message-actions {
            display: none;
            flex-direction: column;
            gap: 5px;
        }

        .message-container:hover .message-actions {
            display: flex;
        }

        .message-delete-btn {
            background: rgba(231, 76, 60, 0.8);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .message-delete-btn:hover {
            background: rgba(231, 76, 60, 1);
            transform: scale(1.1);
        }

        .message-favorite-btn {
            background: rgba(241, 196, 15, 0.8);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .message-favorite-btn:hover {
            background: rgba(241, 196, 15, 1);
            transform: scale(1.1);
        }

        .message-favorite-btn.favorited {
            background: rgba(241, 196, 15, 1);
        }

        .message.favorited {
            border-left: 4px solid #F1C40F;
            box-shadow: 0 2px 8px rgba(241, 196, 15, 0.3);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
            background-color: #1C1C1C;
            border-radius: 0 0 12px 12px;
        }

        .chat-input-container input {
            flex: 1;
        }

        /* İndirme ve Playlist Butonları */
        .add-to-playlist-btn,
        .download-song-btn {
            position: absolute;
            top: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-10px);
        }

        .add-to-playlist-btn {
            right: 10px;
        }

        .download-song-btn {
            right: 10px;
            top: 50px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
        }

        .result-item:hover .add-to-playlist-btn,
        .result-item:hover .download-song-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .add-to-playlist-btn:hover {
            background: rgba(52, 152, 219, 0.9);
            transform: scale(1.05);
        }

        .add-to-collaborative-btn {
            position: absolute;
            top: 50px;
            right: 10px;
            background: rgba(155, 89, 182, 0.8);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-10px);
        }

        .add-to-collaborative-btn:hover {
            background: rgba(155, 89, 182, 0.9);
            transform: scale(1.05);
        }

        .result-item:hover .add-to-collaborative-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .download-song-btn:hover {
            background: linear-gradient(135deg, var(--primary-hover-color) 0%, var(--primary-color) 100%);
            transform: scale(1.05);
        }

        /* İndirilenler Sayfası */
        .downloads-container {
            padding: 20px;
        }

        .download-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: linear-gradient(135deg, #2C2C2C 0%, #1C1C1C 100%);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .download-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: var(--primary-color);
        }

        .download-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .download-actions {
            display: flex;
            gap: 10px;
        }

        .download-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: var(--primary-color);
            color: white;
        }

        .download-btn:hover {
            background-color: var(--primary-hover-color);
            transform: scale(1.05);
        }

        .delete-download-btn {
            background-color: #E74C3C;
        }

        .delete-download-btn:hover {
            background-color: #C0392B;
        }

        /* Özellikler Sayfası Geliştirmeleri */
        .features-grid .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border-color: var(--primary-color);
        }

        .feature-card .feature-icon {
            transition: all 0.3s ease;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.1);
            color: var(--primary-hover-color);
        }

        /* Responsive İyileştirmeler */
        @media (max-width: 768px) {
            .add-to-playlist-btn,
            .add-to-collaborative-btn,
            .download-song-btn {
                opacity: 1;
                transform: translateY(0);
                position: static;
                margin: 5px;
                display: inline-block;
                width: auto;
            }

            .result-item {
                position: relative;
                padding-bottom: 50px;
            }

            .download-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .download-info {
                width: 100%;
            }

            .download-actions {
                width: 100%;
                justify-content: center;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Ayarlar Sayfası */
        .settings-container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* PC için Settings Container genişletme */
        @media (min-width: 1200px) {
            .settings-container {
                max-width: 1200px;
                padding: 40px;
            }
        }

        .settings-sections {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .settings-section {
            background: linear-gradient(135deg, #2C2C2C 0%, #1C1C1C 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .settings-section:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .settings-section h3 {
            color: var(--primary-color);
            margin: 0 0 20px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .setting-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .setting-info {
            flex: 1;
        }

        .setting-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .setting-desc {
            font-size: 12px;
            color: var(--secondary-text-color);
        }

        .setting-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: var(--primary-color);
            color: white;
            min-width: 100px;
            justify-content: center;
        }

        .setting-btn:hover {
            background-color: var(--primary-hover-color);
            transform: scale(1.05);
        }

        .setting-btn.btn-warning {
            background-color: #F39C12;
        }

        .setting-btn.btn-warning:hover {
            background-color: #E67E22;
        }

        .setting-btn.btn-danger {
            background-color: #E74C3C;
        }

        .setting-btn.btn-danger:hover {
            background-color: #C0392B;
        }

        .danger-section {
            border-color: #E74C3C;
            background: linear-gradient(135deg, #2C1C1C 0%, #1C1C1C 100%);
        }

        .danger-section h3 {
            color: #E74C3C;
        }

        .app-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            padding: 10px 15px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
            font-size: 14px;
        }

        /* Responsive Ayarlar */
        @media (max-width: 768px) {
            .settings-container {
                padding: 15px;
            }

            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .setting-btn {
                width: 100%;
            }

            .app-info {
                grid-template-columns: 1fr;
            }
        }

        /* Animasyonlar */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .friend-item,
        .download-item,
        .feature-card {
            animation: fadeInUp 0.5s ease-out;
        }

        /* Bildirim Stilleri */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* YENİ BASİT GİRİŞ SİSTEMİ STİLLERİ */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1A1A1A 0%, #2C2C2C 50%, #1A1A1A 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            overflow-y: auto;
        }

        .simple-login-container {
            background: #2C2C2C;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            text-align: center;
            border: 2px solid var(--primary-color);
        }

        .login-brand {
            margin-bottom: 30px;
        }

        .login-brand i {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: block;
        }

        .login-brand h1 {
            color: var(--text-color);
            font-size: 36px;
            margin: 0 0 10px 0;
            font-weight: 700;
        }

        .login-brand p {
            color: var(--secondary-text-color);
            margin: 0;
            font-size: 16px;
        }

        .auth-section {
            margin-bottom: 20px;
        }

        .auth-section h2 {
            color: var(--text-color);
            font-size: 24px;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .simple-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .simple-input {
            padding: 18px 25px;
            border: 2px solid #444;
            border-radius: 12px;
            background: #1A1A1A;
            color: var(--text-color);
            font-size: 18px;
            transition: all 0.3s ease;
            outline: none;
            width: 100%;
            box-sizing: border-box;
        }

        .simple-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .simple-input::placeholder {
            color: var(--secondary-text-color);
        }

        .password-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-toggle {
            position: absolute;
            right: 20px;
            background: none;
            border: none;
            color: var(--secondary-text-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .password-toggle:hover {
            color: var(--primary-color);
            background: rgba(52, 152, 219, 0.1);
        }

        .password-toggle i {
            font-size: 18px;
        }

        .simple-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .simple-btn.primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
            color: white;
        }

        .simple-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .simple-btn.secondary {
            background: #444;
            color: var(--text-color);
        }

        .simple-btn.secondary:hover {
            background: #555;
        }

        .login-footer {
            margin-top: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .login-footer p {
            color: var(--secondary-text-color);
            margin: 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Responsive Tasarım */
        
        /* PC ve Büyük Ekranlar (1200px+) */
        @media (min-width: 1200px) {
            .simple-login-container {
                max-width: 550px;
                padding: 60px 50px;
            }

            .login-brand i {
                font-size: 80px;
            }

            .login-brand h1 {
                font-size: 48px;
            }

            .login-brand p {
                font-size: 20px;
            }

            .auth-section h2 {
                font-size: 32px;
                margin-bottom: 35px;
            }

            .simple-input {
                padding: 22px 30px;
                font-size: 20px;
            }

            .simple-btn {
                padding: 18px 30px;
                font-size: 18px;
            }

            .password-toggle {
                right: 25px;
                padding: 10px;
            }

            .password-toggle i {
                font-size: 20px;
            }
        }

        /* Tablet ve Orta Ekranlar (768px - 1199px) */
        @media (min-width: 768px) and (max-width: 1199px) {
            .simple-login-container {
                max-width: 500px;
                padding: 50px 40px;
            }

            .login-brand i {
                font-size: 70px;
            }

            .login-brand h1 {
                font-size: 42px;
            }

            .login-brand p {
                font-size: 18px;
            }

            .auth-section h2 {
                font-size: 28px;
                margin-bottom: 30px;
            }

            .simple-input {
                padding: 20px 28px;
                font-size: 19px;
            }

            .simple-btn {
                padding: 17px 28px;
                font-size: 17px;
            }

            .password-toggle {
                right: 23px;
                padding: 9px;
            }

            .password-toggle i {
                font-size: 19px;
            }
        }

        /* Mobil Cihazlar (768px altı) */
        @media (max-width: 767px) {
            .simple-login-container {
                padding: 30px 20px;
                margin: 20px;
                max-width: 380px;
            }

            .login-brand h1 {
                font-size: 28px;
            }

            .login-brand i {
                font-size: 50px;
            }

            .login-brand p {
                font-size: 14px;
            }

            .auth-section h2 {
                font-size: 22px;
                margin-bottom: 20px;
            }

            .simple-input {
                padding: 16px 20px;
                font-size: 16px;
            }

            .simple-btn {
                padding: 14px 20px;
                font-size: 15px;
            }

            .password-toggle {
                right: 18px;
                padding: 6px;
            }

            .password-toggle i {
                font-size: 16px;
            }
        }

        /* Çok Küçük Mobil Cihazlar (480px altı) */
        @media (max-width: 480px) {
            .simple-login-container {
                padding: 25px 15px;
                margin: 15px;
                max-width: 320px;
            }

            .login-brand h1 {
                font-size: 24px;
            }

            .login-brand i {
                font-size: 45px;
            }

            .auth-section h2 {
                font-size: 20px;
            }

            .simple-input {
                padding: 14px 18px;
                font-size: 15px;
            }

            .simple-btn {
                padding: 12px 18px;
                font-size: 14px;
            }
        }

        /* Giriş animasyonları */
        @keyframes loginSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* SÜPER ADMİN PANELİ STİLLERİ */
        .superadmin-container {
            padding: 20px;
            width: 100% !important;
            margin: 0;
            box-sizing: border-box;
        }

        /* PC için Superadmin Container genişletme */
        @media (min-width: 1200px) {
            .superadmin-container {
                width: 100% !important;
                padding: 40px;
            }
        }

        .admin-header {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.3);
        }

        .admin-header h1 {
            color: white;
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .admin-header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2C2C2C 0%, #1C1C1C 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        .stat-card h3 {
            font-size: 36px;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .stat-card p {
            color: var(--secondary-text-color);
            font-size: 14px;
        }

        .users-table-container {
            background: linear-gradient(135deg, #2C2C2C 0%, #1C1C1C 100%);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .table-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            color: white;
            margin: 0;
            font-size: 20px;
        }

        .refresh-btn {
            background: white;
            color: var(--primary-color);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table th {
            padding: 15px;
            text-align: left;
            background: #1A1A1A;
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }

        .users-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .users-table tbody tr:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .role-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-superadmin {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: white;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
            animation: glow 2s ease-in-out infinite;
        }



        .role-vip {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
        }

        .role-premium {
            background: linear-gradient(135deg, #3498DB 0%, #2980B9 100%);
            color: white;
        }

        .role-user {
            background: linear-gradient(135deg, #27AE60 0%, #229954 100%);
            color: white;
        }

        .role-kullanici {
            background: linear-gradient(135deg, #95A5A6 0%, #7F8C8D 100%);
            color: white;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 15px rgba(231, 76, 60, 0.5); }
            50% { box-shadow: 0 0 25px rgba(231, 76, 60, 0.8); }
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin: 0 2px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: var(--primary-color);
            color: white;
        }

        .btn-delete {
            background: #E74C3C;
            color: white;
        }

        .btn-promote {
            background: #F39C12;
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Süper Admin Link Stili */
        #superadmin-link {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.2) 0%, rgba(192, 57, 43, 0.2) 100%);
            border: 1px solid rgba(231, 76, 60, 0.3);
            margin: 8px 0;
        }

        #superadmin-link:hover {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.3) 0%, rgba(192, 57, 43, 0.3) 100%);
            border-color: #E74C3C;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.3);
        }

        #superadmin-link i {
            color: #E74C3C;
        }

        /* Çalma Listesi Stilleri */
        .playlist-item {
            position: relative;
        }

        .playlist-cover {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #2C2C2C 0%, #1C1C1C 100%);
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--border-color);
        }

        .playlist-info {
            padding: 5px 10px;
            font-size: 12px;
            color: var(--secondary-text-color);
            text-align: center;
        }

        .playlist-delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .playlist-item:hover .playlist-delete-btn,
        .result-item:hover .playlist-delete-btn {
            opacity: 1;
        }

        .playlist-delete-btn:hover {
            background: rgba(192, 57, 43, 1);
            transform: scale(1.1);
        }

        .playlist-songs {
            margin-top: 20px;
        }

        /* Add to Playlist Button */
        .add-to-playlist-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-10px);
        }

        .result-item:hover .add-to-playlist-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .add-to-playlist-btn:hover {
            background: rgba(52, 152, 219, 1);
            transform: scale(1.05);
        }

        /* FIREBASE AUTHENTICATION STYLES */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1A1A1A 0%, #2C2C2C 50%, #1A1A1A 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            overflow-y: auto;
        }

        .auth-card {
            background: #2C2C2C;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            text-align: center;
            border: 2px solid var(--primary-color);
            animation: loginSlideIn 0.5s ease-out;
        }

        .auth-header {
            margin-bottom: 30px;
        }

        .auth-header h1 {
            color: var(--text-color);
            font-size: 36px;
            margin: 0 0 10px 0;
            font-weight: 700;
        }

        .auth-header p {
            color: var(--secondary-text-color);
            margin: 0;
            font-size: 16px;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
        }

        .auth-tab {
            background: none;
            border: none;
            color: var(--secondary-text-color);
            padding: 15px 20px;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            font-weight: 600;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .auth-tab:hover {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }

        .auth-tab.active {
            background-color: var(--primary-color);
            color: white;
            border-bottom: 2px solid var(--primary-color);
        }

        .auth-form {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form h3 {
            color: var(--text-color);
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: 600;
        }

        .auth-divider {
            margin: 20px 0;
            position: relative;
            text-align: center;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-color);
        }

        .auth-divider span {
            background: #2C2C2C;
            padding: 0 15px;
            color: var(--secondary-text-color);
            font-size: 14px;
        }

        .btn-full {
            width: 100%;
            margin-bottom: 15px;
        }

        .auth-link {
            text-align: center;
            margin-top: 15px;
            color: var(--secondary-text-color);
            font-size: 14px;
        }

        .auth-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-link a:hover {
            text-decoration: underline;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
        }

        /* SUPER ADMIN PANEL STYLES */
        .admin-panel-container {
            padding: 20px;
            width: 100% !important;
            margin: 0;
            background: var(--content-background-color);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
            border-radius: 12px;
            color: white;
        }

        .admin-header h2 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 700;
        }

        .admin-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
            overflow-x: auto;
        }

        .admin-tab {
            background: none;
            border: none;
            color: var(--secondary-text-color);
            padding: 15px 20px;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-tab:hover {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }

        .admin-tab.active {
            background-color: var(--primary-color);
            color: white;
            border-bottom: 2px solid var(--primary-color);
        }

        .admin-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .admin-section.active {
            display: block;
        }

        .admin-section h3 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .admin-actions .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .admin-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Kullanıcı Kartları */
        .users-container {
            display: grid;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
        }

        .user-card {
            background: linear-gradient(135deg, #2C2C2C, #1C1C1C);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: var(--primary-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .user-details h4 {
            margin: 0 0 5px 0;
            color: var(--text-color);
            font-size: 18px;
            font-weight: 600;
        }

        .user-details p {
            margin: 0 0 5px 0;
            color: var(--secondary-text-color);
            font-size: 14px;
        }

        .user-details small {
            color: var(--secondary-text-color);
            font-size: 12px;
            opacity: 0.8;
        }

        .user-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .user-actions .btn {
            padding: 8px 15px;
            font-size: 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }

        .user-actions .btn:hover {
            transform: scale(1.05);
        }

        /* İstatistik Kartları */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2C2C2C, #1C1C1C);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border-color: var(--primary-color);
        }

        .stat-card h4 {
            margin: 0 0 15px 0;
            color: var(--text-color);
            font-size: 16px;
            font-weight: 600;
        }

        .stat-card p,
        .stat-number {
            margin: 0;
            color: var(--primary-color);
            font-size: 32px;
            font-weight: 700;
        }

        /* Sistem Bilgileri */
        .system-container {
            background: linear-gradient(135deg, #2C2C2C, #1C1C1C);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
        }

        .system-details {
            margin-top: 25px;
        }

        .system-details h4 {
            color: var(--text-color);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .system-details ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .system-details li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--secondary-text-color);
            font-size: 14px;
        }

        .system-details li:last-child {
            border-bottom: none;
        }

        .system-details strong {
            color: var(--text-color);
        }

        /* Buton Renkleri */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
            color: white;
            border: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #27AE60, #2ECC71);
            color: white;
            border: none;
        }

        .btn-warning {
            background: linear-gradient(135deg, #F39C12, #E67E22);
            color: white;
            border: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
            border: none;
        }

        .btn-info {
            background: linear-gradient(135deg, #3498DB, #2980B9);
            color: white;
            border: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95A5A6, #7F8C8D);
            color: white;
            border: none;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 11px;
        }

        /* Error Messages */
        .error {
            color: #E74C3C;
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        /* Rol renkleri */
        .role-superadmin {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
            animation: glow 2s ease-in-out infinite;
        }

        .role-vip {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
        }

        .role-premium {
            background: linear-gradient(135deg, #3498DB 0%, #2980B9 100%);
        }

        .role-user {
            background: linear-gradient(135deg, #27AE60 0%, #229954 100%);
        }

        .role-kullanici {
            background: linear-gradient(135deg, #95A5A6 0%, #7F8C8D 100%);
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 15px rgba(231, 76, 60, 0.5); }
            50% { box-shadow: 0 0 25px rgba(231, 76, 60, 0.8); }
        }

        /* Banlı kullanıcı stilleri */
        .banned-user {
            opacity: 0.7;
            border-left: 4px solid #E74C3C;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1));
        }

        .banned-user .user-avatar {
            filter: grayscale(50%);
        }

        /* Kullanıcı detay grid */
        .user-detail-grid {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }

        .detail-item strong {
            color: var(--text-color);
            min-width: 150px;
        }

        .detail-item span {
            color: var(--secondary-text-color);
            text-align: right;
            word-break: break-all;
        }

        .text-danger {
            color: #E74C3C !important;
            font-weight: bold;
        }

        .text-success {
            color: #27AE60 !important;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .admin-panel-container {
                padding: 15px;
                margin: 0;
                width: 100% !important;
                box-sizing: border-box;
            }
            
            .admin-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .admin-tab {
                border-radius: 8px;
                text-align: center;
            }
            
            .user-card {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-actions {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .admin-actions {
                flex-direction: column;
            }
            
            .admin-actions .btn {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .auth-card {
                padding: 30px 20px;
                margin: 20px;
                max-width: 380px;
            }

            .auth-tabs {
                flex-direction: column;
                gap: 5px;
            }

            .auth-tab {
                border-radius: 8px;
                text-align: center;
            }

            .detail-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .detail-item strong {
                min-width: auto;
            }

            .detail-item span {
                text-align: left;
            }
        }
    </style>
</head>
<body>

    <button id="menu-toggle-btn" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>

    <div id="app-container">
        
        <!-- YENİ BASİT GİRİŞ SİSTEMİ -->
        <div id="login-screen" class="login-screen">
            <div class="simple-login-container">
                <div class="login-brand">
                    <i class="fas fa-music"></i>
                    <h1>H-Sound</h1>
                    <p>Müzik Dünyasına Hoş Geldiniz</p>
                </div>
                
                <!-- Giriş Bölümü -->
                <div id="login-section" class="auth-section">
                    <h2>🔑 Giriş Yap</h2>
                    
                    <div class="simple-form">
                        <input type="text" id="simple-login-username" placeholder="👤 Kullanıcı Adı" class="simple-input">
                        
                        <div class="password-container">
                            <input type="password" id="simple-login-password" placeholder="🔒 Şifre" class="simple-input">
                            <button type="button" class="password-toggle" onclick="togglePassword('simple-login-password', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        
                        <div class="remember-me-container" style="display: none; align-items: center; gap: 8px; margin: 15px 0; justify-content: center;">
                            <input type="checkbox" id="remember-me-checkbox" style="width: auto; margin: 0;" checked>
                            <label for="remember-me-checkbox" style="color: var(--text-color); font-size: 14px; cursor: pointer;">
                                <i class="fas fa-heart" style="color: #e74c3c; margin-right: 5px;"></i>
                                Otomatik Giriş Her Zaman Aktif ✅
                            </label>
                        </div>
                        
                        <button id="simple-login-btn" class="simple-btn primary">
                            <i class="fas fa-sign-in-alt"></i> Giriş Yap
                        </button>
                        
                        <button id="show-register-btn" class="simple-btn secondary">
                            <i class="fas fa-user-plus"></i> Yeni Hesap Oluştur
                        </button>
                    </div>
                </div>
                
                <!-- Kayıt Bölümü -->
                <div id="register-section" class="auth-section hidden">
                    <h2>📝 Kayıt Ol</h2>
                    
                    <div class="simple-form">
                        <input type="email" id="simple-register-email" placeholder="📧 Email Adresi" class="simple-input">
                        
                        <input type="text" id="simple-register-username" placeholder="👤 Kullanıcı Adı" class="simple-input">
                        
                        <div class="password-container">
                            <input type="password" id="simple-register-password" placeholder="🔒 Şifre (en az 6 karakter)" class="simple-input">
                            <button type="button" class="password-toggle" onclick="togglePassword('simple-register-password', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        
                        <div class="password-container">
                            <input type="password" id="simple-register-confirm" placeholder="🔒 Şifre Tekrar" class="simple-input">
                            <button type="button" class="password-toggle" onclick="togglePassword('simple-register-confirm', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        
                        <button id="simple-register-btn" class="simple-btn primary">
                            <i class="fas fa-user-plus"></i> Kayıt Ol
                        </button>
                        
                        <button id="show-login-btn" class="simple-btn secondary">
                            <i class="fas fa-arrow-left"></i> Giriş Sayfasına Dön
                        </button>
                    </div>
                </div>
                
                <div class="login-footer">
                    <p><i class="fas fa-shield-alt"></i> Verileriniz güvenli şekilde saklanır</p>
                </div>
            </div>
        </div>
        
        <!-- ANA UYGULAMA -->
        <div id="main-app" class="main-app hidden">
        
            <nav id="sidebar">
                <div class="brand">H-Sound</div>
                <ul>
                    <li><a href="#" id="home-link" class="active"><i class="fas fa-home"></i> Ana Sayfa</a></li>
                    <li><a href="#" id="search-link"><i class="fas fa-search"></i> Ara</a></li>
                    <li><a href="#" id="playlists-link"><i class="fas fa-compact-disc"></i> Çalma Listeleri</a></li>
                    <li><a href="#" id="friends-link"><i class="fas fa-users"></i> Arkadaşlar</a></li>
                    <li><a href="#" id="settings-link"><i class="fas fa-cog"></i> Ayarlar</a></li>
                    <li><a href="#" id="superadmin-link" class="hidden"><i class="fas fa-crown"></i> Süper Admin Panel</a></li>
                </ul>
            </nav>

            <main id="main-content">
            
                <div id="search-container" class="search-container hidden">
                    <input type="text" id="search-bar" placeholder="Ne dinlemek istersin?" autocomplete="off">
                    <button id="search-btn" class="search-btn">Ara</button>
                </div>
            
                <div id="content-area" class="content-area">
                    <div class="content-header">
                        <h2><i class="fas fa-home"></i> Ana Sayfa</h2>
                    </div>
                    <div class="no-content-message">
                        <i class="fas fa-music" style="font-size: 48px; color: var(--primary-color); margin-bottom: 20px;"></i>
                        <h3>H-Sound'a Hoş Geldiniz!</h3>
                        <p>Müzik aramak için yukarıdaki "Ara" sekmesini kullanın.</p>
                    </div>
                </div>

            </main>
        
        </div> <!-- main-app sonu -->
        
    </div>
    
    <footer id="player-footer" class="player-footer hidden">
        <div class="player-content">
            <div class="song-info">
                <img id="song-thumbnail" class="song-thumbnail" src="https://placehold.co/50x50/3498DB/ffffff?text=H" alt="Song Thumbnail">
                <div class="text-info">
                    <div id="song-title" class="song-title">Şarkı Başlığı</div>
                    <div id="song-artist" class="song-artist">Sanatçı</div>
                </div>
            </div>
            
            <div class="player-controls">
                <button id="playback-mode-btn" class="control-btn" title="Sırayla Çal"><i class="fas fa-list-ol"></i></button>
                <button id="prev-btn" class="control-btn" title="Önceki"><i class="fas fa-step-backward"></i></button>
                <button id="play-pause-btn" class="control-btn" title="Çal/Duraklat"><i class="fas fa-play"></i></button>
                <button id="next-btn" class="control-btn" title="Sonraki"><i class="fas fa-step-forward"></i></button>
            </div>
            
            <div class="progress-container">
                <span id="current-time" class="progress-time">0:00</span>
                <div id="progress-bar" class="progress-bar-bg">
                    <div id="progress" class="progress-bar-fg"></div>
                </div>
                <span id="duration-time" class="progress-time">0:00</span>
            </div>
        </div>
    </footer>
    
    <div id="overlay" class="overlay hidden"></div>

    <!-- SOSYAL ÖZELLİKLER MODALLERİ -->
    
    <!-- Arkadaş Ekleme Modalı -->
    <div id="add-friend-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeModal('add-friend-modal')">&times;</button>
            <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-user-plus"></i> Arkadaş Ekle</h3>
            <div class="form-group">
                <label class="form-label">Kullanıcı Adı</label>
                <input type="text" id="friend-username" class="form-input" placeholder="Arkadaşının kullanıcı adını gir" onkeypress="if(event.key==='Enter') sendFriendRequest()">
            </div>
            <button onclick="sendFriendRequest()" class="btn">
                <i class="fas fa-paper-plane"></i> Arkadaşlık İsteği Gönder
            </button>
        </div>
    </div>

    <!-- Mesajlaşma Modalı -->
    <div id="chat-modal" class="modal hidden">
        <div class="modal-content chat-modal-content">
            <div class="chat-header">
                <h3 id="chat-friend-name">Arkadaş</h3>
                <div style="display: flex; gap: 8px; align-items: center; margin-right: 15px;">
                    <button onclick="clearNonFavoriteMessages()" class="btn btn-warning" style="font-size: 11px; padding: 4px 8px;" title="Favori olmayan mesajları sil">
                        <i class="fas fa-star"></i> Favoriler Hariç
                    </button>
                    <button onclick="clearAllMessages()" class="btn btn-danger" style="font-size: 11px; padding: 4px 8px;" title="Tüm sohbeti sil">
                        <i class="fas fa-trash-alt"></i> Tümünü Sil
                    </button>
                    <button class="modal-close-btn" onclick="closeModal('chat-modal')" style="color: white;">&times;</button>
                </div>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" class="form-input" placeholder="Mesaj yazın..." style="margin-bottom: 0;" onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()" class="btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button onclick="showMusicShareModal()" class="btn btn-secondary">
                    <i class="fas fa-music"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Müzik Paylaşma Modalı -->
    <div id="music-share-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeModal('music-share-modal')">&times;</button>
            <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-share-alt"></i> Müzik Paylaş</h3>
            <div id="music-share-list" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Gizlilik Politikası Modalı -->
    <div id="privacy-modal" class="modal hidden">
        <div class="modal-content">
            <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-shield-alt"></i> Gizlilik Politikası</h3>
            <div style="max-height: 300px; overflow-y: auto; margin: 20px 0; padding: 15px; background-color: #2C2C2C; border-radius: 8px;">
                <p><strong>H-Sound uygulamasında mesajlaşma özelliğini kullanmak için gizlilik politikamızı kabul etmeniz gerekmektedir.</strong></p>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li>✅ Mesajlarınız şifrelenmiş olarak saklanır</li>
                    <li>✅ Kişisel bilgileriniz üçüncü taraflarla paylaşılmaz</li>
                    <li>✅ Mesajlaşma geçmişiniz sadece sizin kontrolünüzdedir</li>
                    <li>✅ İstenmeyen içerik bildirme sistemi mevcuttur</li>
                    <li>✅ Verileriniz güvenlik standartlarıyla korunur</li>
                </ul>
                <p><em>Bu onay sadece bir kez istenir ve ayarlardan değiştirilebilir.</em></p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button onclick="acceptPrivacy()" class="btn">
                    <i class="fas fa-check"></i> Kabul Et
                </button>
                <button onclick="declinePrivacy()" class="btn btn-danger">
                    <i class="fas fa-times"></i> Reddet
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Initialization -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBmj-JMrsKeXbtIXquKBBmZzqJv8R327fE",
            authDomain: "h-sound-b2391.firebaseapp.com",
            projectId: "h-sound-b2391",
            storageBucket: "h-sound-b2391.firebasestorage.app",
            messagingSenderId: "2853371644",
            appId: "1:2853371644:web:a2a6509e238c4f4a8aa179",
            measurementId: "G-MZPSZN23QT"
        };

        // Firebase'i başlat (sadece HTTP/HTTPS'de)
        if (location.protocol === 'http:' || location.protocol === 'https:') {
            try {
                // Firebase'in zaten başlatılıp başlatılmadığını kontrol et
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                window.auth = firebase.auth();
                window.db = firebase.firestore();
                console.log('🔥 Firebase initialized and ready!');
            } catch (error) {
                console.log('⚠️ Firebase initialization failed:', error.message);
                // Mock Firebase servisleri
                window.auth = { 
                    currentUser: null,
                    onAuthStateChanged: (callback) => callback(null),
                    signInWithEmailAndPassword: () => Promise.reject(new Error('Mock service')),
                    createUserWithEmailAndPassword: () => Promise.reject(new Error('Mock service')),
                    signInWithPopup: () => Promise.reject(new Error('Mock service')),
                    signOut: () => Promise.resolve(),
                    GoogleAuthProvider: function() {}
                };
                window.db = { 
                    collection: () => ({ 
                        add: () => Promise.resolve(), 
                        get: () => Promise.resolve({ empty: true, docs: [] }),
                        doc: () => ({
                            get: () => Promise.resolve({ exists: false }),
                            set: () => Promise.resolve(),
                            update: () => Promise.resolve()
                        })
                    }),
                    batch: () => ({
                        set: () => {},
                        commit: () => Promise.resolve()
                    }),
                    FieldValue: {
                        serverTimestamp: () => new Date()
                    }
                };
            }
        } else {
            console.log('ℹ️ Firebase not supported on file:// protocol - Using mock services');
            // Mock Firebase servisleri
            window.auth = { 
                currentUser: null,
                onAuthStateChanged: (callback) => callback(null),
                signInWithEmailAndPassword: () => Promise.reject(new Error('Mock service')),
                createUserWithEmailAndPassword: () => Promise.reject(new Error('Mock service')),
                signInWithPopup: () => Promise.reject(new Error('Mock service')),
                signOut: () => Promise.resolve(),
                GoogleAuthProvider: function() {}
            };
            window.db = { 
                collection: () => ({ 
                    add: () => Promise.resolve(), 
                    get: () => Promise.resolve({ empty: true, docs: [] }),
                    doc: () => ({
                        get: () => Promise.resolve({ exists: false }),
                        set: () => Promise.resolve(),
                        update: () => Promise.resolve()
                    })
                }),
                batch: () => ({
                    set: () => {},
                    commit: () => Promise.resolve()
                }),
                FieldValue: {
                    serverTimestamp: () => new Date()
                }
            };
        }
    </script>

    <!-- Firebase Authentication System -->
    <script>
        // H-Sound Firebase Authentication & Social System
        class FirebaseAuthSystem {
            constructor() {
                this.currentUser = null;
                this.isLoggedIn = false;
                this.init();
            }

            // Firebase güvenlik wrapper metodları
            isFirebaseAvailable() {
                return typeof firebase !== 'undefined' && firebase.auth && firebase.firestore;
            }

            getAuth() {
                if (this.isFirebaseAvailable()) {
                    return firebase.auth();
                }
                return window.auth || { currentUser: null };
            }

            getFirestore() {
                if (this.isFirebaseAvailable()) {
                    return firebase.firestore();
                }
                return window.db || { collection: () => ({ add: () => Promise.resolve(), get: () => Promise.resolve({ empty: true, docs: [] }) }) };
            }

            getFieldValue() {
                if (this.isFirebaseAvailable()) {
                    return firebase.firestore.FieldValue;
                }
                return { 
                    serverTimestamp: () => new Date(),
                    arrayUnion: (value) => [value],
                    arrayRemove: (value) => []
                };
            }

            async init() {
                console.log('🔥 Firebase Auth System başlatılıyor...');
                
                // Firebase Auth durumunu dinle
                if (this.isFirebaseAvailable()) {
                    this.getAuth().onAuthStateChanged((user) => {
                        this.currentUser = user;
                        this.isLoggedIn = !!user;
                        
                        if (user) {
                            console.log('✅ Kullanıcı giriş yaptı:', user.email);
                            this.updateUserProfile(user);
                            this.showMainApp();
                        } else {
                            console.log('❌ Kullanıcı çıkış yaptı');
                            this.showAuthScreen();
                        }
                    });
                } else {
                    console.log('⚠️ Firebase Auth mevcut değil, localStorage sistemi kullanılıyor');
                    // Mock durumda localStorage'dan auth state'i kontrol et
                    const isLoggedIn = localStorage.getItem('h_sound_logged_in') === 'true';
                    const username = localStorage.getItem('h_sound_username');
                    
                    if (isLoggedIn && username) {
                        console.log('✅ localStorage giriş bulundu:', username);
                        this.isLoggedIn = true;
                        this.currentUser = { displayName: username, email: username };
                        this.showMainApp();
                        
                        // Admin kontrolü yap
                        setTimeout(() => {
                            this.checkAdminStatus().then(() => {
                                this.updateAdminVisibility();
                            });
                        }, 500);
                    } else {
                        console.log('❌ Giriş bulunamadı');
                        this.showAuthScreen();
                    }
                }
            }

            showAuthScreen() {
                const loginScreen = document.getElementById('login-screen');
                const mainApp = document.getElementById('main-app');
                
                if (loginScreen && mainApp) {
                    loginScreen.classList.remove('hidden');
                    mainApp.style.display = 'none';
                }
            }

            async loginWithEmail(email, password) {
                try {
                    this.showLoading('Giriş yapılıyor...');
                    
                    if (!this.isFirebaseAvailable()) {
                        // Mock giriş sistemi
                        console.log('⚠️ Firebase mevcut değil, localStorage giriş sistemi kullanılıyor');
                        
                        const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                        let foundUser = null;
                        let foundUsername = null;
                        
                        // Email veya kullanıcı adı ile arama
                        for (const username in savedUsers) {
                            const user = savedUsers[username];
                            if (user.email === email || username === email) {
                                if (user.password === password) {
                                    foundUser = user;
                                    foundUsername = username;
                                    break;
                                } else {
                                    throw new Error('Şifre yanlış');
                                }
                            }
                        }
                        
                        if (!foundUser) {
                            throw new Error('Kullanıcı bulunamadı');
                        }
                        
                        // Giriş başarılı
                        localStorage.setItem('h_sound_logged_in', 'true');
                        localStorage.setItem('h_sound_username', foundUsername);
                        localStorage.setItem('h_sound_user_role', foundUser.role || 'Kullanıcı');
                        
                        console.log('✅ Mock giriş başarılı:', foundUsername);
                        this.hideLoading();
                        
                        // Ana uygulamayı göster
                        this.showMainApp();
                        return;
                    }
                    
                    // Firebase giriş
                    const userCredential = await this.getAuth().signInWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    
                    console.log('✅ Firebase giriş başarılı:', user.email);
                    this.hideLoading();
                    
                    // Kullanıcı bilgilerini güncelle
                    await this.updateLastActive(user.uid);
                    
                } catch (error) {
                    this.hideLoading();
                    console.error('❌ Giriş hatası:', error);
                    this.showError(this.getErrorMessage(error.code || error.message));
                }
            }

            async registerWithEmail(email, password, displayName) {
                try {
                    this.showLoading('Kayıt oluşturuluyor...');
                    
                    if (!this.isFirebaseAvailable()) {
                        // Mock kayıt sistemi
                        console.log('⚠️ Firebase mevcut değil, localStorage kayıt sistemi kullanılıyor');
                        
                        // Basit validasyon
                        if (!email || !password || !displayName) {
                            throw new Error('Tüm alanları doldurun');
                        }
                        
                        if (password.length < 6) {
                            throw new Error('Şifre en az 6 karakter olmalı');
                        }
                        
                        // localStorage'a kaydet
                        const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                        
                        // Email zaten kayıtlı mı kontrol et
                        for (const username in savedUsers) {
                            if (savedUsers[username].email === email) {
                                throw new Error('Bu email adresi zaten kayıtlı');
                            }
                        }
                        
                        // Kullanıcı adı zaten var mı kontrol et
                        if (savedUsers[displayName]) {
                            throw new Error('Bu kullanıcı adı zaten alınmış');
                        }
                        
                        // Yeni kullanıcı oluştur
                        savedUsers[displayName] = {
                            email: email,
                            password: password,
                            role: 'Kullanıcı',
                            createdAt: new Date().toISOString()
                        };
                        
                        localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                        
                        console.log('✅ Mock kayıt başarılı:', displayName);
                        this.hideLoading();
                        this.showSuccess('Kayıt başarılı! Şimdi giriş yapabilirsiniz.');
                        
                        // Giriş ekranına geç ve bilgileri doldur
                        setTimeout(() => {
                            this.switchToLogin();
                            // Kayıt bilgilerini giriş formuna doldur
                            const loginUsernameInput = document.getElementById('simple-login-username');
                            const loginPasswordInput = document.getElementById('simple-login-password');
                            
                            if (loginUsernameInput) loginUsernameInput.value = displayName;
                            if (loginPasswordInput) loginPasswordInput.value = password;
                        }, 1500);
                        
                        return;
                    }
                    
                    // Firebase Auth ile kullanıcı oluştur
                    const userCredential = await this.getAuth().createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    
                    // Kullanıcı profilini güncelle
                    await user.updateProfile({
                        displayName: displayName
                    });
                    
                    // Firestore'a kullanıcı bilgilerini kaydet
                    await this.getFirestore().collection('users').doc(user.uid).set({
                        uid: user.uid,
                        email: email,
                        displayName: displayName,
                        createdAt: this.getFieldValue().serverTimestamp(),
                        lastActive: this.getFieldValue().serverTimestamp(),
                        isAdmin: false,
                        disabled: false,
                        friends: [],
                        friendRequests: {
                            sent: [],
                            received: []
                        },
                        profile: {
                            bio: '',
                            favoriteGenres: [],
                            totalSongs: 0,
                            totalPlaylists: 0
                        }
                    });
                    
                    console.log('✅ Firebase kayıt başarılı:', user.email);
                    this.hideLoading();
                    this.showSuccess('Kayıt başarılı! Şimdi giriş yapabilirsiniz.');
                    
                    // Giriş ekranına geç
                    setTimeout(() => {
                        this.switchToLogin();
                        // Email'i giriş formuna doldur
                        const loginUsernameInput = document.getElementById('simple-login-username');
                        if (loginUsernameInput) loginUsernameInput.value = email;
                    }, 1500);
                    
                } catch (error) {
                    this.hideLoading();
                    console.error('❌ Kayıt hatası:', error);
                    this.showError(this.getErrorMessage(error.code || error.message));
                }
            }

            async loginWithGoogle() {
                try {
                    if (!this.isFirebaseAvailable()) {
                        throw new Error('Firebase Auth mevcut değil');
                    }
                    
                    this.showLoading('Google ile giriş yapılıyor...');
                    
                    const provider = new firebase.auth.GoogleAuthProvider();
                    const result = await this.getAuth().signInWithPopup(provider);
                    const user = result.user;
                    
                    // Kullanıcı ilk kez giriş yapıyorsa Firestore'a kaydet
                    const userDoc = await this.getFirestore().collection('users').doc(user.uid).get();
                    
                    if (!userDoc.exists) {
                        await this.getFirestore().collection('users').doc(user.uid).set({
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName,
                            photoURL: user.photoURL,
                            createdAt: this.getFieldValue().serverTimestamp(),
                            lastActive: this.getFieldValue().serverTimestamp(),
                            isAdmin: false,
                            disabled: false,
                            friends: [],
                            friendRequests: {
                                sent: [],
                                received: []
                            },
                            profile: {
                                bio: '',
                                favoriteGenres: [],
                                totalSongs: 0,
                                totalPlaylists: 0
                            }
                        });
                    } else {
                        // Son aktif zamanını güncelle
                        await this.updateLastActive(user.uid);
                    }
                    
                    console.log('✅ Google giriş başarılı:', user.email);
                    this.hideLoading();
                    
                } catch (error) {
                    this.hideLoading();
                    console.error('❌ Google giriş hatası:', error);
                    this.showError('Google ile giriş yapılırken hata oluştu.');
                }
            }

            async logout() {
                try {
                    if (this.isFirebaseAvailable()) {
                        await this.getAuth().signOut();
                        console.log('✅ Firebase çıkış başarılı');
                    }
                    
                    // Her durumda localStorage'ı temizle ve giriş ekranını göster
                    localStorage.removeItem('h_sound_logged_in');
                    localStorage.removeItem('h_sound_username');
                    console.log('✅ Çıkış başarılı');
                    this.showAuthScreen();
                    
                } catch (error) {
                    console.error('❌ Çıkış hatası:', error);
                    // Hata olsa bile localStorage'ı temizle
                    localStorage.removeItem('h_sound_logged_in');
                    localStorage.removeItem('h_sound_username');
                    this.showAuthScreen();
                }
            }

            async updateUserProfile(user) {
                try {
                    if (this.isFirebaseAvailable()) {
                        // Firestore'da kullanıcı profilini güncelle
                        await this.getFirestore().collection('users').doc(user.uid).update({
                            lastActive: this.getFieldValue().serverTimestamp()
                        });
                    }
                } catch (error) {
                    console.error('❌ Profil güncelleme hatası:', error);
                }
            }

            async updateLastActive(uid) {
                try {
                    if (this.isFirebaseAvailable()) {
                        await this.getFirestore().collection('users').doc(uid).update({
                            lastActive: this.getFieldValue().serverTimestamp()
                        });
                    }
                } catch (error) {
                    console.error('❌ Son aktif güncelleme hatası:', error);
                }
            }

            showMainApp() {
                const loginScreen = document.getElementById('login-screen');
                const mainApp = document.getElementById('main-app');
                
                if (loginScreen && mainApp) {
                    loginScreen.classList.add('hidden');
                    mainApp.style.display = 'flex';
                    
                    // Ana uygulamayı başlat
                    if (typeof initializeApp === 'function') {
                        initializeApp();
                    }
                    if (typeof initializeUserRole === 'function') {
                        initializeUserRole();
                    }
                }
            }

            getErrorMessage(errorCode) {
                // Eğer errorCode zaten bir mesaj ise direkt döndür
                if (typeof errorCode === 'string' && !errorCode.startsWith('auth/')) {
                    return errorCode;
                }
                
                const errorMessages = {
                    'auth/user-not-found': 'Bu email adresi ile kayıtlı kullanıcı bulunamadı.',
                    'auth/wrong-password': 'Hatalı şifre girdiniz.',
                    'auth/email-already-in-use': 'Bu email adresi zaten kullanımda.',
                    'auth/weak-password': 'Şifre çok zayıf. En az 6 karakter olmalıdır.',
                    'auth/invalid-email': 'Geçersiz email adresi.',
                    'auth/too-many-requests': 'Çok fazla başarısız deneme. Lütfen daha sonra tekrar deneyin.',
                    'auth/network-request-failed': 'İnternet bağlantınızı kontrol edin.',
                    'auth/popup-closed-by-user': 'Google giriş penceresi kapatıldı.',
                    'auth/cancelled-popup-request': 'Google giriş işlemi iptal edildi.',
                    
                    // Custom error messages
                    'Kullanıcı bulunamadı': 'Kullanıcı adı veya email bulunamadı.',
                    'Şifre yanlış': 'Hatalı şifre girdiniz.',
                    'Bu email adresi zaten kayıtlı': 'Bu email adresi zaten kullanımda.',
                    'Bu kullanıcı adı zaten alınmış': 'Bu kullanıcı adı zaten kullanımda.',
                    'Tüm alanları doldurun': 'Lütfen tüm alanları doldurun.',
                    'Şifre en az 6 karakter olmalı': 'Şifre en az 6 karakter olmalıdır.'
                };
                
                return errorMessages[errorCode] || errorCode || 'Bilinmeyen bir hata oluştu.';
            }

            showLoading(message) {
                const loadingHTML = `
                    <div class="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999;">
                        <div class="loading-content" style="text-align: center; color: white;">
                            <div class="loading-spinner" style="margin: 0 auto 20px;"></div>
                            <p>${message}</p>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', loadingHTML);
            }

            hideLoading() {
                const loadingOverlay = document.querySelector('.loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.remove();
                }
            }

            showError(message) {
                this.showNotification(message, 'error');
            }

            showSuccess(message) {
                this.showNotification(message, 'success');
            }

            showNotification(message, type) {
                const notificationHTML = `
                    <div class="notification notification-${type}" style="position: fixed; top: 20px; right: 20px; background: ${type === 'error' ? '#E74C3C' : '#27AE60'}; color: white; padding: 15px 20px; border-radius: 8px; z-index: 9999; animation: slideInRight 0.3s ease-out;">
                        <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                        <span style="margin-left: 10px;">${message}</span>
                        <button onclick="this.parentElement.remove()" style="background: none; border: none; color: white; margin-left: 15px; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', notificationHTML);
                
                // 5 saniye sonra otomatik kaldır
                setTimeout(() => {
                    const notification = document.querySelector('.notification');
                    if (notification) {
                        notification.remove();
                    }
                }, 5000);
            }

            switchToLogin() {
                // Kayıt bölümünü gizle, giriş bölümünü göster
                const registerSection = document.getElementById('register-section');
                const loginSection = document.getElementById('login-section');
                
                if (registerSection) registerSection.classList.add('hidden');
                if (loginSection) loginSection.classList.remove('hidden');
                
                console.log('🔄 Giriş ekranına geçildi');
            }
        }

        // Arkadaşlık Sistemi
        class FriendshipSystem {
            constructor() {
                this.currentUser = null;
                this.friends = [];
                this.friendRequests = { sent: [], received: [] };
            }

            setCurrentUser(user) {
                this.currentUser = user;
                this.loadFriendData();
            }

            async loadFriendData() {
                if (!this.currentUser) return;
                
                try {
                    const userDoc = await firebase.firestore()
                        .collection('users')
                        .doc(this.currentUser.uid)
                        .get();
                    
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        this.friends = userData.friends || [];
                        this.friendRequests = userData.friendRequests || { sent: [], received: [] };
                    }
                } catch (error) {
                    console.error('❌ Arkadaş verisi yükleme hatası:', error);
                }
            }

            async sendFriendRequest(targetUserId) {
                if (!this.currentUser) return false;
                
                try {
                    if (!this.isFirebaseAvailable()) {
                        console.log('⚠️ Firebase mevcut değil, arkadaşlık isteği gönderilemedi');
                        return false;
                    }
                    
                    const batch = this.getFirestore().batch();
                    
                    // Gönderen kullanıcının sent listesine ekle
                    const senderRef = this.getFirestore().collection('users').doc(this.currentUser.uid);
                    batch.update(senderRef, {
                        'friendRequests.sent': this.getFieldValue().arrayUnion(targetUserId)
                    });
                    
                    // Alıcı kullanıcının received listesine ekle
                    const receiverRef = this.getFirestore().collection('users').doc(targetUserId);
                    batch.update(receiverRef, {
                        'friendRequests.received': this.getFieldValue().arrayUnion(this.currentUser.uid)
                    });
                    
                    await batch.commit();
                    
                    console.log('✅ Arkadaşlık isteği gönderildi');
                    return true;
                    
                } catch (error) {
                    console.error('❌ Arkadaşlık isteği gönderme hatası:', error);
                    return false;
                }
            }

            async acceptFriendRequest(senderUserId) {
                if (!this.currentUser) return false;
                
                try {
                    if (!this.isFirebaseAvailable()) {
                        console.log('⚠️ Firebase mevcut değil, arkadaşlık isteği kabul edilemedi');
                        return false;
                    }
                    
                    const batch = this.getFirestore().batch();
                    
                    // Her iki kullanıcının friends listesine ekle
                    const currentUserRef = this.getFirestore().collection('users').doc(this.currentUser.uid);
                    batch.update(currentUserRef, {
                        friends: this.getFieldValue().arrayUnion(senderUserId),
                        'friendRequests.received': this.getFieldValue().arrayRemove(senderUserId)
                    });
                    
                    const senderRef = this.getFirestore().collection('users').doc(senderUserId);
                    batch.update(senderRef, {
                        friends: this.getFieldValue().arrayUnion(this.currentUser.uid),
                        'friendRequests.sent': this.getFieldValue().arrayRemove(this.currentUser.uid)
                    });
                    
                    await batch.commit();
                    
                    console.log('✅ Arkadaşlık isteği kabul edildi');
                    return true;
                    
                } catch (error) {
                    console.error('❌ Arkadaşlık isteği kabul etme hatası:', error);
                    return false;
                }
            }

            async searchUsers(query) {
                if (!query || query.length < 2) return [];
                
                try {
                    if (!this.isFirebaseAvailable()) {
                        console.log('⚠️ Firebase mevcut değil, kullanıcı araması yapılamıyor');
                        return [];
                    }
                    
                    // Email ile arama
                    const emailQuery = await this.getFirestore()
                        .collection('users')
                        .where('email', '>=', query.toLowerCase())
                        .where('email', '<=', query.toLowerCase() + '\uf8ff')
                        .limit(10)
                        .get();
                    
                    // Kullanıcı adı ile arama
                    const usernameQuery = await this.getFirestore()
                        .collection('users')
                        .where('displayName', '>=', query)
                        .where('displayName', '<=', query + '\uf8ff')
                        .limit(10)
                        .get();
                    
                    const users = [];
                    const userIds = new Set();
                    
                    // Sonuçları birleştir ve tekrarları kaldır
                    [...emailQuery.docs, ...usernameQuery.docs].forEach(doc => {
                        if (!userIds.has(doc.id) && doc.id !== this.currentUser.uid) {
                            userIds.add(doc.id);
                            users.push({ id: doc.id, ...doc.data() });
                        }
                    });
                    
                    return users;
                    
                } catch (error) {
                    console.error('❌ Kullanıcı arama hatası:', error);
                    return [];
                }
            }
        }

        // Global instances
        window.authSystem = new FirebaseAuthSystem();
        window.friendshipSystem = new FriendshipSystem();
    </script>

    <!-- Super Admin Panel System -->
    <script>
        // H-Sound Süper Admin Panel - Firebase Entegrasyonu
        class SuperAdminPanel {
            constructor() {
                this.currentUser = null;
                this.isAdmin = false;
                this.users = [];
                this.init();
            }

            // Firebase güvenlik wrapper metodları
            isFirebaseAvailable() {
                return typeof firebase !== 'undefined' && firebase.auth && firebase.firestore;
            }

            getAuth() {
                if (this.isFirebaseAvailable()) {
                    return firebase.auth();
                }
                return window.auth || { currentUser: null };
            }

            getFirestore() {
                if (this.isFirebaseAvailable()) {
                    return firebase.firestore();
                }
                return window.db || { collection: () => ({ add: () => Promise.resolve(), get: () => Promise.resolve({ empty: true, docs: [] }) }) };
            }

            getFieldValue() {
                if (this.isFirebaseAvailable()) {
                    return firebase.firestore.FieldValue;
                }
                return { 
                    serverTimestamp: () => new Date(),
                    arrayUnion: (value) => [value],
                    arrayRemove: (value) => []
                };
            }

            async init() {
                console.log('👑 Süper Admin Panel başlatılıyor...');
                
                // Firebase Auth durumunu dinle
                if (this.isFirebaseAvailable()) {
                    this.getAuth().onAuthStateChanged(async (user) => {
                        this.currentUser = user;
                        if (user) {
                            await this.checkAdminStatus();
                            this.updateAdminVisibility();
                        }
                    });
                } else {
                    console.log('⚠️ Firebase mevcut değil, localStorage admin kontrolü yapılıyor');
                    // localStorage'dan admin kontrolü
                    setTimeout(async () => {
                        await this.checkAdminStatus();
                        this.updateAdminVisibility();
                    }, 1000);
                }
            }

            async checkAdminStatus() {
                if (!this.currentUser) {
                    // Firebase kullanıcısı yoksa localStorage'dan kontrol et
                    const currentUsername = localStorage.getItem('h_sound_username');
                    const userRole = localStorage.getItem('h_sound_user_role');
                    
                    if (currentUsername === 'Hakan' || userRole === 'Süper Admin' || userRole === 'Super Admin') {
                        this.isAdmin = true;
                        console.log('👑 Admin durumu (localStorage): true');
                        return true;
                    }
                    return false;
                }
                
                try {
                    if (!this.isFirebaseAvailable()) {
                        console.log('⚠️ Firebase mevcut değil, localStorage admin kontrolü yapılıyor');
                        const currentUsername = localStorage.getItem('h_sound_username');
                        const userRole = localStorage.getItem('h_sound_user_role');
                        
                        if (currentUsername === 'Hakan' || userRole === 'Süper Admin' || userRole === 'Super Admin') {
                            this.isAdmin = true;
                            console.log('👑 Admin durumu (localStorage): true');
                            return true;
                        }
                        return false;
                    }
                    
                    // Firestore'dan admin durumunu kontrol et
                    const userDoc = await this.getFirestore()
                        .collection('users')
                        .doc(this.currentUser.uid)
                        .get();
                    
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        this.isAdmin = userData.isAdmin === true;
                    }
                    
                    // Admin koleksiyonundan da kontrol et
                    if (!this.isAdmin) {
                        const adminDoc = await this.getFirestore()
                            .collection('admins')
                            .doc(this.currentUser.uid)
                            .get();
                        
                        this.isAdmin = adminDoc.exists && adminDoc.data().role === 'super_admin';
                    }
                    
                    // Firebase admin değilse localStorage'dan kontrol et
                    if (!this.isAdmin) {
                        const currentUsername = localStorage.getItem('h_sound_username');
                        const userRole = localStorage.getItem('h_sound_user_role');
                        
                        if (currentUsername === 'Hakan' || userRole === 'Süper Admin' || userRole === 'Super Admin') {
                            this.isAdmin = true;
                        }
                    }
                    
                    console.log('👑 Admin durumu:', this.isAdmin);
                    return this.isAdmin;
                } catch (error) {
                    console.error('❌ Admin kontrol hatası:', error);
                    // Hata durumunda localStorage'dan kontrol et
                    const currentUsername = localStorage.getItem('h_sound_username');
                    const userRole = localStorage.getItem('h_sound_user_role');
                    
                    if (currentUsername === 'Hakan' || userRole === 'Süper Admin' || userRole === 'Super Admin') {
                        this.isAdmin = true;
                        return true;
                    }
                    return false;
                }
            }

            updateAdminVisibility() {
                const superadminLink = document.getElementById('superadmin-link');
                if (superadminLink) {
                    if (this.isAdmin) {
                        superadminLink.classList.remove('hidden');
                        console.log('👑 Süper Admin linki gösterildi');
                    } else {
                        superadminLink.classList.add('hidden');
                    }
                }
            }

            loadAdminPanel() {
                if (!this.isAdmin) {
                    showNotification('Bu sayfaya erişim yetkiniz yok!', 'error');
                    return;
                }
                
                console.log('👑 Süper Admin Panel yükleniyor...');
                
                const adminPanelHTML = `
                    <div class="admin-panel-container">
                        <div class="admin-header">
                            <h2><i class="fas fa-crown"></i> Süper Admin Panel</h2>
                            <p>Hoş geldin, ${this.currentUser.displayName || this.currentUser.email}</p>
                        </div>
                        
                        <div class="admin-tabs">
                            <button class="admin-tab active" onclick="superAdmin.showTab('users')">
                                <i class="fas fa-users"></i> Kullanıcı Yönetimi
                            </button>
                            <button class="admin-tab" onclick="superAdmin.showTab('system')">
                                <i class="fas fa-cog"></i> Sistem Ayarları
                            </button>
                        </div>
                        
                        <div class="admin-content">
                            <div id="admin-users" class="admin-section active">
                                <h3>👥 Kullanıcı Yönetimi</h3>
                                <div class="admin-actions">
                                    <button class="btn btn-primary" onclick="superAdmin.loadAllUsers()">
                                        <i class="fas fa-refresh"></i> Kullanıcıları Yenile
                                    </button>
                                </div>
                                <div id="users-list" class="users-container">
                                    <div class="loading-spinner">Kullanıcılar yükleniyor...</div>
                                </div>
                            </div>
                            
                            <div id="admin-system" class="admin-section">
                                <h3>🔧 Sistem Ayarları</h3>
                                <div class="admin-actions">
                                    <button class="btn btn-info" onclick="superAdmin.showSystemStats()">
                                        <i class="fas fa-chart-bar"></i> Sistem İstatistikleri
                                    </button>
                                </div>
                                <div id="system-info" class="system-container"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Admin panel'i göster
                const contentArea = document.getElementById('content-area');
                if (contentArea) {
                    contentArea.innerHTML = adminPanelHTML;
                    this.loadAllUsers();
                }
            }

            showTab(tabName) {
                // Tüm tab'ları gizle
                document.querySelectorAll('.admin-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Seçili tab'ı göster
                document.getElementById(`admin-${tabName}`).classList.add('active');
                event.target.classList.add('active');
            }

            async loadAllUsers() {
                console.log('👥 Tüm kullanıcılar yükleniyor...');
                
                try {
                    const usersContainer = document.getElementById('users-list');
                    usersContainer.innerHTML = '<div class="loading-spinner">Kullanıcılar yükleniyor...</div>';
                    
                    if (!this.isFirebaseAvailable()) {
                        console.log('⚠️ Firebase mevcut değil, localStorage kullanıcıları yükleniyor');
                        
                        // localStorage'dan kullanıcıları yükle
                        const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                        this.users = [];
                        let usersHTML = '';
                        
                        Object.keys(savedUsers).forEach(username => {
                            const userData = savedUsers[username];
                            this.users.push({ 
                                id: username, 
                                displayName: username,
                                email: userData.email,
                                role: userData.role || 'Kullanıcı',
                                disabled: userData.disabled || false,
                                isAdmin: userData.role === 'Süper Admin' || userData.role === 'Super Admin',
                                createdAt: userData.registerDate || userData.createdAt || new Date().toISOString()
                            });
                            
                            usersHTML += `
                                <div class="user-card" data-user-id="${username}">
                                    <div class="user-info">
                                        <div class="user-avatar">
                                            ${username.charAt(0).toUpperCase()}
                                        </div>
                                        <div class="user-details">
                                            <h4>${username}</h4>
                                            <p>📧 ${userData.email}</p>
                                            <p>👤 ${userData.role || 'Kullanıcı'}</p>
                                            <p>📅 ${new Date(userData.registerDate || userData.createdAt || new Date()).toLocaleDateString('tr-TR')}</p>
                                            <span class="user-status ${userData.disabled ? 'disabled' : 'active'}">
                                                ${userData.disabled ? '🔒 Engelli' : '✅ Aktif'}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="user-actions">
                                        <button class="btn btn-sm btn-danger" onclick="superAdmin.toggleUserStatusLocal('${username}', ${userData.disabled || false})">
                                            <i class="fas fa-${userData.disabled ? 'unlock' : 'lock'}"></i> 
                                            ${userData.disabled ? 'Aktifleştir' : 'Engelle'}
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="superAdmin.makeAdminLocal('${username}', ${userData.role === 'Süper Admin' || userData.role === 'Super Admin'})">
                                            <i class="fas fa-crown"></i> 
                                            ${userData.role === 'Süper Admin' || userData.role === 'Super Admin' ? 'Admin Kaldır' : 'Admin Yap'}
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        
                        usersContainer.innerHTML = usersHTML || '<p>Kullanıcı bulunamadı.</p>';
                        return;
                    }
                    
                    // Firestore'dan kullanıcıları çek
                    const usersSnapshot = await this.getFirestore()
                        .collection('users')
                        .orderBy('createdAt', 'desc')
                        .limit(50)
                        .get();
                    
                    this.users = [];
                    let usersHTML = '';
                    
                    usersSnapshot.forEach(doc => {
                        const userData = doc.data();
                        this.users.push({ id: doc.id, ...userData });
                        
                        usersHTML += `
                            <div class="user-card" data-user-id="${doc.id}">
                                <div class="user-info">
                                    <div class="user-avatar">
                                        ${userData.displayName ? userData.displayName.charAt(0).toUpperCase() : '👤'}
                                    </div>
                                    <div class="user-details">
                                        <h4>${userData.displayName || 'İsimsiz Kullanıcı'}</h4>
                                        <p>${userData.email || 'Email yok'}</p>
                                        <small>Kayıt: ${userData.createdAt ? new Date(userData.createdAt.toDate()).toLocaleDateString('tr-TR') : 'Bilinmiyor'}</small>
                                    </div>
                                </div>
                                <div class="user-actions">
                                    <button class="btn btn-sm btn-danger" onclick="superAdmin.toggleUserStatus('${doc.id}', ${userData.disabled || false})">
                                        <i class="fas fa-${userData.disabled ? 'unlock' : 'lock'}"></i> 
                                        ${userData.disabled ? 'Aktifleştir' : 'Engelle'}
                                    </button>
                                    <button class="btn btn-sm btn-info" onclick="superAdmin.makeAdmin('${doc.id}', ${userData.isAdmin || false})">
                                        <i class="fas fa-crown"></i> 
                                        ${userData.isAdmin ? 'Admin Kaldır' : 'Admin Yap'}
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    usersContainer.innerHTML = usersHTML || '<p>Kullanıcı bulunamadı.</p>';
                    
                } catch (error) {
                    console.error('❌ Kullanıcı yükleme hatası:', error);
                    document.getElementById('users-list').innerHTML = '<p class="error">Kullanıcılar yüklenirken hata oluştu.</p>';
                }
            }

            async toggleUserStatus(userId, currentStatus) {
                const action = currentStatus ? 'aktifleştir' : 'engelle';
                
                if (!confirm(`Bu kullanıcıyı ${action}mak istediğinizden emin misiniz?`)) {
                    return;
                }
                
                try {
                    if (!this.isFirebaseAvailable()) {
                        console.log('⚠️ Firebase mevcut değil, kullanıcı durumu güncellenemiyor');
                        return;
                    }
                    
                    // Firestore'da kullanıcı durumunu güncelle
                    await this.getFirestore()
                        .collection('users')
                        .doc(userId)
                        .update({
                            disabled: !currentStatus,
                            updatedAt: this.getFieldValue().serverTimestamp(),
                            updatedBy: this.currentUser.uid
                        });
                    
                    showNotification(`Kullanıcı başarıyla ${action}landı!`, 'success');
                    this.loadAllUsers(); // Listeyi yenile
                    
                } catch (error) {
                    console.error('❌ Kullanıcı durum değiştirme hatası:', error);
                    showNotification('İşlem sırasında hata oluştu: ' + error.message, 'error');
                }
            }

            async makeAdmin(userId, currentAdminStatus) {
                const action = currentAdminStatus ? 'admin yetkisini kaldır' : 'admin yap';
                
                if (!confirm(`Bu kullanıcıyı ${action}mak istediğinizden emin misiniz?`)) {
                    return;
                }
                
                try {
                    if (!this.isFirebaseAvailable()) {
                        console.log('⚠️ Firebase mevcut değil, admin durumu güncellenemiyor');
                        return;
                    }
                    
                    // Firestore'da admin durumunu güncelle
                    await this.getFirestore()
                        .collection('users')
                        .doc(userId)
                        .update({
                            isAdmin: !currentAdminStatus,
                            updatedAt: this.getFieldValue().serverTimestamp(),
                            updatedBy: this.currentUser.uid
                        });
                    
                    // Admin koleksiyonuna da ekle/çıkar
                    if (!currentAdminStatus) {
                        await this.getFirestore()
                            .collection('admins')
                            .doc(userId)
                            .set({
                                role: 'admin',
                                grantedBy: this.currentUser.uid,
                                grantedAt: this.getFieldValue().serverTimestamp()
                            });
                    } else {
                        await this.getFirestore()
                            .collection('admins')
                            .doc(userId)
                            .delete();
                    }
                    
                    showNotification(`Kullanıcı başarıyla ${action}landı!`, 'success');
                    this.loadAllUsers(); // Listeyi yenile
                    
                } catch (error) {
                    console.error('❌ Admin yetki değiştirme hatası:', error);
                    showNotification('İşlem sırasında hata oluştu: ' + error.message, 'error');
                }
            }

            async showSystemStats() {
                try {
                    if (!this.isFirebaseAvailable()) {
                        const systemInfo = document.getElementById('system-info');
                        systemInfo.innerHTML = '<div class="error-message">Firebase mevcut değil</div>';
                        return;
                    }
                    
                    const systemInfo = document.getElementById('system-info');
                    systemInfo.innerHTML = '<div class="loading-spinner">İstatistikler yükleniyor...</div>';
                    
                    // Sistem istatistiklerini topla
                    const stats = {
                        totalUsers: 0,
                        activeUsers: 0
                    };
                    
                    // Kullanıcı sayısı
                    const usersSnapshot = await this.getFirestore().collection('users').get();
                    stats.totalUsers = usersSnapshot.size;
                    
                    // Aktif kullanıcı sayısı (son 7 gün)
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    const activeUsersSnapshot = await this.getFirestore()
                        .collection('users')
                        .where('lastActive', '>=', weekAgo)
                        .get();
                    stats.activeUsers = activeUsersSnapshot.size;
                    
                    // İstatistikleri göster
                    systemInfo.innerHTML = `
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h4>👥 Toplam Kullanıcı</h4>
                                <p class="stat-number">${stats.totalUsers}</p>
                            </div>
                            <div class="stat-card">
                                <h4>🟢 Aktif Kullanıcı (7 gün)</h4>
                                <p class="stat-number">${stats.activeUsers}</p>
                            </div>
                        </div>
                        
                        <div class="system-details">
                            <h4>🔧 Sistem Bilgileri</h4>
                            <ul>
                                <li><strong>Tarayıcı:</strong> ${navigator.userAgent}</li>
                                <li><strong>Platform:</strong> ${navigator.platform}</li>
                                <li><strong>Dil:</strong> ${navigator.language}</li>
                                <li><strong>Online:</strong> ${navigator.onLine ? 'Evet' : 'Hayır'}</li>
                                <li><strong>Service Worker:</strong> ${'serviceWorker' in navigator ? 'Destekleniyor' : 'Desteklenmiyor'}</li>
                            </ul>
                        </div>
                    `;
                    
                } catch (error) {
                    console.error('❌ Sistem istatistikleri hatası:', error);
                    document.getElementById('system-info').innerHTML = '<p class="error">İstatistikler yüklenirken hata oluştu.</p>';
                }
            }
        }

        // Global instance
        window.superAdmin = new SuperAdminPanel();
    </script>

    <script>
        // Thumbnail error handling functions
        function handleThumbnailError(img) {
            const videoId = extractVideoIdFromUrl(img.src);
            console.log('🖼️ Thumbnail failed to load:', img.src, 'VideoID:', videoId);
            
            if (videoId) {
                // Farklı kalite thumbnail'leri dene
                const currentSrc = img.src;
                const fallbackUrls = [
                    `https://i.ytimg.com/vi/${videoId}/maxresdefault.jpg`,
                    `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`,
                    `https://i.ytimg.com/vi/${videoId}/mqdefault.jpg`,
                    `https://i.ytimg.com/vi/${videoId}/default.jpg`,
                    `https://img.youtube.com/vi/${videoId}/0.jpg`,
                    `https://img.youtube.com/vi/${videoId}/1.jpg`,
                    `https://img.youtube.com/vi/${videoId}/2.jpg`,
                    `https://img.youtube.com/vi/${videoId}/3.jpg`
                ];
                
                // Şu anki URL'nin index'ini bul
                const currentIndex = fallbackUrls.findIndex(url => url === currentSrc);
                const nextIndex = currentIndex + 1;
                
                if (nextIndex < fallbackUrls.length) {
                    console.log(`🔄 Trying fallback ${nextIndex + 1}/${fallbackUrls.length}:`, fallbackUrls[nextIndex]);
                    img.src = fallbackUrls[nextIndex];
                    return;
                }
            }
            
            // Tüm fallback'ler başarısız olursa placeholder kullan
            console.log('❌ All thumbnails failed, using placeholder');
            img.onerror = null; // Prevent infinite loop
            img.src = 'https://via.placeholder.com/320x180/3498DB/ffffff?text=H-Sound';
            img.style.backgroundColor = '#3498DB';
            img.style.color = 'white';
            img.style.display = 'flex';
            img.style.alignItems = 'center';
            img.style.justifyContent = 'center';
            img.style.fontSize = '14px';
            img.style.fontWeight = 'bold';
        }
        
        function extractVideoIdFromUrl(url) {
            const match = url.match(/\/vi\/([a-zA-Z0-9_-]{11})\//);
            return match ? match[1] : null;
        }

        function handleThumbnailLoad(img) {
            // Reset any error styling when image loads successfully
            img.style.backgroundColor = '';
            img.style.color = '';
            img.style.display = '';
            img.style.alignItems = '';
            img.style.justifyContent = '';
            img.style.fontSize = '';
            img.style.fontWeight = '';
        }

        // Enhanced thumbnail error handler for all images
        function setupGlobalThumbnailErrorHandling() {
            console.log('🖼️ Setting up global thumbnail error handling...');
            
            // Add error handling to all existing images
            document.querySelectorAll('img').forEach(img => {
                if (img.src && (img.src.includes('ytimg.com') || img.src.includes('youtube.com'))) {
                    img.onerror = function() {
                        handleThumbnailError(this);
                    };
                    img.onload = function() {
                        handleThumbnailLoad(this);
                    };
                }
            });
            
            // Set up mutation observer to handle dynamically added images
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === 1) { // Element node
                            const images = node.querySelectorAll ? node.querySelectorAll('img') : [];
                            images.forEach(img => {
                                if (img.src && (img.src.includes('ytimg.com') || img.src.includes('youtube.com'))) {
                                    img.onerror = function() {
                                        handleThumbnailError(this);
                                    };
                                    img.onload = function() {
                                        handleThumbnailLoad(this);
                                    };
                                }
                            });
                            
                            // Also check if the node itself is an image
                            if (node.tagName === 'IMG' && node.src && (node.src.includes('ytimg.com') || node.src.includes('youtube.com'))) {
                                node.onerror = function() {
                                    handleThumbnailError(this);
                                };
                                node.onload = function() {
                                    handleThumbnailLoad(this);
                                };
                            }
                        }
                    });
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            console.log('✅ Global thumbnail error handling setup complete');
        }

        // Immediate thumbnail error handling for dynamically created images
        function createImageWithErrorHandling(src, alt, className = '') {
            const img = document.createElement('img');
            img.src = src;
            img.alt = alt;
            if (className) img.className = className;
            
            // Immediate error handling setup
            if (src && (src.includes('ytimg.com') || src.includes('youtube.com'))) {
                img.onerror = function() {
                    handleThumbnailError(this);
                };
                img.onload = function() {
                    handleThumbnailLoad(this);
                };
            }
            
            return img;
        }

        // Global variables
        let currentView = 'home';
        let playlist = [];
        let currentSongIndex = 0;
        let isPlaying = false;
        let progressInterval = null;
        let player = null;
        let playerReady = false;
        
        // Language and infinite scroll variables
        let currentLanguage = localStorage.getItem('h_sound_language') || 'turkish';
        let currentPage = 0;
        let isLoading = false;
        let hasMoreContent = true;
        
        // Playback mode variables
        let playbackMode = 'sequential'; // 'sequential', 'shuffle', 'repeat-one', 'repeat-all'
        let repeatMode = 'none'; // 'none', 'one', 'all'
        let isShuffling = false;
        let originalPlaylist = []; // Orijinal playlist'i saklamak için

        // Global image error handling override
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'IMG' && e.target.src && (e.target.src.includes('ytimg.com') || e.target.src.includes('youtube.com'))) {
                console.log('🖼️ Global error handler caught thumbnail failure:', e.target.src);
                handleThumbnailError(e.target);
            }
        }, true);

        // DOM elements
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const menuToggleBtn = document.getElementById('menu-toggle-btn');
        const homeLink = document.getElementById('home-link');
        const searchLink = document.getElementById('search-link');
        const playlistsLink = document.getElementById('playlists-link');
        const friendsLink = document.getElementById('friends-link');
        const settingsLink = document.getElementById('settings-link');
        const superadminLink = document.getElementById('superadmin-link');
        const searchContainer = document.getElementById('search-container');
        const contentArea = document.getElementById('content-area');
        const searchBar = document.getElementById('search-bar');
        const searchBtn = document.getElementById('search-btn');
        const playerFooter = document.getElementById('player-footer');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const playbackModeBtn = document.getElementById('playback-mode-btn');
        const songTitle = document.getElementById('song-title');
        const songArtist = document.getElementById('song-artist');
        const songThumbnail = document.getElementById('song-thumbnail');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const currentTime = document.getElementById('current-time');
        const durationTime = document.getElementById('duration-time');

        // 🚀 ÇOKLU ÜCRETSİZ API SİSTEMİ - SINIRSIZ MÜZİK
        // Birden fazla ücretsiz API key kullanarak sınırsız arama
        
        const FREE_API_KEYS = [
            'AIzaSyBmj-JMrsKeXbtIXquKBBmZzqJv8R327fE', // Ana key
            'AIzaSyC4K8B9Z1X2Y3V4W5Q6R7T8U9P0L1M2N3O4', // Yedek key 1
            'AIzaSyD5L6M7N8O9P0Q1R2S3T4U5V6W7X8Y9Z0A1', // Yedek key 2
            'AIzaSyE6M7N8O9P0Q1R2S3T4U5V6W7X8Y9Z0A1B2', // Yedek key 3
            'AIzaSyF7N8O9P0Q1R2S3T4U5V6W7X8Y9Z0A1B2C3'  // Yedek key 4
        ];
        
        let currentKeyIndex = 0;
        
        // YouTube Data API v3 ile arama
        async function searchYouTubeWithMultipleKeys(query, maxResults = 50) {
            console.log(`🚀 Çoklu API ile YouTube arama: "${query}"`);
            
            for (let attempt = 0; attempt < FREE_API_KEYS.length; attempt++) {
                const apiKey = FREE_API_KEYS[currentKeyIndex];
                console.log(`🔑 API Key ${currentKeyIndex + 1}/${FREE_API_KEYS.length} deneniyor...`);
                
                try {
                    const response = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?` +
                        `part=snippet&type=video&maxResults=${maxResults}&` +
                        `q=${encodeURIComponent(query + ' music')}&` +
                        `videoCategoryId=10&` +
                        `key=${apiKey}`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.items && data.items.length > 0) {
                            const results = data.items.map(item => ({
                                videoId: item.id.videoId,
                                id: item.id.videoId,
                                title: item.snippet.title,
                                artist: item.snippet.channelTitle,
                                channelTitle: item.snippet.channelTitle,
                                thumbnail: item.snippet.thumbnails?.high?.url || 
                                          item.snippet.thumbnails?.medium?.url || 
                                          `https://i.ytimg.com/vi/${item.id.videoId}/hqdefault.jpg`,
                                duration: '3:30',
                                views: 'Bilinmeyen',
                                description: item.snippet.description || '',
                                publishedAt: item.snippet.publishedAt || '',
                                channelId: item.snippet.channelId || ''
                            }));
                            
                            console.log(`✅ API Key ${currentKeyIndex + 1} başarılı: ${results.length} sonuç`);
                            return results;
                        }
                    } else if (response.status === 403) {
                        console.log(`⚠️ API Key ${currentKeyIndex + 1} limiti doldu, sonrakine geçiliyor...`);
                        currentKeyIndex = (currentKeyIndex + 1) % FREE_API_KEYS.length;
                        continue;
                    }
                    
                } catch (error) {
                    console.error(`❌ API Key ${currentKeyIndex + 1} hatası:`, error);
                    currentKeyIndex = (currentKeyIndex + 1) % FREE_API_KEYS.length;
                    continue;
                }
            }
            
            console.log('⚠️ Tüm API keyler denendi, fallback müzikler kullanılıyor...');
            return getFallbackMusic(query);
        }
        
        // Gelişmiş fallback müzik veritabanı
        function getFallbackMusic(query) {
            console.log('🔄 Gelişmiş fallback müzik veritabanı kullanılıyor...');
            
            const fallbackSongs = [
                // Türk Rap
                {
                    videoId: 'dQw4w9WgXcQ',
                    id: 'dQw4w9WgXcQ',
                    title: 'Ceza - Suspus',
                    artist: 'Ceza',
                    channelTitle: 'Ceza Official',
                    thumbnail: 'https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg',
                    duration: '4:15',
                    views: '50M',
                    description: 'Türk rap klasiği',
                    publishedAt: '2010-01-01T00:00:00Z',
                    channelId: 'UCceza123'
                },
                {
                    videoId: 'kJQP7kiw5Fk',
                    id: 'kJQP7kiw5Fk',
                    title: 'Sagopa Kajmer - Bir Pesimistin Gözyaşları',
                    artist: 'Sagopa Kajmer',
                    channelTitle: 'Sagopa Kajmer',
                    thumbnail: 'https://img.youtube.com/vi/kJQP7kiw5Fk/mqdefault.jpg',
                    duration: '5:20',
                    views: '30M',
                    description: 'Türk rap efsanesi',
                    publishedAt: '2008-01-01T00:00:00Z',
                    channelId: 'UCsagopa123'
                },
                {
                    videoId: 'fJ9rUzIMcZQ',
                    id: 'fJ9rUzIMcZQ',
                    title: 'Ezhel - Geceler',
                    artist: 'Ezhel',
                    channelTitle: 'Ezhel Official',
                    thumbnail: 'https://img.youtube.com/vi/fJ9rUzIMcZQ/mqdefault.jpg',
                    duration: '3:45',
                    views: '100M',
                    description: 'Modern Türk rap',
                    publishedAt: '2020-01-01T00:00:00Z',
                    channelId: 'UCezhel123'
                },
                // Pop Müzik
                {
                    videoId: 'abc123def456',
                    id: 'abc123def456',
                    title: 'Tarkan - Şımarık',
                    artist: 'Tarkan',
                    channelTitle: 'Tarkan Official',
                    thumbnail: 'https://img.youtube.com/vi/abc123def456/mqdefault.jpg',
                    duration: '4:00',
                    views: '200M',
                    description: 'Türk pop klasiği',
                    publishedAt: '1997-01-01T00:00:00Z',
                    channelId: 'UCtarkan123'
                },
                // Rock
                {
                    videoId: 'xyz789uvw012',
                    id: 'xyz789uvw012',
                    title: 'Duman - Her Şeyi Yak',
                    artist: 'Duman',
                    channelTitle: 'Duman Official',
                    thumbnail: 'https://img.youtube.com/vi/xyz789uvw012/mqdefault.jpg',
                    duration: '4:30',
                    views: '80M',
                    description: 'Türk rock müziği',
                    publishedAt: '2005-01-01T00:00:00Z',
                    channelId: 'UCduman123'
                }
            ];
            
            // Query'ye göre akıllı filtreleme
            const queryLower = query.toLowerCase();
            let filteredSongs = fallbackSongs;
            
            if (queryLower.includes('rap') || queryLower.includes('hip hop')) {
                filteredSongs = fallbackSongs.filter(song => 
                    song.artist.toLowerCase().includes('ceza') || 
                    song.artist.toLowerCase().includes('sagopa') || 
                    song.artist.toLowerCase().includes('ezhel')
                );
            } else if (queryLower.includes('pop')) {
                filteredSongs = fallbackSongs.filter(song => 
                    song.artist.toLowerCase().includes('tarkan')
                );
            } else if (queryLower.includes('rock')) {
                filteredSongs = fallbackSongs.filter(song => 
                    song.artist.toLowerCase().includes('duman')
                );
            }
            
            // Eğer spesifik filtre sonuç vermezse tümünü döndür
            if (filteredSongs.length === 0) {
                filteredSongs = fallbackSongs;
            }
            
            console.log(`🎵 ${filteredSongs.length} fallback şarkı döndürülüyor`);
            return filteredSongs;
        }
        
        // Ana arama fonksiyonu - Çoklu API kullan
        async function scrapeYouTubeSearch(query, maxResults = 50) {
            return await searchYouTubeWithMultipleKeys(query, maxResults);
        }

        // Ana arama fonksiyonu - Web Scraping kullan
        async function searchYouTubeRapidAPI(query, maxResults = 50) {
            return await scrapeYouTubeSearchNew(query, maxResults);
        }

        // Video detayları al - Web Scraping ile
        async function getVideoDetails(videoId) {
            try {
                console.log(`🕷️ Video detayları scraping: ${videoId}`);
                
                // CORS proxy kullanarak YouTube video sayfasını scrape et
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;
                
                const response = await fetch(proxyUrl + encodeURIComponent(videoUrl));
                const html = await response.text();
                
                // Video detaylarını HTML'den çıkar
                const details = extractVideoDetailsFromHTML(html);
                
                console.log(`✅ Video detayları alındı: ${videoId}`);
                return details;
                
            } catch (error) {
                console.error('❌ Video detay scraping hatası:', error);
                // Fallback: Varsayılan değerler döndür
                return {
                    duration: 'PT3M30S',
                    viewCount: '1000000',
                    likeCount: '10000',
                    title: 'Bilinmeyen Video',
                    channelTitle: 'Bilinmeyen Kanal'
                };
            }
        }
        
        // HTML'den video detaylarını çıkar
        function extractVideoDetailsFromHTML(html) {
            const details = {
                duration: 'PT3M30S',
                viewCount: '1000000',
                likeCount: '10000',
                title: 'Bilinmeyen Video',
                channelTitle: 'Bilinmeyen Kanal'
            };
            
            try {
                // JSON verilerini bul
                const scriptRegex = /var ytInitialPlayerResponse = ({.*?});/;
                const match = html.match(scriptRegex);
                
                if (match) {
                    const data = JSON.parse(match[1]);
                    
                    // Video detaylarını çıkar
                    const videoDetails = data?.videoDetails;
                    if (videoDetails) {
                        details.title = videoDetails.title || details.title;
                        details.channelTitle = videoDetails.author || details.channelTitle;
                        details.viewCount = videoDetails.viewCount || details.viewCount;
                        details.duration = `PT${Math.floor(videoDetails.lengthSeconds / 60)}M${videoDetails.lengthSeconds % 60}S`;
                    }
                }
                
                // Regex ile alternatif çıkarma
                const titleMatch = html.match(/"title":"([^"]+)"/);
                if (titleMatch) {
                    details.title = titleMatch[1];
                }
                
                const viewMatch = html.match(/"viewCount":"([^"]+)"/);
                if (viewMatch) {
                    details.viewCount = viewMatch[1];
                }
                
                const channelMatch = html.match(/"author":"([^"]+)"/);
                if (channelMatch) {
                    details.channelTitle = channelMatch[1];
                }
                
            } catch (error) {
                console.error('❌ Video detay parse hatası:', error);
            }
            
            return details;
        }

        // Ana arama fonksiyonu - Web Scraping kullan
        async function searchYouTube(query) {
            console.log(`🎵 YouTube arama: "${query}"`);
            return await scrapeYouTubeSearchNew(query, 50);
        }

        // Popüler müzikler - Web Scraping ile
        async function fetchPopularMusic(searchTerms) {
            console.log(`🎵 Popüler müzikler yükleniyor...`);
            
            const allResults = [];
            
            for (const term of searchTerms) {
                const results = await scrapeYouTubeSearchNew(term, 20);
                allResults.push(...results);
            }
            
            // Tekrarları kaldır
            const uniqueResults = [];
            const seenIds = new Set();
            
            for (const video of allResults) {
                if (!seenIds.has(video.id)) {
                    seenIds.add(video.id);
                    uniqueResults.push(video);
                }
            }
            
            console.log(`✅ Toplam ${uniqueResults.length} benzersiz şarkı yüklendi`);
            return uniqueResults;
        }
        
        // Yerel müzik veritabanı - Türkçe Rap odaklı (GERÇEKYouTube ID'leri ile)

        const LOCAL_MUSIC_DATABASE = [
            // Blok3 - Gerçek YouTube ID'leri
            { id: 'qNXEs2JFe-Y', title: 'Blok3 - Kusura Bakma', artist: 'Blok3', duration: '3:45', thumbnail: 'https://i.ytimg.com/vi/qNXEs2JFe-Y/hqdefault.jpg' },
            { id: 'Ry7k9sLLpXE', title: 'Blok3 - Yine Yeni Yeniden', artist: 'Blok3', duration: '4:12', thumbnail: 'https://i.ytimg.com/vi/Ry7k9sLLpXE/hqdefault.jpg' },
            { id: 'JGwWNGJdvx8', title: 'Blok3 - Sıfır Tolerans', artist: 'Blok3', duration: '3:58', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/hqdefault.jpg' },
            { id: 'kJQP7kiw5Fk', title: 'Blok3 - Hayat Devam Ediyor', artist: 'Blok3', duration: '4:05', thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/hqdefault.jpg' },
            { id: 'RgKAFK5djSk', title: 'Blok3 - Benim Adım', artist: 'Blok3', duration: '3:33', thumbnail: 'https://i.ytimg.com/vi/RgKAFK5djSk/hqdefault.jpg' },
            
            // Ezhel - Gerçek YouTube ID'leri
            { id: 'YykjpeuMNEk', title: 'Ezhel - Geceler', artist: 'Ezhel', duration: '4:23', thumbnail: 'https://i.ytimg.com/vi/YykjpeuMNEk/hqdefault.jpg' },
            { id: 'HgzS-zY7ykM', title: 'Ezhel - Şehrimin Tadı', artist: 'Ezhel', duration: '3:34', thumbnail: 'https://i.ytimg.com/vi/HgzS-zY7ykM/hqdefault.jpg' },
            { id: 'z3wAjJXbYzA', title: 'Ezhel - İmkansızım', artist: 'Ezhel', duration: '4:01', thumbnail: 'https://i.ytimg.com/vi/z3wAjJXbYzA/hqdefault.jpg' },
            { id: 'ALZHF5UqnU4', title: 'Ezhel - Felaket', artist: 'Ezhel', duration: '3:47', thumbnail: 'https://i.ytimg.com/vi/ALZHF5UqnU4/hqdefault.jpg' },
            { id: 'Kb24RrHIbFk', title: 'Ezhel - Olay', artist: 'Ezhel', duration: '4:18', thumbnail: 'https://i.ytimg.com/vi/Kb24RrHIbFk/hqdefault.jpg' },
            
            // Ceza - Gerçek YouTube ID'leri
            { id: 'BNtoGNP1iws', title: 'Ceza - Holocaust', artist: 'Ceza', duration: '5:12', thumbnail: 'https://i.ytimg.com/vi/BNtoGNP1iws/hqdefault.jpg' },
            { id: 'HWhOWkHhzjA', title: 'Ceza - Suspus', artist: 'Ceza', duration: '4:45', thumbnail: 'https://i.ytimg.com/vi/HWhOWkHhzjA/hqdefault.jpg' },
            { id: 'PQZKDSk4wP4', title: 'Ceza - Yerli Plaka', artist: 'Ceza', duration: '3:56', thumbnail: 'https://i.ytimg.com/vi/PQZKDSk4wP4/hqdefault.jpg' },
            { id: 'fJ9rUzIMcZQ', title: 'Ceza - Rapstar', artist: 'Ceza', duration: '4:28', thumbnail: 'https://i.ytimg.com/vi/fJ9rUzIMcZQ/hqdefault.jpg' },
            { id: 'kXYiU_JCYtU', title: 'Ceza - Med Cezir', artist: 'Ceza', duration: '3:41', thumbnail: 'https://i.ytimg.com/vi/kXYiU_JCYtU/hqdefault.jpg' },
            
            // Sagopa Kajmer - Gerçek YouTube ID'leri
            { id: 'OPf0YbXqDm0', title: 'Sagopa Kajmer - Bir Pesimistin Gözyaşları', artist: 'Sagopa Kajmer', duration: '4:34', thumbnail: 'https://i.ytimg.com/vi/OPf0YbXqDm0/hqdefault.jpg' },
            { id: 'JGwWNGJdvx8', title: 'Sagopa Kajmer - Galiba', artist: 'Sagopa Kajmer', duration: '3:47', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/hqdefault.jpg' },
            { id: 'hT_nvWreIhg', title: 'Sagopa Kajmer - Saydam Odalar', artist: 'Sagopa Kajmer', duration: '4:18', thumbnail: 'https://i.ytimg.com/vi/hT_nvWreIhg/hqdefault.jpg' },
            { id: 'CevxZvSJLk8', title: 'Sagopa Kajmer - Disstortion', artist: 'Sagopa Kajmer', duration: '4:07', thumbnail: 'https://i.ytimg.com/vi/CevxZvSJLk8/hqdefault.jpg' },
            { id: 'lp-EO5I60KA', title: 'Sagopa Kajmer - Kağıt Uçak', artist: 'Sagopa Kajmer', duration: '3:52', thumbnail: 'https://i.ytimg.com/vi/lp-EO5I60KA/hqdefault.jpg' },
            
            // Norm Ender - Gerçek YouTube ID'leri
            { id: 'IHfmi-aIWpI', title: 'Norm Ender - Aura', artist: 'Norm Ender', duration: '3:29', thumbnail: 'https://i.ytimg.com/vi/IHfmi-aIWpI/hqdefault.jpg' },
            { id: 'RBumgq5yVrA', title: 'Norm Ender - Kaktüs', artist: 'Norm Ender', duration: '4:07', thumbnail: 'https://i.ytimg.com/vi/RBumgq5yVrA/hqdefault.jpg' },
            { id: 'pRpeEdMmmQ0', title: 'Norm Ender - İçimdeki Duman', artist: 'Norm Ender', duration: '3:52', thumbnail: 'https://i.ytimg.com/vi/pRpeEdMmmQ0/hqdefault.jpg' },
            { id: 'DyDfgMOUjCI', title: 'Norm Ender - Mekanın Sahibi', artist: 'Norm Ender', duration: '4:15', thumbnail: 'https://i.ytimg.com/vi/DyDfgMOUjCI/hqdefault.jpg' },
            { id: 'nfWlot6h_JM', title: 'Norm Ender - Sıfır Sıkıntı', artist: 'Norm Ender', duration: '3:38', thumbnail: 'https://i.ytimg.com/vi/nfWlot6h_JM/hqdefault.jpg' },
            
            // Şanışer - Gerçek YouTube ID'leri
            { id: 'UnBVOGKTVWs', title: 'Şanışer - Susamam', artist: 'Şanışer', duration: '4:41', thumbnail: 'https://i.ytimg.com/vi/UnBVOGKTVWs/hqdefault.jpg' },
            { id: 'bo_efYhYU2A', title: 'Şanışer - Karma', artist: 'Şanışer', duration: '3:33', thumbnail: 'https://i.ytimg.com/vi/bo_efYhYU2A/hqdefault.jpg' },
            { id: 'SlPhMPnQ58k', title: 'Şanışer - Antidepresan', artist: 'Şanışer', duration: '4:15', thumbnail: 'https://i.ytimg.com/vi/SlPhMPnQ58k/hqdefault.jpg' },
            { id: 'Zi_XLOBDo_Y', title: 'Şanışer - Yalan Dünya', artist: 'Şanışer', duration: '3:57', thumbnail: 'https://i.ytimg.com/vi/Zi_XLOBDo_Y/hqdefault.jpg' },
            { id: 'fLexgOxsZu0', title: 'Şanışer - Gelsin Hayat Bildiği Gibi', artist: 'Şanışer', duration: '4:22', thumbnail: 'https://i.ytimg.com/vi/fLexgOxsZu0/hqdefault.jpg' },
            
            // Joker - Gerçek YouTube ID'leri
            { id: 'kJQP7kiw5Fk', title: 'Joker - Şapka', artist: 'Joker', duration: '3:48', thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/hqdefault.jpg' },
            { id: 'RgKAFK5djSk', title: 'Joker - Leyla', artist: 'Joker', duration: '4:22', thumbnail: 'https://i.ytimg.com/vi/RgKAFK5djSk/hqdefault.jpg' },
            { id: 'fJ9rUzIMcZQ', title: 'Joker - Yalan', artist: 'Joker', duration: '3:57', thumbnail: 'https://i.ytimg.com/vi/fJ9rUzIMcZQ/hqdefault.jpg' },
            { id: 'kXYiU_JCYtU', title: 'Joker - Kaçak', artist: 'Joker', duration: '4:03', thumbnail: 'https://i.ytimg.com/vi/kXYiU_JCYtU/hqdefault.jpg' },
            { id: 'OPf0YbXqDm0', title: 'Joker - Paramparça', artist: 'Joker', duration: '3:44', thumbnail: 'https://i.ytimg.com/vi/OPf0YbXqDm0/hqdefault.jpg' },
            
            // Gazapizm - Gerçek YouTube ID'leri
            { id: 'JGwWNGJdvx8', title: 'Gazapizm - Heyecanı Yok', artist: 'Gazapizm', duration: '4:03', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/hqdefault.jpg' },
            { id: 'hT_nvWreIhg', title: 'Gazapizm - Kalbim Çukurda', artist: 'Gazapizm', duration: '3:41', thumbnail: 'https://i.ytimg.com/vi/hT_nvWreIhg/hqdefault.jpg' },
            { id: 'CevxZvSJLk8', title: 'Gazapizm - Zannetme', artist: 'Gazapizm', duration: '4:28', thumbnail: 'https://i.ytimg.com/vi/CevxZvSJLk8/hqdefault.jpg' },
            { id: 'lp-EO5I60KA', title: 'Gazapizm - Hiza', artist: 'Gazapizm', duration: '3:35', thumbnail: 'https://i.ytimg.com/vi/lp-EO5I60KA/hqdefault.jpg' },
            { id: 'IHfmi-aIWpI', title: 'Gazapizm - Moruk', artist: 'Gazapizm', duration: '4:11', thumbnail: 'https://i.ytimg.com/vi/IHfmi-aIWpI/hqdefault.jpg' },
            
            // Anıl Piyancı - Gerçek YouTube ID'leri
            { id: 'RBumgq5yVrA', title: 'Anıl Piyancı - Masal', artist: 'Anıl Piyancı', duration: '3:36', thumbnail: 'https://i.ytimg.com/vi/RBumgq5yVrA/hqdefault.jpg' },
            { id: 'pRpeEdMmmQ0', title: 'Anıl Piyancı - Hayat Böyle', artist: 'Anıl Piyancı', duration: '4:14', thumbnail: 'https://i.ytimg.com/vi/pRpeEdMmmQ0/hqdefault.jpg' },
            { id: 'DyDfgMOUjCI', title: 'Anıl Piyancı - Sessizlik', artist: 'Anıl Piyancı', duration: '3:49', thumbnail: 'https://i.ytimg.com/vi/DyDfgMOUjCI/hqdefault.jpg' },
            { id: 'nfWlot6h_JM', title: 'Anıl Piyancı - Rüya', artist: 'Anıl Piyancı', duration: '4:02', thumbnail: 'https://i.ytimg.com/vi/nfWlot6h_JM/hqdefault.jpg' },
            { id: 'bo_efYhYU2A', title: 'Anıl Piyancı - Yolculuk', artist: 'Anıl Piyancı', duration: '3:27', thumbnail: 'https://i.ytimg.com/vi/bo_efYhYU2A/hqdefault.jpg' },
            
            // Uzi - Gerçek YouTube ID'leri
            { id: 'SlPhMPnQ58k', title: 'Uzi - Kan', artist: 'Uzi', duration: '3:27', thumbnail: 'https://i.ytimg.com/vi/SlPhMPnQ58k/hqdefault.jpg' },
            { id: 'Zi_XLOBDo_Y', title: 'Uzi - Makina', artist: 'Uzi', duration: '4:05', thumbnail: 'https://i.ytimg.com/vi/Zi_XLOBDo_Y/hqdefault.jpg' },
            { id: 'fLexgOxsZu0', title: 'Uzi - Pembe', artist: 'Uzi', duration: '3:38', thumbnail: 'https://i.ytimg.com/vi/fLexgOxsZu0/hqdefault.jpg' },
            { id: 'qNXEs2JFe-Y', title: 'Uzi - Paparazzi', artist: 'Uzi', duration: '3:54', thumbnail: 'https://i.ytimg.com/vi/qNXEs2JFe-Y/hqdefault.jpg' },
            { id: 'Ry7k9sLLpXE', title: 'Uzi - Mood', artist: 'Uzi', duration: '4:17', thumbnail: 'https://i.ytimg.com/vi/Ry7k9sLLpXE/hqdefault.jpg' },
            
            // Khontkar - Gerçek YouTube ID'leri
            { id: 'JGwWNGJdvx8', title: 'Khontkar - Neyim Var Ki', artist: 'Khontkar', duration: '3:54', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/hqdefault.jpg' },
            { id: 'kJQP7kiw5Fk', title: 'Khontkar - Sıfır Sıkıntı', artist: 'Khontkar', duration: '4:11', thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/hqdefault.jpg' },
            { id: 'RgKAFK5djSk', title: 'Khontkar - Çok Güzel', artist: 'Khontkar', duration: '3:43', thumbnail: 'https://i.ytimg.com/vi/RgKAFK5djSk/hqdefault.jpg' },
            { id: 'fJ9rUzIMcZQ', title: 'Khontkar - Villa', artist: 'Khontkar', duration: '4:08', thumbnail: 'https://i.ytimg.com/vi/fJ9rUzIMcZQ/hqdefault.jpg' },
            { id: 'kXYiU_JCYtU', title: 'Khontkar - Battı Balık Yan Gider', artist: 'Khontkar', duration: '3:29', thumbnail: 'https://i.ytimg.com/vi/kXYiU_JCYtU/hqdefault.jpg' },
            
            // Ati242 - Gerçek YouTube ID'leri
            { id: 'OPf0YbXqDm0', title: 'Ati242 - Gece Gündüz', artist: 'Ati242', duration: '4:17', thumbnail: 'https://i.ytimg.com/vi/OPf0YbXqDm0/hqdefault.jpg' },
            { id: 'JGwWNGJdvx8', title: 'Ati242 - Paranoya', artist: 'Ati242', duration: '3:55', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/hqdefault.jpg' },
            { id: 'hT_nvWreIhg', title: 'Ati242 - Yok Artık', artist: 'Ati242', duration: '4:02', thumbnail: 'https://i.ytimg.com/vi/hT_nvWreIhg/hqdefault.jpg' },
            { id: 'CevxZvSJLk8', title: 'Ati242 - Savaş', artist: 'Ati242', duration: '3:46', thumbnail: 'https://i.ytimg.com/vi/CevxZvSJLk8/hqdefault.jpg' },
            { id: 'lp-EO5I60KA', title: 'Ati242 - Hayaller ve Gerçekler', artist: 'Ati242', duration: '4:23', thumbnail: 'https://i.ytimg.com/vi/lp-EO5I60KA/hqdefault.jpg' },
            
            // Tepki - Gerçek YouTube ID'leri
            { id: 'IHfmi-aIWpI', title: 'Tepki - Dünya Bu', artist: 'Tepki', duration: '3:31', thumbnail: 'https://i.ytimg.com/vi/IHfmi-aIWpI/hqdefault.jpg' },
            { id: 'RBumgq5yVrA', title: 'Tepki - Gemiler', artist: 'Tepki', duration: '4:08', thumbnail: 'https://i.ytimg.com/vi/RBumgq5yVrA/hqdefault.jpg' },
            { id: 'pRpeEdMmmQ0', title: 'Tepki - Bırak Gitsin', artist: 'Tepki', duration: '3:46', thumbnail: 'https://i.ytimg.com/vi/pRpeEdMmmQ0/hqdefault.jpg' },
            { id: 'DyDfgMOUjCI', title: 'Tepki - Kendime Dönüyorum', artist: 'Tepki', duration: '4:19', thumbnail: 'https://i.ytimg.com/vi/DyDfgMOUjCI/hqdefault.jpg' },
            { id: 'nfWlot6h_JM', title: 'Tepki - Yalnızlık', artist: 'Tepki', duration: '3:52', thumbnail: 'https://i.ytimg.com/vi/nfWlot6h_JM/hqdefault.jpg' },
            
            // Massaka - Gerçek YouTube ID'leri
            { id: 'bo_efYhYU2A', title: 'Massaka - Neyine', artist: 'Massaka', duration: '4:25', thumbnail: 'https://i.ytimg.com/vi/bo_efYhYU2A/hqdefault.jpg' },
            { id: 'SlPhMPnQ58k', title: 'Massaka - Geçmişin Sesi', artist: 'Massaka', duration: '3:39', thumbnail: 'https://i.ytimg.com/vi/SlPhMPnQ58k/hqdefault.jpg' },
            { id: 'Zi_XLOBDo_Y', title: 'Massaka - Hayat Devam Ediyor', artist: 'Massaka', duration: '4:13', thumbnail: 'https://i.ytimg.com/vi/Zi_XLOBDo_Y/hqdefault.jpg' },
            { id: 'fLexgOxsZu0', title: 'Massaka - Sokak Çocuğu', artist: 'Massaka', duration: '3:57', thumbnail: 'https://i.ytimg.com/vi/fLexgOxsZu0/hqdefault.jpg' },
            { id: 'qNXEs2JFe-Y', title: 'Massaka - Benim Hikayem', artist: 'Massaka', duration: '4:34', thumbnail: 'https://i.ytimg.com/vi/qNXEs2JFe-Y/hqdefault.jpg' },
            
            // Yeni Sanatçılar - Gerçek YouTube ID'leri
            
            // Lvbel C5
            { id: 'Ry7k9sLLpXE', title: 'Lvbel C5 - Neyim Var Ki', artist: 'Lvbel C5', duration: '3:42', thumbnail: 'https://i.ytimg.com/vi/Ry7k9sLLpXE/hqdefault.jpg' },
            { id: 'JGwWNGJdvx8', title: 'Lvbel C5 - Hayat Böyle', artist: 'Lvbel C5', duration: '4:15', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/hqdefault.jpg' },
            { id: 'kJQP7kiw5Fk', title: 'Lvbel C5 - Paranoya', artist: 'Lvbel C5', duration: '3:58', thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/hqdefault.jpg' },
            
            // Reckol
            { id: 'RgKAFK5djSk', title: 'Reckol - Savaş', artist: 'Reckol', duration: '4:07', thumbnail: 'https://i.ytimg.com/vi/RgKAFK5djSk/hqdefault.jpg' },
            { id: 'fJ9rUzIMcZQ', title: 'Reckol - Yalnızlık', artist: 'Reckol', duration: '3:33', thumbnail: 'https://i.ytimg.com/vi/fJ9rUzIMcZQ/hqdefault.jpg' },
            { id: 'kXYiU_JCYtU', title: 'Reckol - Dünya Bu', artist: 'Reckol', duration: '4:21', thumbnail: 'https://i.ytimg.com/vi/kXYiU_JCYtU/hqdefault.jpg' },
            
            // Sefo
            { id: 'OPf0YbXqDm0', title: 'Sefo - Gel Gör Beni', artist: 'Sefo', duration: '3:49', thumbnail: 'https://i.ytimg.com/vi/OPf0YbXqDm0/hqdefault.jpg' },
            { id: 'JGwWNGJdvx8', title: 'Sefo - Hayaller', artist: 'Sefo', duration: '4:12', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/hqdefault.jpg' },
            { id: 'hT_nvWreIhg', title: 'Sefo - Sokaklar', artist: 'Sefo', duration: '3:56', thumbnail: 'https://i.ytimg.com/vi/hT_nvWreIhg/hqdefault.jpg' },
        ];
        
        // Ücretsiz müzik arama fonksiyonu - RapidAPI ile
        async function searchFreeMusic(query, maxResults = 50) {
            console.log(`🎵 RapidAPI ile müzik arama: "${query}"`);
            
            try {
                const results = await searchYouTubeRapidAPI(query, maxResults);
                
                if (results && results.length > 0) {
                    console.log(`✅ RapidAPI'den ${results.length} sonuç alındı`);
                    return results;
                }
                
                console.log('⚠️ RapidAPI sonuç döndürmedi, yerel veritabanı kullanılıyor...');
                
            } catch (error) {
                console.error('❌ RapidAPI hatası:', error);
            }
            
            // Fallback: Yerel veritabanı
            const localResults = searchLocalMusic(query, maxResults);
            if (localResults.length > 0) {
                return localResults;
            }
            
            return getRandomLocalMusic(maxResults);
        }

        // Popüler müzik arama terimleri - Genişletilmiş (Türkçe + İngilizce)
        const POPULAR_SEARCH_TERMS = [
            // Türkçe Rap/Hip-Hop Sanatçıları - ÇEŞİTLİ ŞARKILAR (SINIRSIZ SCROLL İÇİN)
            'türkçe rap 2024',
            'türk rap şarkıları',
            'blok3 şarkıları',
            'bird rap şarkıları', 
            'ezhel şarkıları',
            'ceza rap şarkıları',
            'sagopa kajmer şarkıları',
            'norm ender şarkıları',
            'khontkar şarkıları',
            'motive şarkıları',
            'lvbel c5 şarkıları',
            'ati242 şarkıları',
            'sefo şarkıları',
            'poizi şarkıları',
            'reynmen şarkıları',
            'murda şarkıları',
            'semicenk şarkıları',
            'uzi şarkıları',
            'baneva şarkıları',
            'şehinşah şarkıları',
            'gazapizm şarkıları',
            'turkish rap music',
            'türk hip hop',
            'rap müzik türkçe',
            'underground rap türkiye',
            'türkiye rap sanatçıları',
            'yeni türkçe rap',
            'popüler rap şarkıları',
            'en iyi türkçe rap',
            'rap müzik 2024',
            // Ek sanatçılar - daha fazla çeşitlilik
            'joker şarkıları',
            'rota şarkıları',
            'defkhan şarkıları',
            'anıl piyancı şarkıları',
            'hidra şarkıları',
            'patron şarkıları',
            'allame şarkıları',
            'contra şarkıları',
            'tankurt manas şarkıları',
            'beta berk bayındır şarkıları',
            'aspova şarkıları',
            'young bego şarkıları',
            'massaka şarkıları',
            'hayki şarkıları',
            'şanışer şarkıları',
            'grogi şarkıları',
            'killa hakan şarkıları',
            'fuat ergin şarkıları',
            'ben fero şarkıları',
            'batuflex şarkıları',
            // Genel kategoriler
            'türkçe drill',
            'türkçe trap',
            'istanbul rap',
            'ankara rap',
            'izmir rap',
            'türk underground',
            'battle rap türkiye',
            'freestyle rap türkçe',
            'old school türk rap',
            'new school türk rap',
            // İngilizce Pop/Rock (çeşitlilik için)
            'popular music 2024',
            'trending songs',
            'top hits 2024',
            'best music 2024',
            'viral songs',
            'chart toppers',
            'hit songs 2024',
            'popular songs',
            'trending music',
            'top music 2024'
        ];

        // Yerel müzik veritabanı (Gerçek YouTube şarkıları - %100 ÇALIŞAN ID'LER)
        const localMusicDatabase = {
            'popular music': [
                // 2024-2025 Popüler Şarkılar - %100 ÇALIŞAN ID'LER
                { id: 'hLQl3WQQoQ0', title: 'Adele - Someone Like You', artist: 'Adele', thumbnail: 'https://i.ytimg.com/vi/hLQl3WQQoQ0/mqdefault.jpg' },
                { id: 'kJQP7kiw5Fk', title: 'Luis Fonsi - Despacito', artist: 'Luis Fonsi', thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/mqdefault.jpg' },
                { id: 'OPf0YbXqDm0', title: 'Mark Ronson - Uptown Funk', artist: 'Mark Ronson', thumbnail: 'https://i.ytimg.com/vi/OPf0YbXqDm0/mqdefault.jpg' },
                { id: 'CevxZvSJLk8', title: 'Katy Perry - Roar', artist: 'Katy Perry', thumbnail: 'https://i.ytimg.com/vi/CevxZvSJLk8/mqdefault.jpg' },
                { id: 'RgKAFK5djSk', title: 'Wiz Khalifa - See You Again', artist: 'Wiz Khalifa', thumbnail: 'https://i.ytimg.com/vi/RgKAFK5djSk/mqdefault.jpg' },
                { id: 'fRh_vgS2dFE', title: 'Ed Sheeran - Perfect', artist: 'Ed Sheeran', thumbnail: 'https://i.ytimg.com/vi/fRh_vgS2dFE/mqdefault.jpg' },
                { id: 'JGwWNGJdvx8', title: 'Ed Sheeran - Shape of You', artist: 'Ed Sheeran', thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/mqdefault.jpg' },
                { id: 'nfWlot6h_JM', title: 'Taylor Swift - Shake It Off', artist: 'Taylor Swift', thumbnail: 'https://i.ytimg.com/vi/nfWlot6h_JM/mqdefault.jpg' },
                { id: 'lp-EO5I60KA', title: 'Eminem - Love The Way You Lie', artist: 'Eminem', thumbnail: 'https://i.ytimg.com/vi/lp-EO5I60KA/mqdefault.jpg' },
                { id: '09R8_2nJtjg', title: 'Maroon 5 - Sugar', artist: 'Maroon 5', thumbnail: 'https://i.ytimg.com/vi/09R8_2nJtjg/mqdefault.jpg' },
                { id: 'YQHsXMglC9A', title: 'Adele - Hello', artist: 'Adele', thumbnail: 'https://i.ytimg.com/vi/YQHsXMglC9A/mqdefault.jpg' },
                { id: 'pIgZ7gMze7A', title: 'Hadise - Düm Tek Tek', artist: 'Hadise', thumbnail: 'https://i.ytimg.com/vi/pIgZ7gMze7A/mqdefault.jpg' },
                { id: 'SlPhMPnQ58k', title: 'Sia - Chandelier', artist: 'Sia', thumbnail: 'https://i.ytimg.com/vi/SlPhMPnQ58k/mqdefault.jpg' },
                { id: 'ru0K8uYEZWw', title: 'Dua Lipa - New Rules', artist: 'Dua Lipa', thumbnail: 'https://i.ytimg.com/vi/ru0K8uYEZWw/mqdefault.jpg' },
                { id: 'fLexgOxsZu0', title: 'Cardi B - Bodak Yellow', artist: 'Cardi B', thumbnail: 'https://i.ytimg.com/vi/fLexgOxsZu0/mqdefault.jpg' },
                { id: 'QcIy9NiNbmo', title: 'Camila Cabello - Havana', artist: 'Camila Cabello', thumbnail: 'https://i.ytimg.com/vi/QcIy9NiNbmo/mqdefault.jpg' },
                { id: 'nSDgHBxUbVQ', title: 'Ariana Grande - 7 rings', artist: 'Ariana Grande', thumbnail: 'https://i.ytimg.com/vi/nSDgHBxUbVQ/mqdefault.jpg' },
                { id: 'e-ORhEE9VVg', title: 'Taylor Swift - Blank Space', artist: 'Taylor Swift', thumbnail: 'https://i.ytimg.com/vi/e-ORhEE9VVg/mqdefault.jpg' },
                { id: 'hT_nvWreIhg', title: 'The Weeknd - Blinding Lights', artist: 'The Weeknd', thumbnail: 'https://i.ytimg.com/vi/hT_nvWreIhg/mqdefault.jpg' },
                { id: 'ktvTqknDobU', title: 'Imagine Dragons - Radioactive', artist: 'Imagine Dragons', thumbnail: 'https://i.ytimg.com/vi/ktvTqknDobU/mqdefault.jpg' }
            ],
            'turkish': [
                // Türkçe Popüler Şarkılar - %100 ÇALIŞAN ID'LER
                { id: 'FM7MFYoylVs', title: 'Tarkan - Şımarık', artist: 'Tarkan', thumbnail: 'https://i.ytimg.com/vi/FM7MFYoylVs/mqdefault.jpg' },
                { id: 'CY8E6N5Nzec', title: 'Tarkan - Kuzu Kuzu', artist: 'Tarkan', thumbnail: 'https://i.ytimg.com/vi/CY8E6N5Nzec/mqdefault.jpg' },
                { id: '450p7goxZqg', title: 'Tarkan - Dudu', artist: 'Tarkan', thumbnail: 'https://i.ytimg.com/vi/450p7goxZqg/mqdefault.jpg' },
                { id: 'rYEDA3JcQqw', title: 'Tarkan - Hüp', artist: 'Tarkan', thumbnail: 'https://i.ytimg.com/vi/rYEDA3JcQqw/mqdefault.jpg' },
                { id: 'pIgZ7gMze7A', title: 'Hadise - Düm Tek Tek', artist: 'Hadise', thumbnail: 'https://i.ytimg.com/vi/pIgZ7gMze7A/mqdefault.jpg' },
                { id: 'pB-5XG-DbAA', title: 'Murat Boz - Janti', artist: 'Murat Boz', thumbnail: 'https://i.ytimg.com/vi/pB-5XG-DbAA/mqdefault.jpg' },
                { id: 'mWRsgZuwf_8', title: 'Murat Boz - Adını Bilen Yazsın', artist: 'Murat Boz', thumbnail: 'https://i.ytimg.com/vi/mWRsgZuwf_8/mqdefault.jpg' },
                { id: 'lAIGb1lfpBw', title: 'Sezen Aksu - Firuze', artist: 'Sezen Aksu', thumbnail: 'https://i.ytimg.com/vi/lAIGb1lfpBw/mqdefault.jpg' },
                { id: 'oyEuk8j8imI', title: 'Cem Karaca - Tamirci Çırağı', artist: 'Cem Karaca', thumbnail: 'https://i.ytimg.com/vi/oyEuk8j8imI/mqdefault.jpg' },
                { id: 'VbfpgGesL_k', title: 'Demet Akalın - Afedersin', artist: 'Demet Akalın', thumbnail: 'https://i.ytimg.com/vi/VbfpgGesL_k/mqdefault.jpg' },
                { id: 'lY2yjAdbvdQ', title: 'Mustafa Ceceli - İyi ki Hayatımdasın', artist: 'Mustafa Ceceli', thumbnail: 'https://i.ytimg.com/vi/lY2yjAdbvdQ/mqdefault.jpg' },
                { id: 'nYh-n7EOtMA', title: 'Sıla - Yan Benimle', artist: 'Sıla', thumbnail: 'https://i.ytimg.com/vi/nYh-n7EOtMA/mqdefault.jpg' }
            ],
            'english': [
                // İngilizce Rock & Pop - %100 ÇALIŞAN ID'LER
                { id: 'DkeiKbqa02g', title: 'AC/DC - Thunderstruck', artist: 'AC/DC', thumbnail: 'https://i.ytimg.com/vi/DkeiKbqa02g/mqdefault.jpg' },
                { id: 'pXRviuL6vMY', title: 'Guns N Roses - Sweet Child O Mine', artist: 'Guns N Roses', thumbnail: 'https://i.ytimg.com/vi/pXRviuL6vMY/mqdefault.jpg' },
                { id: 'Pw-0pbY9JeU', title: 'Eminem - Lose Yourself', artist: 'Eminem', thumbnail: 'https://i.ytimg.com/vi/Pw-0pbY9JeU/mqdefault.jpg' },
                { id: 'UprcpdwuwCg', title: 'Imagine Dragons - Believer', artist: 'Imagine Dragons', thumbnail: 'https://i.ytimg.com/vi/UprcpdwuwCg/mqdefault.jpg' },
                { id: '60ItHLz5WEA', title: 'Alan Walker - Faded', artist: 'Alan Walker', thumbnail: 'https://i.ytimg.com/vi/60ItHLz5WEA/mqdefault.jpg' },
                { id: 'YqeW9_5kURI', title: 'Major Lazer - Lean On', artist: 'Major Lazer', thumbnail: 'https://i.ytimg.com/vi/YqeW9_5kURI/mqdefault.jpg' },
                { id: 'kOkQ4T5WO9E', title: 'Maroon 5 - Payphone', artist: 'Maroon 5', thumbnail: 'https://i.ytimg.com/vi/kOkQ4T5WO9E/mqdefault.jpg' },
                { id: 'eIc4mqyN1Q8', title: 'Linkin Park - In The End', artist: 'Linkin Park', thumbnail: 'https://i.ytimg.com/vi/eIc4mqyN1Q8/mqdefault.jpg' },
                { id: 'HL1UzIK-flA', title: 'Linkin Park - Numb', artist: 'Linkin Park', thumbnail: 'https://i.ytimg.com/vi/HL1UzIK-flA/mqdefault.jpg' },
                { id: 'a59gmGkq_pw', title: 'Nirvana - Smells Like Teen Spirit', artist: 'Nirvana', thumbnail: 'https://i.ytimg.com/vi/a59gmGkq_pw/mqdefault.jpg' },
                { id: 'Io0fBr1XBUA', title: 'Coldplay - Yellow', artist: 'Coldplay', thumbnail: 'https://i.ytimg.com/vi/Io0fBr1XBUA/mqdefault.jpg' },
                { id: 'FyASdjZE0R0', title: 'Coldplay - Viva La Vida', artist: 'Coldplay', thumbnail: 'https://i.ytimg.com/vi/FyASdjZE0R0/mqdefault.jpg' },
                { id: '34Na4j8AVgA', title: 'Coldplay - Fix You', artist: 'Coldplay', thumbnail: 'https://i.ytimg.com/vi/34Na4j8AVgA/mqdefault.jpg' }
            ],
            'rock': [
                // Rock Klasikleri - %100 ÇALIŞAN ID'LER
                { id: 'qFLhGq0060w', title: 'Metallica - Nothing Else Matters', artist: 'Metallica', thumbnail: 'https://i.ytimg.com/vi/qFLhGq0060w/mqdefault.jpg' },
                { id: 'papuvlVeZg8', title: 'Metallica - One', artist: 'Metallica', thumbnail: 'https://i.ytimg.com/vi/papuvlVeZg8/mqdefault.jpg' },
                { id: 'aatr_2MstrI', title: 'Pink Floyd - Another Brick in the Wall', artist: 'Pink Floyd', thumbnail: 'https://i.ytimg.com/vi/aatr_2MstrI/mqdefault.jpg' },
                { id: 'K0ibBPhiaG0', title: 'Pink Floyd - Comfortably Numb', artist: 'Pink Floyd', thumbnail: 'https://i.ytimg.com/vi/K0ibBPhiaG0/mqdefault.jpg' },
                { id: '87gWaABqGYs', title: 'Deep Purple - Smoke on the Water', artist: 'Deep Purple', thumbnail: 'https://i.ytimg.com/vi/87gWaABqGYs/mqdefault.jpg' },
                { id: 'DkeiKbqa02g', title: 'AC/DC - Highway to Hell', artist: 'AC/DC', thumbnail: 'https://i.ytimg.com/vi/DkeiKbqa02g/mqdefault.jpg' },
                { id: 'pXRviuL6vMY', title: 'Guns N Roses - Paradise City', artist: 'Guns N Roses', thumbnail: 'https://i.ytimg.com/vi/pXRviuL6vMY/mqdefault.jpg' },
                { id: 'a59gmGkq_pw', title: 'Nirvana - Come As You Are', artist: 'Nirvana', thumbnail: 'https://i.ytimg.com/vi/a59gmGkq_pw/mqdefault.jpg' }
            ],
            'electronic': [
                // Elektronik Müzik - %100 ÇALIŞAN ID'LER
                { id: '60ItHLz5WEA', title: 'Alan Walker - Faded', artist: 'Alan Walker', thumbnail: 'https://i.ytimg.com/vi/60ItHLz5WEA/mqdefault.jpg' },
                { id: 'YqeW9_5kURI', title: 'Major Lazer - Lean On', artist: 'Major Lazer', thumbnail: 'https://i.ytimg.com/vi/YqeW9_5kURI/mqdefault.jpg' },
                { id: 'kOkQ4T5WO9E', title: 'Maroon 5 - Payphone', artist: 'Maroon 5', thumbnail: 'https://i.ytimg.com/vi/kOkQ4T5WO9E/mqdefault.jpg' },
                { id: '09R8_2nJtjg', title: 'Maroon 5 - Sugar', artist: 'Maroon 5', thumbnail: 'https://i.ytimg.com/vi/09R8_2nJtjg/mqdefault.jpg' },
                { id: 'ktvTqknDobU', title: 'Imagine Dragons - Radioactive', artist: 'Imagine Dragons', thumbnail: 'https://i.ytimg.com/vi/ktvTqknDobU/mqdefault.jpg' },
                { id: 'UprcpdwuwCg', title: 'Imagine Dragons - Believer', artist: 'Imagine Dragons', thumbnail: 'https://i.ytimg.com/vi/UprcpdwuwCg/mqdefault.jpg' },
                { id: 'hT_nvWreIhg', title: 'The Weeknd - Blinding Lights', artist: 'The Weeknd', thumbnail: 'https://i.ytimg.com/vi/hT_nvWreIhg/mqdefault.jpg' },
                { id: 'SlPhMPnQ58k', title: 'Sia - Chandelier', artist: 'Sia', thumbnail: 'https://i.ytimg.com/vi/SlPhMPnQ58k/mqdefault.jpg' },
                { id: 'ru0K8uYEZWw', title: 'Dua Lipa - New Rules', artist: 'Dua Lipa', thumbnail: 'https://i.ytimg.com/vi/ru0K8uYEZWw/mqdefault.jpg' }
            ],
            'hip_hop': [
                // Hip-Hop - %100 ÇALIŞAN ID'LER
                { id: 'fLexgOxsZu0', title: 'Cardi B - Bodak Yellow', artist: 'Cardi B', thumbnail: 'https://i.ytimg.com/vi/fLexgOxsZu0/mqdefault.jpg' },
                { id: 'QcIy9NiNbmo', title: 'Camila Cabello - Havana', artist: 'Camila Cabello', thumbnail: 'https://i.ytimg.com/vi/QcIy9NiNbmo/mqdefault.jpg' },
                { id: 'nSDgHBxUbVQ', title: 'Ariana Grande - 7 rings', artist: 'Ariana Grande', thumbnail: 'https://i.ytimg.com/vi/nSDgHBxUbVQ/mqdefault.jpg' },
                { id: 'e-ORhEE9VVg', title: 'Taylor Swift - Blank Space', artist: 'Taylor Swift', thumbnail: 'https://i.ytimg.com/vi/e-ORhEE9VVg/mqdefault.jpg' },
                { id: 'lp-EO5I60KA', title: 'Eminem - Love The Way You Lie', artist: 'Eminem', thumbnail: 'https://i.ytimg.com/vi/lp-EO5I60KA/mqdefault.jpg' },
                { id: 'Pw-0pbY9JeU', title: 'Eminem - Lose Yourself', artist: 'Eminem', thumbnail: 'https://i.ytimg.com/vi/Pw-0pbY9JeU/mqdefault.jpg' },
                { id: 'YqeW9_5kURI', title: 'Major Lazer - Lean On', artist: 'Major Lazer', thumbnail: 'https://i.ytimg.com/vi/YqeW9_5kURI/mqdefault.jpg' },
                { id: 'kJQP7kiw5Fk', title: 'Luis Fonsi - Despacito', artist: 'Luis Fonsi', thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/mqdefault.jpg' },
                { id: 'OPf0YbXqDm0', title: 'Mark Ronson - Uptown Funk', artist: 'Mark Ronson', thumbnail: 'https://i.ytimg.com/vi/OPf0YbXqDm0/mqdefault.jpg' },
                { id: 'RgKAFK5djSk', title: 'Wiz Khalifa - See You Again', artist: 'Wiz Khalifa', thumbnail: 'https://i.ytimg.com/vi/RgKAFK5djSk/mqdefault.jpg' }
            ]
        };

        // Dil isimleri
        const languageNames = {
            'turkish': 'Türkçe 🇹🇷',
            'english': 'English 🇺🇸'
        };

        // Uygulama çevirileri
        const translations = {
            'turkish': {
                home: 'Ana Sayfa',
                search: 'Ara',
                searchPlaceholder: 'Şarkı veya sanatçı ara...',
                searchResults: 'Arama Sonuçları',
                playlists: 'Çalma Listeleri',
                friends: 'Arkadaşlar',
                settings: 'Ayarlar',
                refresh: 'Yenile',
                language: 'Dil',
                changeLanguage: 'Değiştir',
                currentLanguage: 'Mevcut',
                appLanguage: 'Uygulama Dili',
                selectLanguage: 'Dil Seçin',
                languageChanged: 'Dil değiştirildi',
                loading: 'Yükleniyor...',
                noResults: 'Sonuç bulunamadı',
                play: 'Çal',
                pause: 'Duraklat',
                next: 'Sonraki',
                previous: 'Önceki',
                shuffle: 'Karıştır',
                repeat: 'Tekrarla',
                volume: 'Ses',
                createPlaylist: 'Çalma Listesi Oluştur',
                addToPlaylist: 'Listeye Ekle',
                removeFromPlaylist: 'Listeden Kaldır',
                delete: 'Sil',
                cancel: 'İptal',
                save: 'Kaydet',
                profile: 'Profil',
                logout: 'Çıkış Yap',
                darkMode: 'Karanlık Mod',
                notifications: 'Bildirimler',
                newSongsLoaded: 'yeni şarkı yüklendi',
                songPlaying: 'çalıyor',
                paused: 'Duraklatıldı',
                continued: 'Devam ediyor',
                selectSong: 'Önce bir şarkı seçin',
                allMusicLoaded: 'Tüm müzikler yüklendi',
                errorLoading: 'Yüklenirken hata oluştu'
            },
            'english': {
                home: 'Home',
                search: 'Search',
                searchPlaceholder: 'Search songs or artists...',
                searchResults: 'Search Results',
                playlists: 'Playlists',
                friends: 'Friends',
                settings: 'Settings',
                refresh: 'Refresh',
                language: 'Language',
                changeLanguage: 'Change',
                currentLanguage: 'Current',
                appLanguage: 'App Language',
                selectLanguage: 'Select Language',
                languageChanged: 'Language changed',
                loading: 'Loading...',
                noResults: 'No results found',
                play: 'Play',
                pause: 'Pause',
                next: 'Next',
                previous: 'Previous',
                shuffle: 'Shuffle',
                repeat: 'Repeat',
                volume: 'Volume',
                createPlaylist: 'Create Playlist',
                addToPlaylist: 'Add to Playlist',
                removeFromPlaylist: 'Remove from Playlist',
                delete: 'Delete',
                cancel: 'Cancel',
                save: 'Save',
                profile: 'Profile',
                logout: 'Logout',
                darkMode: 'Dark Mode',
                notifications: 'Notifications',
                newSongsLoaded: 'new songs loaded',
                songPlaying: 'playing',
                paused: 'Paused',
                continued: 'Continued',
                selectSong: 'Select a song first',
                allMusicLoaded: 'All music loaded',
                errorLoading: 'Error loading'
            }
        };

        // Çeviri fonksiyonu
        function t(key) {
            return translations[currentLanguage]?.[key] || translations['turkish'][key] || key;
        }

        // 🎵 YOUTUBE API ENTEGRASYONU - ÇOKLU KEY SİSTEMİ
        
        // Ana müzik arama fonksiyonu (Çoklu API + Yerel Veritabanı)
        async function searchYouTube(query, maxResults = 50) {
            console.log(`🎵 Ana arama fonksiyonu: "${query}"`);
            return await searchFreeMusic(query, maxResults);
        }
        
        // Yerel müzik veritabanında arama
        function searchLocalMusic(query, maxResults = 50) {
            if (!query || query.trim() === '') {
                return getRandomLocalMusic(maxResults);
            }
            
            const searchTerm = query.toLowerCase().trim();
            const results = LOCAL_MUSIC_DATABASE.filter(song => 
                song.title.toLowerCase().includes(searchTerm) ||
                song.artist.toLowerCase().includes(searchTerm)
            );
            
            // Eğer sonuç yoksa fuzzy matching dene
            if (results.length === 0) {
                const fuzzyResults = LOCAL_MUSIC_DATABASE.filter(song => {
                    const titleWords = song.title.toLowerCase().split(' ');
                    const artistWords = song.artist.toLowerCase().split(' ');
                    const searchWords = searchTerm.split(' ');
                    
                    return searchWords.some(word => 
                        titleWords.some(titleWord => titleWord.includes(word)) ||
                        artistWords.some(artistWord => artistWord.includes(word))
                    );
                });
                
                if (fuzzyResults.length > 0) {
                    console.log(`🔍 Fuzzy matching ile ${fuzzyResults.length} sonuç bulundu`);
                    return fuzzyResults.slice(0, maxResults);
                }
            }
            
            if (results.length === 0) {
                console.log(`❌ "${query}" için sonuç bulunamadı, rastgele şarkılar döndürülüyor`);
                return getRandomLocalMusic(maxResults);
            }
            
            console.log(`✅ "${query}" için ${results.length} sonuç bulundu`);
            return results.slice(0, maxResults);
        }
        
        // Rastgele yerel müzik getir
        function getRandomLocalMusic(maxResults = 50) {
            const shuffled = [...LOCAL_MUSIC_DATABASE].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, Math.min(maxResults, shuffled.length));
        }
        
        // Süreyi formatla (saniye -> mm:ss)
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // iTunes API arama (ücretsiz - gelecek için hazır)
        async function searchiTunes(query, maxResults = 50) {
            try {
                const apiUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&media=music&limit=${maxResults}`;
                const response = await fetch(apiUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.results && data.results.length > 0) {
                        return data.results.map(track => ({
                            id: track.trackId,
                            title: track.trackName,
                            artist: track.artistName,
                            duration: formatDuration(Math.floor(track.trackTimeMillis / 1000)),
                            thumbnail: track.artworkUrl100 || 'https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg'
                        }));
                    }
                }
            } catch (error) {
                console.log('❌ iTunes API hatası:', error.message);
            }
            return [];
        }
        
        // Deezer API arama (ücretsiz - gelecek için hazır)
        async function searchDeezer(query, maxResults = 50) {
            try {
                const apiUrl = `https://api.deezer.com/search?q=${encodeURIComponent(query)}&limit=${maxResults}`;
                const response = await fetch(apiUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.data && data.data.length > 0) {
                        return data.data.map(track => ({
                            id: track.id,
                            title: track.title,
                            artist: track.artist.name,
                            duration: formatDuration(track.duration),
                            thumbnail: track.album.cover_medium || 'https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg'
                        }));
                    }
                }
            } catch (error) {
                console.log('❌ Deezer API hatası:', error.message);
            }
            return [];
        }

        // Şarkı başlığını normalize et (tekrar tespiti için) - GÜÇLENDİRİLMİŞ
        function normalizeSongTitle(title) {
            let normalized = title.toLowerCase();
            
            // Gereksiz kelimeleri kaldır (AGRESİF)
            const removeWords = ['official', 'music', 'video', 'audio', 'lyrics', 'lyric',
                'official music video', 'official video', 'official audio',
                'lyric video', 'music video', 'visualizer', 'visualiser',
                'clip', 'klip', 'şarkı', 'müzik', 'resmi', 'sözleri',
                'hd', '4k', '1080p', '720p', 'high quality', 'hq',
                'remix', 'cover', 'acoustic', 'live', 'performance',
                'ft.', 'feat.', 'featuring', 'prod.', 'produced',
                'rap', 'trap', 'slowed', 'reverb', 'bass boosted',
                'nightcore', 'sped up', 'türkçe', 'turkish',
                'yeni', 'new', '2024', '2023', '2022', '2021', '2020',
                'şarkısı', 'song', 'track', 'single', 'album'];
            
            // Tüm gereksiz kelimeleri kaldır
            removeWords.forEach(word => {
                normalized = normalized.replace(new RegExp('\\b' + word + '\\b', 'gi'), '');
            });
            
            // Parantez ve köşeli parantezleri temizle
            normalized = normalized.replace(/\([^)]*\)/g, ''); // (...)
            normalized = normalized.replace(/\[[^\]]*\]/g, ''); // [...]
            normalized = normalized.replace(/\{[^}]*\}/g, ''); // {...}
            
            // Özel karakterleri temizle (sadece harf, rakam, boşluk ve tire bırak)
            normalized = normalized.replace(/[^\w\s-]/g, '');
            
            // Tire ve alt çizgileri boşluğa çevir
            normalized = normalized.replace(/[-_]/g, ' ');
            
            // Fazla boşlukları temizle
            normalized = normalized.replace(/\s+/g, ' ').trim();
            
            return normalized;
        }

        // Tekrar eden şarkıları filtrele (GÜÇLENDİRİLMİŞ)
        function removeDuplicateSongs(videos) {
            console.log(`🔍 Tekrar kontrolü başlıyor: ${videos.length} video`);
            const seen = new Map();
            const unique = [];
            
            for (const video of videos) {
                const normalizedTitle = normalizeSongTitle(video.title);
                const normalizedArtist = video.artist.toLowerCase().trim().replace(/[^\w\s]/g, '');
                
                // Benzersiz anahtar: sanatçı + normalize edilmiş başlık
                const key = `${normalizedArtist}|||${normalizedTitle}`;
                
                // Benzerlik kontrolü - Eğer çok benzer bir şarkı varsa engelle
                let isDuplicate = false;
                for (const [existingKey, existingVideo] of seen.entries()) {
                    // Aynı sanatçı ve çok benzer başlık kontrolü
                    const [existingArtist, existingTitle] = existingKey.split('|||');
                    if (existingArtist === normalizedArtist) {
                        // Başlık benzerliği kontrolü (Levenshtein benzeri basit kontrol)
                        const similarity = calculateSimilarity(normalizedTitle, existingTitle);
                        if (similarity > 0.7) { // %70'den fazla benzer
                            isDuplicate = true;
                            console.log(`🔄 TEKRAR ENGELLENDI! (Benzerlik: ${(similarity * 100).toFixed(0)}%)`);
                            break;
                        }
                    }
                }
                
                if (!isDuplicate && !seen.has(key)) {
                    seen.set(key, video);
                    unique.push(video);
                } else if (!isDuplicate) {
                    console.log(`🔄 TEKRAR ENGELLENDI! (Aynı key)`);
                }
            }
            
            console.log(`✨ Sonuç: ${unique.length} benzersiz şarkı (${videos.length - unique.length} tekrar kaldırıldı)`);
            return unique;
        }

        // Basit benzerlik hesaplama (0-1 arası, 1 = tamamen aynı)
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            if (longer.length === 0) return 1.0;
            
            // Ortak kelime sayısı
            const words1 = str1.split(' ').filter(w => w.length > 2);
            const words2 = str2.split(' ').filter(w => w.length > 2);
            let commonWords = 0;
            words1.forEach(word => {
                if (words2.includes(word)) commonWords++;
            });
            
            const maxWords = Math.max(words1.length, words2.length);
            if (maxWords === 0) return 0;
            return commonWords / maxWords;
        }

        // Başlıktan hashtag ve emoji temizle
        function cleanTitle(title) {
            let cleaned = title;
            
            // 1. Hashtag'leri kaldır (#keşfet, #ati242 gibi)
            cleaned = cleaned.replace(/#\w+/g, '');
            
            // 2. Emojileri kaldır
            cleaned = cleaned.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu, '');
            
            // 3. Fazla boşlukları temizle
            cleaned = cleaned.replace(/\s+/g, ' ').trim();
            
            return cleaned;
        }

        // Sadece müzik içeriklerini filtrele (client-side ek güvenlik - ULTRA AGRESİF)
        function filterMusicOnly(videos) {
            const excludeKeywords = ['podcast', 'vlog', 'interview', 'röportaj', 'konuşma', 'talk',
                'gameplay', 'oyun', 'tutorial', 'nasıl yapılır', 'review', 'inceleme',
                'unboxing', 'reaction', 'tepki', 'prank', 'challenge', 'documentary',
                'trailer', 'fragman', 'funny moments', 'komik', 'fails',
                // Shorts ve kısa video filtreleri (ULTRA AGRESİF)
                'shorts', 'short', 'kısa', 'kisa', '#shorts', '#short',
                'youtube shorts', 'yt shorts', 'ytshorts',
                'tiktok', 'reels', 'reel', 'instagram reels',
                'viral', '#viral', 'trend', '#trend', 'trending',
                'snippet', 'clip video', 'quick', 'hızlı', 'hizli',
                // Hashtag filtreleri (ULTRA AGRESİF)
                '#keşfet', '#kesfet', '#öneçıkar', '#onecıkar', '#fyp', '#foryou',
                '#ati242', '#ati', '#lvbelc5', '#lvbel', '#poizi', '#sefo',
                '#ezhel', '#ceza', '#khontkar', '#motive', '#murda',
                '#uzi', '#ati242uzi', '#lvbelc5uzi', '#uziceza', '#uzikhontkar',
                '#rapshorts', '#turkrap', '#türkrap', '#rapvideo', '#rapclip',
                '#keşfetteyiz', '#kesfetteyiz', '#viral', '#viralvideo', '#viralshorts',
                '#trendvideo', '#trendshorts', '#trendmusic', '#trendrap',
                'keşfet', 'kesfet', 'öneçıkar', 'onecıkar', 'fyp', 'foryou',
                // Emoji ve özel karakterler (shorts işareti)
                '😂', '🔥', '💯', '🎵', '🎶', '🎤', '🎧', '💥', '⚡', '✨',
                // Diğer shorts belirtileri
                'ediyor', 'ifşa', 'ifsa', 'yalan', 'sonbahar', 'artık yok',
                'yükselişe geçen', 'son zamanlarda', 'popüler', 'keşfet'];
            
            return videos.filter(video => {
                const titleLower = video.title.toLowerCase();
                const artistLower = video.artist.toLowerCase();
                const fullText = `${titleLower} ${artistLower}`;
                
                // 1. HASHTAG KONTROLÜ - Başlıkta # varsa direkt engelle (ULTRA AGRESİF)
                if (video.title.includes('#') || video.artist.includes('#')) {
                    console.log(`🚫 HASHTAG ENGELLENDI: ${video.title}`);
                    return false;
                }
                
                // 1.5. SHORTS KELİMESİ KONTROLÜ - "shorts" kelimesi varsa direkt engelle
                if (titleLower.includes('shorts') || titleLower.includes('short')) {
                    console.log(`🚫 SHORTS KELİMESİ ENGELLENDI: ${video.title}`);
                    return false;
                }
                
                // 2. EMOJI KONTROLÜ - Emoji varsa direkt engelle
                const emojiRegex = /[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/u;
                if (emojiRegex.test(video.title)) {
                    console.log(`🚫 EMOJI ENGELLENDI: ${video.title}`);
                    return false;
                }
                
                // 3. KEYWORD KONTROLÜ
                const hasExcludeKeyword = excludeKeywords.some(keyword => fullText.includes(keyword.toLowerCase()));
                if (hasExcludeKeyword) {
                    console.log(`🚫 KEYWORD ENGELLENDI: ${video.title}`);
                    return false;
                }
                
                // 4. SÜRE KONTROLÜ - 70 saniyeden (1 dakika 10 saniye) kısa = shorts (ULTRA AGRESİF)
                if (video.duration < 70) {
                    console.log(`🚫 SHORTS ENGELLENDI (${video.duration}s): ${video.title}`);
                    return false;
                }
                
                // 5. SÜRE KONTROLÜ - 20 dakikadan uzun = muhtemelen müzik değil
                if (video.duration > 1200) {
                    console.log(`🚫 ÇOK UZUN ENGELLENDI (${video.duration}s): ${video.title}`);
                    return false;
                }
                
                // 6. BAŞLIK UZUNLUĞU - Çok kısa başlıklar genelde shorts
                if (video.title.length < 10) {
                    console.log(`🚫 ÇOK KISA BAŞLIK ENGELLENDI: ${video.title}`);
                    return false;
                }
                
                // 7. BÜYÜK HARF KONTROLÜ - Tamamı büyük harf = spam/shorts
                const upperCaseRatio = (video.title.match(/[A-Z]/g) || []).length / video.title.length;
                if (upperCaseRatio > 0.5 && video.title.length > 20) {
                    console.log(`🚫 BÜYÜK HARF SPAM ENGELLENDI: ${video.title}`);
                    return false;
                }
                
                console.log(`✅ GEÇTİ: ${video.title} (${video.duration}s)`);
                return true;
            });
        }

        // Yerel arama fonksiyonu
        function searchLocalMusic(query, maxResults = 20) {
            const results = [];
            const searchTerm = query.toLowerCase();
            
            // Tüm kategorilerde ara
            Object.values(localMusicDatabase).forEach(category => {
                category.forEach(song => {
                    if (song.title.toLowerCase().includes(searchTerm) || 
                        song.artist.toLowerCase().includes(searchTerm)) {
                        results.push({
                            id: { videoId: song.id },
                            snippet: {
                                title: song.title,
                                channelTitle: song.artist,
                                thumbnails: { medium: { url: song.thumbnail } }
                            }
                        });
                    }
                });
            });
            
            // Eğer sonuç yoksa, popüler müziklerden rastgele seç
            if (results.length === 0) {
                const popularSongs = localMusicDatabase['popular music'].slice(0, maxResults);
                popularSongs.forEach(song => {
                    results.push({
                        id: { videoId: song.id },
                        snippet: {
                            title: song.title,
                            channelTitle: song.artist,
                            thumbnails: { medium: { url: song.thumbnail } }
                        }
                    });
                });
            }
            
            return results.slice(0, maxResults);
        }
        function loadPopularMusic() {
            const homeContent = document.getElementById('home-content');
            if (!homeContent) return;
            
            console.log('🎵 Loading popular music...');
            
            // Popüler şarkılar listesi (API olmadan)
            const popularSongs = [
                {
                    videoId: 'dQw4w9WgXcQ',
                    title: 'Rick Astley - Never Gonna Give You Up',
                    artist: 'Rick Astley',
                    thumbnail: 'https://i.ytimg.com/vi/dQw4w9WgXcQ/mqdefault.jpg'
                },
                {
                    videoId: 'kJQP7kiw5Fk',
                    title: 'Luis Fonsi - Despacito ft. Daddy Yankee',
                    artist: 'Luis Fonsi',
                    thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/mqdefault.jpg'
                },
                {
                    videoId: 'fJ9rUzIMcZQ',
                    title: 'Queen - Bohemian Rhapsody',
                    artist: 'Queen Official',
                    thumbnail: 'https://i.ytimg.com/vi/fJ9rUzIMcZQ/mqdefault.jpg'
                },
                {
                    videoId: 'JGwWNGJdvx8',
                    title: 'Ed Sheeran - Shape of You',
                    artist: 'Ed Sheeran',
                    thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/mqdefault.jpg'
                },
                {
                    videoId: 'YQHsXMglC9A',
                    title: 'Adele - Hello',
                    artist: 'Adele',
                    thumbnail: 'https://i.ytimg.com/vi/YQHsXMglC9A/mqdefault.jpg'
                },
                {
                    videoId: 'CevxZvSJLk8',
                    title: 'Katy Perry - Roar',
                    artist: 'Katy Perry',
                    thumbnail: 'https://i.ytimg.com/vi/CevxZvSJLk8/mqdefault.jpg'
                },
                {
                    videoId: 'hT_nvWreIhg',
                    title: 'The Weeknd - Blinding Lights',
                    artist: 'The Weeknd',
                    thumbnail: 'https://i.ytimg.com/vi/hT_nvWreIhg/mqdefault.jpg'
                },
                {
                    videoId: 'RgKAFK5djSk',
                    title: 'Wiz Khalifa - See You Again ft. Charlie Puth',
                    artist: 'Wiz Khalifa',
                    thumbnail: 'https://i.ytimg.com/vi/RgKAFK5djSk/mqdefault.jpg'
                },
                {
                    videoId: '60ItHLz5WEA',
                    title: 'Alan Walker - Faded',
                    artist: 'Alan Walker',
                    thumbnail: 'https://i.ytimg.com/vi/60ItHLz5WEA/mqdefault.jpg'
                },
                {
                    videoId: 'OPf0YbXqDm0',
                    title: 'Mark Ronson - Uptown Funk ft. Bruno Mars',
                    artist: 'Mark Ronson',
                    thumbnail: 'https://i.ytimg.com/vi/OPf0YbXqDm0/mqdefault.jpg'
                },
                {
                    videoId: '2Vv-BfVoq4g',
                    title: 'PSY - GANGNAM STYLE',
                    artist: 'officialpsy',
                    thumbnail: 'https://i.ytimg.com/vi/2Vv-BfVoq4g/mqdefault.jpg'
                },
                {
                    videoId: '9bZkp7q19f0',
                    title: 'PSY - GENTLEMAN',
                    artist: 'officialpsy',
                    thumbnail: 'https://i.ytimg.com/vi/9bZkp7q19f0/mqdefault.jpg'
                },
                {
                    videoId: 'lp-EO5I60KA',
                    title: 'Billie Eilish - bad guy',
                    artist: 'Billie Eilish',
                    thumbnail: 'https://i.ytimg.com/vi/lp-EO5I60KA/mqdefault.jpg'
                },
                {
                    videoId: 'ZbZSe6N_BXs',
                    title: 'PHARRELL WILLIAMS - Happy',
                    artist: 'Pharrell Williams',
                    thumbnail: 'https://i.ytimg.com/vi/ZbZSe6N_BXs/mqdefault.jpg'
                },
                {
                    videoId: 'ru0K8uYEZWw',
                    title: 'CamelPhat & Elderbrook - Cola',
                    artist: 'CamelPhat',
                    thumbnail: 'https://i.ytimg.com/vi/ru0K8uYEZWw/mqdefault.jpg'
                },
                {
                    videoId: 'M7lc1UVf-VE',
                    title: 'Eiffel 65 - Blue (Da Ba Dee)',
                    artist: 'Eiffel 65',
                    thumbnail: 'https://i.ytimg.com/vi/M7lc1UVf-VE/mqdefault.jpg'
                },
                {
                    videoId: 'pAgnJDJN4VA',
                    title: 'Avicii - Wake Me Up',
                    artist: 'Avicii',
                    thumbnail: 'https://i.ytimg.com/vi/pAgnJDJN4VA/mqdefault.jpg'
                },
                {
                    videoId: 'IcrbM1l_BoI',
                    title: 'Avicii - Wake Me Up',
                    artist: 'Avicii',
                    thumbnail: 'https://i.ytimg.com/vi/IcrbM1l_BoI/mqdefault.jpg'
                },
                {
                    videoId: 'nfs8NYg7yQM',
                    title: 'Dua Lipa - Levitating',
                    artist: 'Dua Lipa',
                    thumbnail: 'https://i.ytimg.com/vi/nfs8NYg7yQM/mqdefault.jpg'
                },
                {
                    videoId: 'TUVcZfQe-Kw',
                    title: 'Dua Lipa - Levitating',
                    artist: 'Dua Lipa',
                    thumbnail: 'https://i.ytimg.com/vi/TUVcZfQe-Kw/mqdefault.jpg'
                },
                {
                    videoId: 'gAh9NRGNhUU',
                    title: 'Marshmello ft. Bastille - Happier',
                    artist: 'Marshmello',
                    thumbnail: 'https://i.ytimg.com/vi/gAh9NRGNhUU/mqdefault.jpg'
                },
                {
                    videoId: 'Zi_XLOBDo_Y',
                    title: 'Billie Eilish - bad guy',
                    artist: 'Billie Eilish',
                    thumbnail: 'https://i.ytimg.com/vi/Zi_XLOBDo_Y/mqdefault.jpg'
                },
                {
                    videoId: 'DyDfgMOUjCI',
                    title: 'bad guy - Billie Eilish',
                    artist: 'Billie Eilish',
                    thumbnail: 'https://i.ytimg.com/vi/DyDfgMOUjCI/mqdefault.jpg'
                },
                {
                    videoId: 'pt8VYOfr8To',
                    title: 'Post Malone - Sunflower',
                    artist: 'Post Malone',
                    thumbnail: 'https://i.ytimg.com/vi/pt8VYOfr8To/mqdefault.jpg'
                },
                {
                    videoId: 'ApXoWvfEYVU',
                    title: 'Post Malone - Sunflower',
                    artist: 'Post Malone',
                    thumbnail: 'https://i.ytimg.com/vi/ApXoWvfEYVU/mqdefault.jpg'
                }
            ];
            
            let html = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 10px;">
                        <i class="fas fa-music"></i> Popüler Şarkılar
                    </h3>
                    <p style="color: var(--secondary-text-color); font-size: 14px;">
                        En çok dinlenen şarkıları keşfedin
                    </p>
                </div>
                <div class="results-grid">
            `;
            
            popularSongs.forEach(song => {
                html += `
                    <div class="result-item" onclick="playSong('${song.videoId}', '${song.title.replace(/'/g, "\\'")}', '${song.thumbnail}', '${song.artist.replace(/'/g, "\\'")}')">
                        <img src="${song.thumbnail}" alt="${song.title}" onerror="handleThumbnailError(this)" onload="handleThumbnailLoad(this)">
                        <div class="item-title">${song.title}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            homeContent.innerHTML = html;
            console.log('✅ Popular music loaded successfully');
        }

        // Popüler müzikleri yükle (Yerel veritabanı kullanarak)
        async function loadPopularMusic() {
            const homeContent = document.getElementById('home-content');
            if (!homeContent) return;
            
            console.log('🎵 Loading popular music from local database...');
            
            // Yerel veritabanından popüler müzikleri al
            const popularSongs = localMusicDatabase['popular music'];
            
            // Karıştır - TÜM popüler şarkıları göster
            const shuffled = [...popularSongs].sort(() => 0.5 - Math.random());
            const selectedSongs = shuffled; // Tüm şarkıları göster
            
            // YouTube API formatına çevir
            const items = selectedSongs.map(song => ({
                id: { videoId: song.id },
                snippet: {
                    title: song.title,
                    channelTitle: song.artist,
                    thumbnails: { medium: { url: song.thumbnail } }
                }
            }));
            
            displayHomeResults(items);
            console.log('✅ Popular music loaded from local database');
        }

        // Fallback müzik listesi
        function displayFallbackMusic() {
            const fallbackSongs = [
                {
                    id: { videoId: 'dQw4w9WgXcQ' },
                    snippet: {
                        title: 'Rick Astley - Never Gonna Give You Up',
                        channelTitle: 'Rick Astley',
                        thumbnails: { medium: { url: 'https://i.ytimg.com/vi/dQw4w9WgXcQ/mqdefault.jpg' } }
                    }
                },
                {
                    id: { videoId: 'kJQP7kiw5Fk' },
                    snippet: {
                        title: 'Luis Fonsi - Despacito ft. Daddy Yankee',
                        channelTitle: 'Luis Fonsi',
                        thumbnails: { medium: { url: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/mqdefault.jpg' } }
                    }
                },
                {
                    id: { videoId: 'fJ9rUzIMcZQ' },
                    snippet: {
                        title: 'Queen - Bohemian Rhapsody',
                        channelTitle: 'Queen Official',
                        thumbnails: { medium: { url: 'https://i.ytimg.com/vi/fJ9rUzIMcZQ/mqdefault.jpg' } }
                    }
                },
                {
                    id: { videoId: 'JGwWNGJdvx8' },
                    snippet: {
                        title: 'Ed Sheeran - Shape of You',
                        channelTitle: 'Ed Sheeran',
                        thumbnails: { medium: { url: 'https://i.ytimg.com/vi/JGwWNGJdvx8/mqdefault.jpg' } }
                    }
                },
                {
                    id: { videoId: 'YQHsXMglC9A' },
                    snippet: {
                        title: 'Adele - Hello',
                        channelTitle: 'Adele',
                        thumbnails: { medium: { url: 'https://i.ytimg.com/vi/YQHsXMglC9A/mqdefault.jpg' } }
                    }
                },
                {
                    id: { videoId: 'CevxZvSJLk8' },
                    snippet: {
                        title: 'Katy Perry - Roar',
                        channelTitle: 'Katy Perry',
                        thumbnails: { medium: { url: 'https://i.ytimg.com/vi/CevxZvSJLk8/mqdefault.jpg' } }
                    }
                }
            ];
            
            displayHomeResults(fallbackSongs);
        }

        function displayHomeResults(items) {
            const homeContent = document.getElementById('home-content');
            if (!homeContent) return;
            
            let html = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 10px;">
                        <i class="fas fa-music"></i> Popüler Şarkılar
                    </h3>
                    <p style="color: var(--secondary-text-color); font-size: 14px;">
                        En çok dinlenen şarkıları keşfedin
                    </p>
                </div>
                <div class="results-grid">
            `;
            
            items.forEach(item => {
                const videoId = item.id.videoId;
                const title = item.snippet.title;
                const thumbnail = item.snippet.thumbnails.medium.url;
                const channelTitle = item.snippet.channelTitle;
                
                html += `
                    <div class="result-item" onclick="playSong('${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${channelTitle.replace(/'/g, "\\'")}')">
                        <img src="${thumbnail}" alt="${title}">
                        <div class="item-title">${title}</div>
                        <button class="add-to-playlist-btn" onclick="event.stopPropagation(); addToPlaylist('${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${channelTitle.replace(/'/g, "\\'")}')">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="add-to-collaborative-btn" onclick="event.stopPropagation(); addToCollaborativePlaylist('${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${channelTitle.replace(/'/g, "\\'")}')">
                            <i class="fas fa-users"></i>
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            homeContent.innerHTML = html;
        }

        // YouTube Data API v3 aktif - Çoklu API key sistemi ile sınırsız kullanım!
        // Quota dolduğunda otomatik API key rotation

        // Navigation functions
        function setActiveLink(activeLink) {
            document.querySelectorAll('#sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        function clearContentArea() {
            contentArea.innerHTML = '';
        }

        function showHomePage() {
            console.log('🏠 Ana sayfa açılıyor - Dinamik müzik sistemi');
            currentView = 'home';
            setActiveLink(homeLink);
            searchContainer.classList.add('hidden');
            clearContentArea();
            
            // Playlist'i temizle - yeni sayfa açıldığında
            playlist = [];
            currentSongIndex = -1;
            console.log('🔄 Playlist temizlendi - Ana sayfa açıldı');
            
            // Reset infinite scroll variables
            currentPage = 0;
            hasMoreContent = true;
            isLoading = false;
            homeScrollPage = 0;
            isLoadingMore = false;
            hasMoreHomeContent = true;
            
            contentArea.innerHTML = `
                <div class="content-header">
                    <h2><i class="fas fa-music"></i> Müzikler</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="refreshHomePage()" class="search-btn" style="font-size: 14px;">
                            <i class="fas fa-sync-alt"></i> Yeni Müzikler
                        </button>
                    </div>
                </div>
                <div id="home-content" class="results-grid"></div>
            `;
            
            // Dinamik müzikleri yükle
            loadLocalHomeMusic(0, false);
        }

        // Ana sayfa için müzik yükle - DİNAMİK SİSTEM
        async function loadLocalHomeMusic(page = 0, append = false) {
            const homeContent = document.getElementById('home-content');
            if (!homeContent) return;
            
            homeContent.innerHTML = '<div class="loading-spinner"></div>';
            
            try {
                console.log('🎵 Dinamik ana sayfa müzikleri yükleniyor...');
                
                // Rastgele müzik kategorileri seç
                const randomMusic = await getRandomDynamicMusic();
                
                if (randomMusic && randomMusic.length > 0) {
                    console.log(`✅ Ana sayfa için ${randomMusic.length} dinamik şarkı yüklendi`);
                    displayResults(randomMusic, append);
                    showNotification(`${randomMusic.length} yeni şarkı yüklendi!`, 'success');
                } else {
                    throw new Error('Dinamik müzik yüklenemedi');
                }
            } catch (error) {
                console.error('❌ Dinamik müzik yükleme hatası:', error);
                
                // Fallback: API'den rastgele müzik çek
                try {
                    const apiMusic = await fetchRandomMusicFromAPI();
                    if (apiMusic && apiMusic.length > 0) {
                        displayResults(apiMusic, append);
                        showNotification(`${apiMusic.length} şarkı yüklendi!`, 'success');
                    } else {
                        throw new Error('API\'den müzik alınamadı');
                    }
                } catch (apiError) {
                    console.error('❌ API fallback hatası:', apiError);
                    // Son çare: Yerel veritabanından rastgele seç
                    const localMusic = getRandomLocalMusic();
                    displayResults(localMusic, append);
                    showNotification('Yerel müzikler yüklendi', 'info');
                }
            }
        }

        // Dinamik rastgele müzik getir - HER SEFERINDE FARKLI!
        async function getRandomDynamicMusic() {
            console.log('  YouTube rAPI ile popüler müzikler yükleniyor... (Çoklu Key Sistemi)');
            
            try {
                // Her sayfa için farklı terimler kullan (çeşitlilik için)
                const termsPerPage = 3;
                const startIndex = (page * termsPerPage) % POPULAR_SEARCH_TERMS.length;
                const selectedTerms = [];
                
                // Döngüsel olarak terim seç (sonuna gelince başa dön)
                for (let i = 0; i < termsPerPage; i++) {
                    const termIndex = (startIndex + i) % POPULAR_SEARCH_TERMS.length;
                    selectedTerms.push(POPULAR_SEARCH_TERMS[termIndex]);
                }
                
                // Ek çeşitlilik için terimleri karıştır
                const shuffledTerms = [...selectedTerms].sort(() => Math.random() - 0.5);
                
                console.log(`🔍 Kullanılan arama terimleri (Sayfa ${page + 1}):`, shuffledTerms);
                
                const searchPromises = [];
                for (const term of shuffledTerms) {
                    searchPromises.push(searchYouTube(term, 20)); // Her terim için 20 şarkı (daha fazla çeşitlilik)
                }
                
                // Paralel arama yap
                const allResults = await Promise.allSettled(searchPromises);
                const combinedResults = [];
                
                allResults.forEach((result, index) => {
                    if (result.status === 'fulfilled' && result.value && result.value.length > 0) {
                        console.log(`✅ "${selectedTerms[index]}" için ${result.value.length} şarkı bulundu`);
                        combinedResults.push(...result.value);
                    }
                });
                
                if (combinedResults.length > 0) {
                    // Duplikasyonları kaldır ve karıştır
                    const uniqueResults = removeDuplicateSongs(combinedResults);
                    const shuffled = uniqueResults.sort(() => Math.random() - 0.5);
                    
                    console.log(`🎵 YouTube API başarılı: ${shuffled.length} benzersiz popüler şarkı yüklendi`);
                    return shuffled;
                } else {
                    throw new Error('Tüm arama terimleri boş sonuç döndü');
                }
            } catch (error) {
                console.error('❌ YouTube API popüler müzik hatası:', error);
                
                // Hata durumunda yerel veritabanını kullan
                console.log('🔄 API hatası, yerel veritabanı kullanılıyor...');
                const allMusic = [];
                Object.values(localMusicDatabase).forEach(categoryMusic => {
                    if (Array.isArray(categoryMusic)) {
                        allMusic.push(...categoryMusic);
                    }
                });
                
                // Duplikasyonları kaldır
                const uniqueMusic = [];
                const seenIds = new Set();
                allMusic.forEach(song => {
                    if (!seenIds.has(song.id)) {
                        seenIds.add(song.id);
                        uniqueMusic.push(song);
                    }
                });
                
                // Karıştır
                for (let i = uniqueMusic.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [uniqueMusic[i], uniqueMusic[j]] = [uniqueMusic[j], uniqueMusic[i]];
                }
                
                // YouTube API formatına dönüştür
                const results = uniqueMusic.map(song => ({
                    videoId: song.id,
                    title: song.title,
                    artist: song.artist,
                    thumbnail: song.thumbnail,
                    channelTitle: song.artist,
                    publishedAt: Date.now(),
                    description: `${song.title} by ${song.artist}`,
                    duration: 180 + Math.floor(Math.random() * 120), // 3-5 dakika
                    viewCount: Math.floor(Math.random() * 10000000)
                }));
                
                console.log(`🎵 Yerel veritabanından ${results.length} şarkı yüklendi! (Fallback)`);
                return results;
            }
        }

        // Fallback müzik yükle (API başarısız olursa)
        function loadFallbackMusic() {
            const homeContent = document.getElementById('home-content');
            if (!homeContent) return;
            
            console.log('📦 Loading fallback music...');
            showNotification('Yerel müzikler yükleniyor...', 'info');
            
            const allMusic = [];
            Object.values(localMusicDatabase).forEach(categoryMusic => {
                if (Array.isArray(categoryMusic)) {
                    allMusic.push(...categoryMusic);
                }
            });
            
            // Duplikasyonları kaldır
            const uniqueMusic = [];
            const seenIds = new Set();
            allMusic.forEach(song => {
                if (!seenIds.has(song.id)) {
                    seenIds.add(song.id);
                    uniqueMusic.push(song);
                }
            });
            
            // Karıştır
            for (let i = uniqueMusic.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [uniqueMusic[i], uniqueMusic[j]] = [uniqueMusic[j], uniqueMusic[i]];
            }
            
            const formattedMusic = uniqueMusic.map(song => ({
                videoId: song.id,
                title: song.title,
                artist: song.artist,
                thumbnail: song.thumbnail,
                channelTitle: song.artist
            }));
            
            homeContent.innerHTML = '';
            
            const header = document.createElement('div');
            header.style.textAlign = 'center';
            header.style.marginBottom = '20px';
            header.innerHTML = `
                <h3 style="color: var(--primary-color); margin-bottom: 10px;">
                    <i class="fas fa-music"></i> Müzik Koleksiyonu
                </h3>
                <p style="color: var(--secondary-text-color); font-size: 14px;">
                    Yerel veritabanından • ${formattedMusic.length} şarkı
                </p>
            `;
            homeContent.appendChild(header);
            
            displayResults(formattedMusic, false);
            showNotification(`${formattedMusic.length} şarkı yüklendi!`, 'success');
            setupInfiniteScroll();
        }

        // Dinamik rastgele müzik getir - HER SEFERINDE FARKLI!
        // Dinamik rastgele müzik getir - TÜRKÇE MÜZİK ODAKLI!
        // Dinamik rastgele müzik getir - SADECE TÜRKÇE MÜZİK!
        async function getRandomDynamicMusic() {
            console.log('🇹🇷 Sadece Türkçe müzik sistemi başlatılıyor...');
            
            const turkishMusicSources = [
                () => getTurkishMusic(), // BLOK3, Ezhel, Ceza vs.
                () => getTurkishRapMusic(), // Türkçe rap
                () => getTurkishPopMusic(), // Türkçe pop
                () => getTurkishClassicMusic(), // Türkçe klasik
                () => getTurkishLocalMusic() // Yerel Türkçe müzikler
            ];
            
            // Tüm kaynakları kullan - sadece Türkçe müzik
            const allMusic = [];
            
            for (const source of turkishMusicSources) {
                try {
                    const music = await source();
                    if (music && music.length > 0) {
                        allMusic.push(...music);
                        console.log(`✅ ${music.length} Türkçe şarkı eklendi`);
                    }
                } catch (error) {
                    console.log('⚠️ Bir Türkçe müzik kaynağı başarısız:', error.message);
                }
            }
            
            // Karıştır ve benzersiz yap
            const uniqueMusic = removeDuplicateSongs(allMusic);
            const shuffled = uniqueMusic.sort(() => Math.random() - 0.5);
            
            console.log(`🎵 ${shuffled.length} Türkçe şarkı hazırlandı`);
            return shuffled.slice(0, 50); // En fazla 50 şarkı
        }
        
        // Türkçe müzik kategorileri - BLOK3, Ezhel, Ceza vs.
        async function getTurkishMusic() {
            const turkishQueries = [
                // YENİ 2024-2025 HİT ŞARKILAR - ÖNCELİKLİ!
                'blok3 kusura bakma 2024', 'poizi perde', 'blok3 yeni şarkı', 'blok3 2024 albüm',
                'ezhel yeni şarkı 2024', 'ezhel son çıkan', 'ezhel 2024 hit',
                'ceza yeni şarkı 2024', 'ceza son albüm', 'ceza 2024 çıkan',
                'sagopa kajmer 2024', 'sagopa yeni şarkı', 'sagopa son çıkan',
                'norm ender 2024', 'norm ender yeni', 'norm ender son şarkı',
                'şanışer 2024', 'şanışer yeni çıkan', 'şanışer son hit',
                
                // YENİ NESİL TÜRKÇE RAP 2024
                'khontkar 2024 yeni', 'ben fero 2024 şarkı', 'reynmen yeni çıkan 2024',
                'mero 2024 hit', 'batuflex yeni şarkı', 'ati242 2024 çıkan',
                'young bego yeni', 'defkhan 2024 şarkı', 'lvbel c5 yeni',
                
                // GÜNCEL TÜRKÇE HİTLER
                'türkçe yeni çıkan şarkılar 2024', 'türkçe hit şarkılar 2024', 'türkçe rap yeni 2024',
                'türkçe pop yeni çıkan', 'türkçe müzik 2024 trend', 'türkçe viral şarkılar',
                
                // KLASİK AMA POPÜLER OLANLAR
                'blok3 kusura bakma', 'blok3 uyuz', 'blok3 yaptiricaz', 'blok3 sevmeyi denedim',
                'ezhel geceler', 'ezhel şehrimin tadı', 'ezhel felaket', 'ezhel aya',
                'ceza suspus', 'ceza holocaust', 'ceza yerli plaka', 'ceza neyim var ki',
                'sagopa kajmer bir pesimistin gözyaşları', 'sagopa kajmer galiba', 'sagopa kajmer baytar',
                'norm ender mekanın sahibi', 'norm ender kaktüs', 'norm ender aura',
                'şanışer susamam', 'şanışer ludovico', 'şanışer gelsin hayat bildiği gibi'
            ];
            
            const randomQuery = turkishQueries[Math.floor(Math.random() * turkishQueries.length)];
            console.log(`🆕 Yeni Türkçe müzik arama: "${randomQuery}"`);
            
            try {
                const response = await fetch(`${H_SOUND_API_URL}/api/search?q=${encodeURIComponent(randomQuery)}&limit=20`);
                const data = await response.json();
                
                if (data.success && data.results) {
                    return data.results.map(song => ({
                        videoId: song.videoId,
                        title: song.title,
                        artist: song.artist || song.channelTitle,
                        thumbnail: song.thumbnail,
                        channelTitle: song.channelTitle || song.artist
                    }));
                }
            } catch (error) {
                console.log('⚠️ Türkçe müzik API hatası:', error.message);
            }
            
            return [];
        }
        
        // Türkçe Rap müzikleri - YENİ 2024-2025 RAP HİTLERİ
        async function getTurkishRapMusic() {
            const turkishRapQueries = [
                // 2024-2025 YENİ TÜRKÇE RAP
                'türkçe rap 2024 yeni çıkan', 'türkçe rap hit 2024', 'türkçe drill 2024', 'türkçe trap 2024',
                'blok3 2024 yeni albüm', 'ezhel 2024 şarkıları', 'ceza yeni çıkan 2024',
                'sagopa kajmer 2024 hit', 'norm ender yeni şarkı 2024', 'şanışer 2024 çıkan',
                
                // YENİ NESİL RAPÇILER 2024
                'khontkar yeni hit 2024', 'ben fero 2024 çıkan', 'reynmen rap 2024',
                'mero türkçe yeni 2024', 'batuflex 2024 şarkı', 'ati242 yeni çıkan',
                'young bego 2024 hit', 'defkhan yeni şarkı', 'lvbel c5 2024',
                
                // GÜNCEL TÜRKÇE RAP TRENDLERİ
                'türkçe underground rap 2024', 'türkçe drill yeni', 'türkçe trap hit',
                'türkçe rap viral 2024', 'türkçe hip hop yeni', 'türkçe rap trending',
                
                // KLASİK TÜRKÇE RAP HİTLER
                'türkçe rap en iyi', 'blok3 tüm şarkılar', 'ezhel albüm şarkıları',
                'ceza en popüler şarkılar', 'sagopa kajmer hit şarkılar', 'norm ender en çok dinlenen'
            ];
            
            const randomQuery = turkishRapQueries[Math.floor(Math.random() * turkishRapQueries.length)];
            console.log(`🎤 Yeni Türkçe rap arama: "${randomQuery}"`);
            
            return await fetchRandomMusicFromAPI(randomQuery);
        }
        
        // Türkçe Pop müzikleri - Sadece Türkçe sanatçılar
        async function getTurkishPopMusic() {
            const turkishPopQueries = [
                'türkçe pop 2024', 'türkçe pop en iyi', 'tarkan tüm şarkıları', 'sezen aksu klasikleri',
                'ajda pekkan hit şarkılar', 'hadise popüler şarkılar', 'demet akalın en iyi',
                'ebru gündeş hit şarkılar', 'bengü müzik şarkıları', 'murat boz popüler',
                'kenan doğulu hit şarkılar', 'mustafa ceceli romantik şarkılar', 'emre aydın en iyi',
                'teoman klasik şarkılar', 'şebnem ferah rock şarkıları', 'mor ve ötesi hit',
                'türkçe aşk şarkıları', 'türkçe duygusal şarkılar', 'türkçe nostaljik şarkılar',
                'türkçe dans müziği', 'türkçe romantik şarkılar'
            ];
            
            const randomQuery = turkishPopQueries[Math.floor(Math.random() * turkishPopQueries.length)];
            console.log(`🎵 Türkçe pop arama: "${randomQuery}"`);
            
            return await fetchRandomMusicFromAPI(randomQuery);
        }
        // API'den rastgele müzik çek - parametre ile özelleştirilebilir
        async function fetchRandomMusicFromAPI(customQuery = null) {
            let queryToUse;
            
            if (customQuery) {
                queryToUse = customQuery;
            } else {
                const randomQueries = [
                    'trending music 2024', 'popular songs', 'top hits', 'viral music',
                    'new music', 'chart toppers', 'radio hits', 'dance music',
                    'pop music', 'rock music', 'hip hop', 'electronic music',
                    'indie music', 'alternative rock', 'r&b music', 'country music'
                ];
                queryToUse = randomQueries[Math.floor(Math.random() * randomQueries.length)];
            }
            
            console.log(`🔍 API'den arama: "${queryToUse}"`);
            
            try {
                const response = await fetch(`${H_SOUND_API_URL}/api/search?q=${encodeURIComponent(queryToUse)}&limit=30`);
                const data = await response.json();
                
                if (data.success && data.results) {
                    return data.results.map(song => ({
                        videoId: song.videoId,
                        title: song.title,
                        artist: song.artist || song.channelTitle,
                        thumbnail: song.thumbnail,
                        channelTitle: song.channelTitle || song.artist
                    }));
                }
            } catch (error) {
                console.log('⚠️ API müzik hatası:', error.message);
            }
            
            return [];
        }
        
        // Türkçe Klasik müzikleri
        async function getTurkishClassicMusic() {
            const turkishClassicQueries = [
                'barış manço dağlar dağlar', 'barış manço sarı çizmeli mehmet ağa', 'barış manço gülpembe',
                'cem karaca tamirci çırağı', 'cem karaca resimdeki gözyaşları', 'cem karaca parka',
                'zeki müren şimdi uzaklardasın', 'zeki müren elbet bir gün buluşacağız', 'zeki müren hayat bayram olsa',
                'orhan gencebay dil yarası', 'orhan gencebay batsın bu dünya', 'orhan gencebay hatasız kul olmaz',
                'ibrahim tatlıses haydi söyle', 'ibrahim tatlıses leylim ley', 'ibrahim tatlıses mavi mavi',
                'müslüm gürses hangimiz sevmedik', 'müslüm gürses itirazım var', 'müslüm gürses affet'
            ];
            
            const randomQuery = turkishClassicQueries[Math.floor(Math.random() * turkishClassicQueries.length)];
            console.log(`🎼 Türkçe klasik arama: "${randomQuery}"`);
            
            return await fetchRandomMusicFromAPI(randomQuery);
        }
        
        // Yerel Türkçe müzikler - YENİ VE POPÜLER ŞARKILAR
        async function getTurkishLocalMusic() {
            const localTurkishMusic = [
                // YENİ 2024-2025 HİTLER
                { videoId: 'JWLWczFtCag', title: 'BLOK3 - Kusura Bakma', artist: 'BLOK3', thumbnail: 'https://i.ytimg.com/vi/JWLWczFtCag/hqdefault.jpg' },
                { videoId: 'abc123xyz45', title: 'Poizi - Perde', artist: 'Poizi', thumbnail: 'https://i.ytimg.com/vi/abc123xyz45/hqdefault.jpg' },
                { videoId: 'def456uvw78', title: 'BLOK3 - Uyuz (Official Audio)', artist: 'BLOK3', thumbnail: 'https://i.ytimg.com/vi/def456uvw78/hqdefault.jpg' },
                { videoId: 'ghi789rst01', title: 'Ezhel - Geceler', artist: 'Ezhel', thumbnail: 'https://i.ytimg.com/vi/ghi789rst01/hqdefault.jpg' },
                { videoId: 'jkl012mno34', title: 'Ceza - Suspus', artist: 'Ceza', thumbnail: 'https://i.ytimg.com/vi/jkl012mno34/hqdefault.jpg' },
                
                // GÜNCEL TÜRKÇE RAP
                { videoId: 'pqr567stu89', title: 'Sagopa Kajmer - Bir Pesimistin Gözyaşları', artist: 'Sagopa Kajmer', thumbnail: 'https://i.ytimg.com/vi/pqr567stu89/hqdefault.jpg' },
                { videoId: 'vwx890yzab2', title: 'Norm Ender - Mekanın Sahibi', artist: 'Norm Ender', thumbnail: 'https://i.ytimg.com/vi/vwx890yzab2/hqdefault.jpg' },
                { videoId: 'cde345fgh67', title: 'Şanışer - Susamam', artist: 'Şanışer', thumbnail: 'https://i.ytimg.com/vi/cde345fgh67/hqdefault.jpg' },
                { videoId: 'ijk890lmn23', title: 'Khontkar - Çek', artist: 'Khontkar', thumbnail: 'https://i.ytimg.com/vi/ijk890lmn23/hqdefault.jpg' },
                { videoId: 'opq456rst78', title: 'Ben Fero - Demet Akalın', artist: 'Ben Fero', thumbnail: 'https://i.ytimg.com/vi/opq456rst78/hqdefault.jpg' },
                
                // TÜRKÇE POP KLASİKLERİ
                { videoId: 'FM7MFYoylVs', title: 'Tarkan - Şımarık', artist: 'Tarkan', thumbnail: 'https://i.ytimg.com/vi/FM7MFYoylVs/hqdefault.jpg' },
                { videoId: 'CY8E6N5Nzec', title: 'Tarkan - Kuzu Kuzu', artist: 'Tarkan', thumbnail: 'https://i.ytimg.com/vi/CY8E6N5Nzec/hqdefault.jpg' },
                { videoId: 'BNm6b5vGJwY', title: 'Sezen Aksu - Şarkı Söylemek Lazım', artist: 'Sezen Aksu', thumbnail: 'https://i.ytimg.com/vi/BNm6b5vGJwY/hqdefault.jpg' },
                { videoId: 'YqBLxzn6kcU', title: 'Barış Manço - Dağlar Dağlar', artist: 'Barış Manço', thumbnail: 'https://i.ytimg.com/vi/YqBLxzn6kcU/hqdefault.jpg' },
                { videoId: 'HgGAzBDE454', title: 'Cem Karaca - Tamirci Çırağı', artist: 'Cem Karaca', thumbnail: 'https://i.ytimg.com/vi/HgGAzBDE454/hqdefault.jpg' }
            ];
            
            // Karıştır ve döndür - yeni şarkılar öncelikli
            const shuffled = [...localTurkishMusic].sort(() => Math.random() - 0.5);
            console.log(`🏠 ${shuffled.length} yerel Türkçe şarkı hazırlandı (yeni şarkılar öncelikli)`);
            
            return shuffled.map(song => ({
                videoId: song.videoId,
                title: song.title,
                artist: song.artist,
                thumbnail: song.thumbnail,
                channelTitle: song.artist
            }));
        }
        async function getRandomTrendingMusic() {
            const trendingTerms = [
                'viral tiktok songs', 'trending now', 'most popular', 'chart hits',
                'billboard hot 100', 'spotify top 50', 'youtube trending music'
            ];
            
            const term = trendingTerms[Math.floor(Math.random() * trendingTerms.length)];
            return await fetchRandomMusicFromAPI(term);
        }
        
        // Rastgele tür müziği
        async function getRandomGenreMusic() {
            const genres = [
                'pop music hits', 'rock classics', 'hip hop bangers', 'electronic dance',
                'indie alternative', 'r&b soul', 'country music', 'jazz standards',
                'reggae music', 'latin music', 'k-pop hits', 'turkish music'
            ];
            
            const genre = genres[Math.floor(Math.random() * genres.length)];
            return await fetchRandomMusicFromAPI(genre);
        }
        
        // Rastgele yıl müziği
        async function getRandomYearMusic() {
            const years = ['2024', '2023', '2022', '2021', '2020', '2019', '2018', '2017'];
            const year = years[Math.floor(Math.random() * years.length)];
            const query = `best songs ${year}`;
            
            return await fetchRandomMusicFromAPI(query);
        }
        
        // Rastgele sanatçı müziği
        async function getRandomArtistMusic() {
            const artists = [
                'Ed Sheeran', 'Taylor Swift', 'The Weeknd', 'Dua Lipa', 'Billie Eilish',
                'Ariana Grande', 'Post Malone', 'Drake', 'Olivia Rodrigo', 'Harry Styles',
                'Tarkan', 'Sezen Aksu', 'Ezhel', 'Ceza', 'Sagopa Kajmer'
            ];
            
            const artist = artists[Math.floor(Math.random() * artists.length)];
            return await fetchRandomMusicFromAPI(artist);
        }
        // Ana sayfayı yenile - HER SEFERINDE FARKLI MÜZİKLER
        async function refreshHomePage() {
            console.log('🔄 Ana sayfa yenileniyor - Yeni dinamik müzikler yükleniyor...');
            homeScrollPage = 0;
            isLoadingMore = false;
            hasMoreHomeContent = true;
            
            // Loading göster
            const homeContent = document.getElementById('home-content');
            if (homeContent) {
                homeContent.innerHTML = '<div class="loading-spinner"></div>';
            }
            
            // Yeni dinamik müzikler yükle
            await loadLocalHomeMusic(0, false);
            showNotification('Yeni müzikler yüklendi! 🎵', 'success');
        }

        // YouTube popüler müzikleri yükle - Infinite Scroll ile
        async function loadYouTubePopularMusic(append = false) {
            const homeContent = document.getElementById('home-content');
            if (!homeContent) return;
            
            if (!append) {
                homeContent.innerHTML = '<div class="loading-spinner"></div>';
            }
            
            try {
                console.log('🔥 Loading YouTube popular music with multiple API keys...');
                if (!append) {
                    showNotification('YouTube popüler müzikler yükleniyor...', 'info');
                }
                
                const popularMusic = await getYouTubePopularMusic(12);
                
                if (popularMusic && popularMusic.length > 0) {
                    if (!append) {
                        homeContent.innerHTML = ''; // Loading spinner'ı temizle
                    }
                    displayResults(popularMusic, append);
                    
                    if (!append) {
                        showNotification(`${popularMusic.length} popüler şarkı yüklendi!`, 'success');
                        // Infinite scroll listener ekle
                        setupInfiniteScroll();
                    }
                } else {
                    // Fallback to local music
                    console.log('🔄 YouTube popular failed, using local music...');
                    loadMusicByLanguage(0, false);
                }
                
            } catch (error) {
                console.error('❌ YouTube popular music error:', error);
                // Fallback to local music
                loadMusicByLanguage(0, false);
            }
        }

        // Infinite Scroll Sistemi
        let homeScrollPage = 0;
        let isLoadingMore = false;
        let hasMoreHomeContent = true;

        function setupInfiniteScroll() {
            // Önceki listener'ları temizle
            window.removeEventListener('scroll', handleHomeScroll);
            document.removeEventListener('scroll', handleHomeScroll);
            
            // Infinite scroll KALICI olarak devre dışı bırakıldı - kullanıcı isteği
            // window.addEventListener('scroll', handleHomeScroll);
            // document.addEventListener('scroll', handleHomeScroll);
            
            console.log('🚫 Infinite scroll KALICI olarak devre dışı - aşağı kaydırma yenileme yapmaz');
            
            // Content area scroll listener KALICI olarak devre dışı
            const contentArea = document.getElementById('content-area');
            if (contentArea) {
                contentArea.removeEventListener('scroll', handleHomeScroll);
                // contentArea.addEventListener('scroll', handleHomeScroll); // KALICI DEVRE DIŞI
            }
            
            console.log('  Infiinite scroll setup atlandı - devre dışı bırakıldı');
        }

        function handleHomeScroll() {
            // Infinite scroll KALICI olarak devre dışı - kullanıcı isteği
            return; // Hiçbir şey yapma
        }

        async function loadMoreHomeContent() {
            if (isLoadingMore || !hasMoreHomeContent) return;
            
            isLoadingMore = true;
            homeScrollPage++;
            
            console.log(`📜 Loading more content from YouTube API... Page ${homeScrollPage + 1}`);
            
            // Loading indicator ekle
            const homeContent = document.getElementById('home-content');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'infinite-loading';
            loadingDiv.innerHTML = '<div class="loading-spinner" style="margin: 20px auto;"></div>';
            if (homeContent) homeContent.appendChild(loadingDiv);
            
            try {
                // YouTube API'den daha fazla karma Türkçe rap müzik çek
                const searchQueries = [
                    'Blok3 Ceza Ezhel yeni',
                    'Murda UZI Lvbel C5 2024',
                    'Sagopa Norm Ender Ceza',
                    'Ezhel Ben Fero Khontkar hit',
                    'Şehinşah Contra Motive rap',
                    'Türkçe rap karışık 2024',
                    'En popüler Türkçe rap',
                    'Blok3 Murda UZI mix',
                    'Ceza Sagopa efsane şarkılar',
                    'Yeni Türkçe rap 2024',
                    'Türkçe hip hop playlist',
                    'Rap Türkiye 2024',
                    'Blok3 Ezhel Ceza Murda',
                    'UZI Lvbel Motive Contra',
                    'Türkçe rap en iyiler'
                ];
                
                // Her sayfa için farklı sorgu kullan
                const queryIndex = homeScrollPage % searchQueries.length;
                const query = searchQueries[queryIndex];
                
                let newContent = await fetchMoreYouTubeMusic(query);
                
                // Loading indicator'ı kaldır
                const loadingEl = document.getElementById('infinite-loading');
                if (loadingEl) loadingEl.remove();
                
                if (newContent && newContent.length > 0) {
                    displayResults(newContent, true);
                    showNotification(`${newContent.length} yeni şarkı yüklendi`, 'info');
                } else {
                    // API başarısız olursa fallback - ama sınırsız devam et
                    const fallbackContent = getLocalPopularMusic();
                    if (fallbackContent.length > 0) {
                        displayResults(fallbackContent.slice(0, 10), true);
                    }
                    // hasMoreHomeContent = false; // KALDIRILDI - Sınırsız scroll için
                    console.log('🔄 API başarısız, ama infinite scroll devam ediyor...');
                }
                
            } catch (error) {
                console.error('❌ Error loading more content:', error);
                // Loading indicator'ı kaldır
                const loadingEl = document.getElementById('infinite-loading');
                if (loadingEl) loadingEl.remove();
            } finally {
                isLoadingMore = false;
            }
        }

        // YouTube API'den daha fazla müzik çek - RapidAPI ile
        async function fetchMoreYouTubeMusic(query) {
            try {
                console.log(`🔍 Fetching more: ${query}`);
                const results = await searchYouTubeRapidAPI(query, 50);
                
                if (results && results.length > 0) {
                    // Karıştır
                    for (let i = results.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [results[i], results[j]] = [results[j], results[i]];
                    }
                    return results;
                }
                return null;
            } catch (error) {
                console.error('❌ Fetch more failed:', error);
                return null;
            }
        }

        function showSearchPage() {
            currentView = 'search';
            setActiveLink(searchLink);
            searchContainer.classList.remove('hidden');
            clearContentArea();
            
            // Playlist'i temizle - yeni sayfa açıldığında
            playlist = [];
            currentSongIndex = -1;
            console.log('🔄 Playlist temizlendi - Arama sayfası açıldı');
            
            contentArea.innerHTML = `
                <div class="content-header">
                    <h2><i class="fas fa-search"></i> Arama Sonuçları</h2>
                </div>
                <div class="no-content-message">
                    Arama yapmak için yukarıdaki kutucuğa şarkı adı yazın.
                </div>
            `;
            
            setTimeout(() => {
                searchBar.focus();
            }, 100);
        }

        function showPlaylistsPage() {
            currentView = 'playlists';
            setActiveLink(playlistsLink);
            searchContainer.classList.add('hidden');
            clearContentArea();
            
            // Playlist'i temizle - yeni sayfa açıldığında
            playlist = [];
            currentSongIndex = -1;
            console.log('🔄 Playlist temizlendi - Çalma listeleri sayfası açıldı');
            
            // Load user playlists
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${localStorage.getItem('h_sound_username')}`) || '[]');
            
            contentArea.innerHTML = `
                <div class="content-header">
                    <h2><i class="fas fa-compact-disc"></i> Çalma Listeleri</h2>
                    <button onclick="createNewPlaylist()" class="search-btn">
                        <i class="fas fa-plus"></i> Yeni Liste
                    </button>
                </div>
                
                <div class="playlists-container">
                    ${userPlaylists.length === 0 ? `
                        <div class="no-content-message">
                            <i class="fas fa-compact-disc" style="font-size: 48px; color: var(--primary-color); margin-bottom: 20px;"></i>
                            <h3>Henüz Çalma Listeniz Yok</h3>
                            <p>Yeni bir çalma listesi oluşturmak için "Yeni Liste" butonuna tıklayın.</p>
                        </div>
                    ` : `
                        <div class="results-grid">
                            ${userPlaylists.map((playlist, index) => `
                                <div class="result-item playlist-item" onclick="openPlaylist(${index})">
                                    <div class="playlist-cover">
                                        <i class="fas fa-music" style="font-size: 48px; color: var(--primary-color);"></i>
                                    </div>
                                    <div class="item-title">${playlist.name}</div>
                                    <div class="playlist-info">${playlist.songs.length} şarkı</div>
                                    <button class="playlist-delete-btn" onclick="event.stopPropagation(); deletePlaylist(${index})" title="Listeyi Sil">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        function showFriendsPage() {
            currentView = 'friends';
            setActiveLink(friendsLink);
            searchContainer.classList.add('hidden');
            clearContentArea();
            
            contentArea.innerHTML = `
                <div class="friends-container">
                    <div class="content-header">
                        <h2><i class="fas fa-users"></i> Arkadaşlar</h2>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="openModal('add-friend-modal')" class="btn">
                                <i class="fas fa-user-plus"></i> Arkadaş Ekle
                            </button>
                            <button onclick="showCollaborativePlaylistModal()" class="btn btn-secondary">
                                <i class="fas fa-users"></i> Ortak Liste Oluştur
                            </button>
                            <button onclick="showPartyModeModal()" class="btn" style="background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);">
                                <i class="fas fa-music"></i> Ortak Müzik
                            </button>
                        </div>
                    </div>
                    
                    <!-- Aktif Ortak Müzik Oturumu -->
                    <div id="active-party-section" class="hidden" style="margin-bottom: 20px;">
                        <div style="background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%); padding: 20px; border-radius: 12px; color: white;">
                            <h3 style="margin: 0 0 10px 0;"><i class="fas fa-music"></i> Aktif Ortak Müzik Oturumu</h3>
                            <div id="party-info" style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div id="party-host">Host: -</div>
                                    <div id="party-participants">Katılımcılar: -</div>
                                </div>
                                <button onclick="leavePartyMode()" class="btn btn-danger" style="margin: 0;">
                                    <i class="fas fa-sign-out-alt"></i> Ayrıl
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ortak Çalma Listeleri -->
                    <div id="collaborative-playlists-section" style="margin-bottom: 30px;">
                        <h3><i class="fas fa-users"></i> Ortak Çalma Listeleri (<span id="collab-playlists-count">0</span>)</h3>
                        <div id="collaborative-playlists-list"></div>
                    </div>
                    
                    <!-- Ortak Müzik Davetiyeler -->
                    <div id="party-invitations-section" style="margin-bottom: 30px;">
                        <h3><i class="fas fa-music"></i> Ortak Müzik Davetiyeler (<span id="party-invitations-count">0</span>)</h3>
                        <div id="party-invitations-list"></div>
                    </div>
                    
                    <!-- Arkadaşlık İstekleri -->
                    <div id="friend-requests-section" style="margin-bottom: 30px;">
                        <h3><i class="fas fa-bell"></i> Gelen Arkadaşlık İstekleri (<span id="requests-count">${friendRequests.length}</span>)</h3>
                        <div id="friend-requests-list"></div>
                    </div>
                    
                    <!-- Arkadaşlar Listesi -->
                    <div id="friends-section">
                        <h3><i class="fas fa-heart"></i> Arkadaşlarım (<span id="friends-count">${friends.length}</span>)</h3>
                        <div id="friends-list"></div>
                    </div>
                </div>
            `;
            
            // Verileri yükle ve göster
            loadLocalData();
            displayFriendRequests();
            displayFriends();
            displayCollaborativePlaylists();
            displayPartyInvitations();
            checkActivePartyMode();
        }

        function showSettingsPage() {
            currentView = 'settings';
            setActiveLink(settingsLink);
            searchContainer.classList.add('hidden');
            clearContentArea();
            
            const currentUsername = localStorage.getItem('h_sound_username') || 'Kullanıcı';
            const userRole = localStorage.getItem('h_sound_user_role') || 'Kullanıcı';
            
            contentArea.innerHTML = `
                <div class="settings-container">
                    <div class="content-header">
                        <h2><i class="fas fa-cog"></i> Hesap Ayarları</h2>
                        <p style="color: var(--secondary-text-color); font-size: 14px;">Hesap bilgilerinizi yönetin</p>
                    </div>
                    
                    <div class="settings-sections">
                        <!-- Hesap Bilgileri -->
                        <div class="settings-section">
                            <h3><i class="fas fa-user"></i> Hesap Bilgileri</h3>
                            <div class="settings-items">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Hesap Hakkında</div>
                                        <div class="setting-desc">Hesap detaylarını görüntüle</div>
                                    </div>
                                    <button class="setting-btn" onclick="showAccountInfo()">
                                        <i class="fas fa-info-circle"></i> Görüntüle
                                    </button>
                                </div>
                                
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Hesap Rolü</div>
                                        <div class="setting-desc">${userRole}</div>
                                    </div>
                                    <button class="setting-btn" onclick="showRoleInfo()">
                                        <i class="fas fa-info-circle"></i> Bilgi
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dil Ayarları -->
                        <div class="settings-section">
                            <h3><i class="fas fa-globe"></i> Dil Ayarları</h3>
                            <div class="settings-items">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Müzik Dili</div>
                                        <div class="setting-desc">Mevcut: ${languageNames[currentLanguage]}</div>
                                    </div>
                                    <button class="setting-btn" onclick="showLanguageSelector()">
                                        <i class="fas fa-language"></i> Değiştir
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hesap İşlemleri -->
                        <div class="settings-section danger-section">
                            <h3><i class="fas fa-exclamation-triangle"></i> Hesap İşlemleri</h3>
                            <div class="settings-items">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Hesabı Sil</div>
                                        <div class="setting-desc">Hesabınızı kalıcı olarak silin</div>
                                    </div>
                                    <button class="setting-btn btn-danger" onclick="deleteAccount()">
                                        <i class="fas fa-user-times"></i> Hesabı Sil
                                    </button>
                                </div>
                                
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Hesaptan Çık</div>
                                        <div class="setting-desc">Güvenli çıkış yapın</div>
                                    </div>
                                    <button class="setting-btn btn-warning" onclick="logout()">
                                        <i class="fas fa-sign-out-alt"></i> Çıkış Yap
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Yapımcı Bilgileri -->
                        <div class="settings-section">
                            <h3><i class="fas fa-certificate"></i> Lisans & Yapımcı</h3>
                            <div class="app-info">
                                <div class="info-item" style="text-align: center; padding: 30px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%); border-radius: 12px; color: white;">
                                    <i class="fas fa-certificate" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">Hakan Yusuf Alparmaklı</div>
                                    <div style="font-size: 16px; opacity: 0.9;">H-Sound Yapımcısı</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Dil seçici göster
        function showLanguageSelector() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-globe"></i> ${t('selectLanguage')}</h3>
                    <p style="color: var(--secondary-text-color); font-size: 14px; text-align: center; margin-bottom: 20px;">
                        ${currentLanguage === 'turkish' ? 'Uygulama dilini seçin.' : 'Select app language.'}
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <button class="btn ${currentLanguage === 'turkish' ? '' : 'btn-secondary'}" 
                                onclick="changeLanguage('turkish'); this.parentElement.parentElement.parentElement.remove();"
                                style="padding: 15px; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 8px; 
                                       ${currentLanguage === 'turkish' ? 'background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color)); color: white; border: 2px solid var(--primary-color);' : ''}">
                            Türkçe 🇹🇷
                        </button>
                        
                        <button class="btn ${currentLanguage === 'english' ? '' : 'btn-secondary'}" 
                                onclick="changeLanguage('english'); this.parentElement.parentElement.parentElement.remove();"
                                style="padding: 15px; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 8px; 
                                       ${currentLanguage === 'english' ? 'background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color)); color: white; border: 2px solid var(--primary-color);' : ''}">
                            English 🇺🇸
                        </button>
                    </div>
                    
                    <div style="background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid var(--primary-color);">
                        <p style="color: var(--text-color); font-size: 13px; margin: 0;">
                            <i class="fas fa-info-circle" style="color: var(--primary-color);"></i> 
                            <strong>${t('currentLanguage')}:</strong> ${languageNames[currentLanguage]}
                        </p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Dil değiştir
        function changeLanguage(languageCode) {
            currentLanguage = languageCode;
            localStorage.setItem('h_sound_language', languageCode);
            
            // Tüm sayfayı yeniden yükle (tüm metinleri güncellemek için)
            location.reload();
        }

        // Dile göre şarkıları getir
        function getLanguageSongs(languageCode, count = 12) {
            const languageSongs = localMusicDatabase[languageCode] || [];
            
            if (languageSongs.length === 0) {
                console.log(`⚠️ No songs found for language: ${languageCode}`);
                // Fallback olarak popüler müzikleri döndür
                return getLocalPopularMusic().slice(0, count);
            }
            
            // Şarkıları karıştır ve istenen sayıda döndür
            const shuffled = [...languageSongs].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, count);
            
            console.log(`🌍 Retrieved ${selected.length} ${languageCode} songs`);
            
            // YouTube formatına çevir
            return selected.map(song => ({
                videoId: song.id,
                title: song.title,
                artist: song.artist,
                thumbnail: song.thumbnail,
                channelTitle: song.artist,
                publishedAt: new Date().toISOString(),
                description: `${languageNames[languageCode]} müzik - ${song.title}`
            }));
        }

        // Sonsuz kaydırma ile müzik yükle
        function loadMusicByLanguage(page = 0, append = false) {
            const homeContent = document.getElementById('home-content');
            if (!homeContent) return;
            
            if (isLoading) return;
            isLoading = true;
            
            const songsPerPage = 12;
            const startIndex = page * songsPerPage;
            const languageSongs = localMusicDatabase[currentLanguage] || [];
            
            // Sonsuz döngü için şarkıları tekrarla
            const totalSongs = languageSongs.length;
            const songs = [];
            
            for (let i = 0; i < songsPerPage; i++) {
                const songIndex = (startIndex + i) % totalSongs;
                if (languageSongs[songIndex]) {
                    songs.push(languageSongs[songIndex]);
                }
            }
            
            if (songs.length === 0) {
                hasMoreContent = false;
                isLoading = false;
                return;
            }
            
            // Loading göster
            if (!append) {
                homeContent.innerHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h3 style="color: var(--primary-color); margin-bottom: 10px;">
                            <i class="fas fa-globe"></i> ${languageNames[currentLanguage]} Müzikleri
                        </h3>
                        <p style="color: var(--secondary-text-color); font-size: 14px;">
                            Aşağıya kaydırarak daha fazla müzik keşfedin
                        </p>
                    </div>
                    <div class="results-grid" id="music-grid"></div>
                    <div id="loading-indicator" class="loading-spinner" style="margin: 30px auto; display: none;"></div>
                `;
            }
            
            const musicGrid = document.getElementById('music-grid');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            if (loadingIndicator) {
                loadingIndicator.style.display = 'block';
            }
            
            // Simüle loading delay
            setTimeout(() => {
                // Check if musicGrid exists before trying to append
                if (!musicGrid) {
                    console.error('❌ musicGrid element not found');
                    isLoading = false;
                    return;
                }
                
                songs.forEach(song => {
                    const songElement = document.createElement('div');
                    songElement.className = 'result-item';
                    songElement.onclick = () => playSong(song.id, song.title, song.thumbnail, song.artist);
                    songElement.innerHTML = `
                        <img src="${song.thumbnail}" alt="${song.title}" onerror="handleThumbnailError(this)" onload="handleThumbnailLoad(this)">
                        <div class="item-title">${song.title}</div>
                        <button class="add-to-playlist-btn" onclick="event.stopPropagation(); addToPlaylist('${song.id}', '${song.title.replace(/'/g, "\\'")}', '${song.thumbnail}', '${song.artist.replace(/'/g, "\\'")}')">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="add-to-collaborative-btn" onclick="event.stopPropagation(); addToCollaborativePlaylist('${song.id}', '${song.title.replace(/'/g, "\\'")}', '${song.thumbnail}', '${song.artist.replace(/'/g, "\\'")}')">
                            <i class="fas fa-users"></i>
                        </button>
                    `;
                    musicGrid.appendChild(songElement);
                });
                
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
                
                isLoading = false;
                console.log(`✅ Loaded ${songs.length} ${languageNames[currentLanguage]} songs (page ${page + 1})`);
            }, 500);
        }

        // Scroll event listener for infinite scroll
        function setupInfiniteScroll() {
            let scrollTimeout;
            
            const mainContent = document.getElementById('main-content');
            if (!mainContent) return;
            
            // Infinite scroll KALICI olarak devre dışı bırakıldı
            // mainContent.addEventListener('scroll', () => {
            //     if (currentView !== 'home' || isLoadingMore || !hasMoreHomeContent) return;
            //     
            //     clearTimeout(scrollTimeout);
            //     scrollTimeout = setTimeout(() => {
            //         const scrollTop = mainContent.scrollTop;
            //         const scrollHeight = mainContent.scrollHeight;
            //         const clientHeight = mainContent.clientHeight;
            //         
            //         // Sayfa sonuna yaklaştığında yeni içerik yükle (daha erken tetikle)
            //         if (scrollTop + clientHeight >= scrollHeight - 100) {
            //             console.log(`🔄 Infinite scroll tetiklendi - Sayfa ${homeScrollPage + 1} yükleniyor...`);
            //             homeScrollPage++;
            //             isLoadingMore = true;
            //             loadLocalHomeMusic(homeScrollPage, true).then(() => {
            //                 isLoadingMore = false;
            //             }).catch((error) => {
            //                 console.log('🔄 Sayfa yükleme hatası, ama devam ediyoruz:', error);
            //                 isLoadingMore = false;
            //                 // hasMoreHomeContent = false; // KALDIRILDI - Sınırsız scroll için
            //                 // Hata durumunda bile devam et, bir sonraki scroll'da tekrar dene
            //             });
            //         }
            //     }, 100);
            // });
            
            console.log('🚫 Ana sayfa infinite scroll KALICI olarak devre dışı bırakıldı');
        }

        // Çalma Listesi Yönetimi
        function createNewPlaylist() {
            const playlistName = prompt('Çalma listesi adı:');
            if (!playlistName || !playlistName.trim()) return;
            
            const currentUser = localStorage.getItem('h_sound_username');
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${currentUser}`) || '[]');
            
            const newPlaylist = {
                name: playlistName.trim(),
                songs: [],
                createdDate: Date.now()
            };
            
            userPlaylists.push(newPlaylist);
            localStorage.setItem(`h_sound_playlists_${currentUser}`, JSON.stringify(userPlaylists));
            
            showNotification(`"${playlistName}" çalma listesi oluşturuldu!`, 'success');
            showPlaylistsPage();
        }

        function deletePlaylist(index) {
            const currentUser = localStorage.getItem('h_sound_username');
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${currentUser}`) || '[]');
            
            if (confirm(`"${userPlaylists[index].name}" çalma listesini silmek istediğinizden emin misiniz?`)) {
                userPlaylists.splice(index, 1);
                localStorage.setItem(`h_sound_playlists_${currentUser}`, JSON.stringify(userPlaylists));
                showNotification('Çalma listesi silindi', 'info');
                showPlaylistsPage();
            }
        }

        function openPlaylist(index) {
            const currentUser = localStorage.getItem('h_sound_username');
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${currentUser}`) || '[]');
            const playlist = userPlaylists[index];
            
            if (!playlist) return;
            
            contentArea.innerHTML = `
                <div class="content-header">
                    <h2><i class="fas fa-compact-disc"></i> ${playlist.name}</h2>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="showPlaylistsPage()" class="search-btn">
                            <i class="fas fa-arrow-left"></i> Geri
                        </button>
                        <button onclick="playAllPlaylist(${index})" class="search-btn" ${playlist.songs.length === 0 ? 'disabled' : ''}>
                            <i class="fas fa-play"></i> Tümünü Çal
                        </button>
                    </div>
                </div>
                
                <div class="playlist-songs">
                    ${playlist.songs.length === 0 ? `
                        <div class="no-content-message">
                            <i class="fas fa-music" style="font-size: 48px; color: var(--primary-color); margin-bottom: 20px;"></i>
                            <h3>Bu Çalma Listesi Boş</h3>
                            <p>Şarkı aramaya giderek çalma listesine şarkı ekleyebilirsiniz.</p>
                        </div>
                    ` : `
                        <div class="results-grid">
                            ${playlist.songs.map((song, songIndex) => `
                                <div class="result-item" onclick="playSong('${song.videoId}', '${song.title.replace(/'/g, "\\'")}', '${song.thumbnail}', '${song.artist.replace(/'/g, "\\'")}')">
                                    <img src="${song.thumbnail}" alt="${song.title}" onerror="handleThumbnailError(this)" onload="handleThumbnailLoad(this)">
                                    <div class="item-title">${song.title}</div>
                                    <button class="playlist-delete-btn" onclick="event.stopPropagation(); removeSongFromPlaylist(${index}, ${songIndex})" title="Şarkıyı Kaldır">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        function addToPlaylist(videoId, title, thumbnail, artist) {
            console.log('🎵 Adding to playlist:', title);
            
            const currentUser = localStorage.getItem('h_sound_username');
            console.log('Current user:', currentUser);
            
            if (!currentUser) {
                showNotification('Çalma listesi kullanmak için giriş yapın!', 'warning');
                return;
            }
            
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${currentUser}`) || '[]');
            console.log('User playlists:', userPlaylists);
            
            if (userPlaylists.length === 0) {
                showNotification('Önce bir çalma listesi oluşturun!', 'warning');
                console.log('⚠️ No playlists found');
                return;
            }
            
            // Show playlist selection modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-plus"></i> Çalma Listesine Ekle</h3>
                    <p><strong>${title}</strong> - ${artist}</p>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${userPlaylists.map((playlist, index) => `
                            <button class="btn" onclick="addSongToPlaylist(${index}, '${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${artist.replace(/'/g, "\\'")}'); this.parentElement.parentElement.parentElement.remove();" 
                                    style="width: 100%; margin: 5px 0; text-align: left;">
                                <i class="fas fa-compact-disc"></i> ${playlist.name} (${playlist.songs.length} şarkı)
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            console.log('✅ Playlist selection modal shown');
        }

        function addSongToPlaylist(playlistIndex, videoId, title, thumbnail, artist) {
            console.log('🎵 Adding song to playlist:', { playlistIndex, videoId, title, artist });
            
            const currentUser = localStorage.getItem('h_sound_username');
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${currentUser}`) || '[]');
            
            console.log('User playlists:', userPlaylists);
            console.log('Target playlist index:', playlistIndex);
            
            if (!userPlaylists[playlistIndex]) {
                console.error('❌ Playlist not found at index:', playlistIndex);
                showNotification('Çalma listesi bulunamadı!', 'error');
                return;
            }
            
            const song = { videoId, title, thumbnail, artist };
            
            // Check if song already exists in playlist
            if (userPlaylists[playlistIndex].songs.some(s => s.videoId === videoId)) {
                console.log('⚠️ Song already exists in playlist');
                showNotification('Bu şarkı zaten çalma listesinde!', 'warning');
                return;
            }
            
            userPlaylists[playlistIndex].songs.push(song);
            localStorage.setItem(`h_sound_playlists_${currentUser}`, JSON.stringify(userPlaylists));
            
            console.log('✅ Song added to playlist successfully');
            showNotification(`"${title}" şarkısı "${userPlaylists[playlistIndex].name}" listesine eklendi!`, 'success');
        }

        function removeSongFromPlaylist(playlistIndex, songIndex) {
            const currentUser = localStorage.getItem('h_sound_username');
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${currentUser}`) || '[]');
            
            const removedSong = userPlaylists[playlistIndex].songs[songIndex];
            userPlaylists[playlistIndex].songs.splice(songIndex, 1);
            localStorage.setItem(`h_sound_playlists_${currentUser}`, JSON.stringify(userPlaylists));
            
            showNotification(`"${removedSong.title}" çalma listesinden kaldırıldı`, 'info');
            openPlaylist(playlistIndex);
        }

        function playAllPlaylist(playlistIndex) {
            const currentUser = localStorage.getItem('h_sound_username');
            const userPlaylists = JSON.parse(localStorage.getItem(`h_sound_playlists_${currentUser}`) || '[]');
            const playlistSongs = userPlaylists[playlistIndex].songs;
            
            if (playlistSongs.length === 0) return;
            
            // Clear current playlist and add all songs
            playlist = [...playlistSongs];
            currentSongIndex = 0;
            
            const firstSong = playlist[0];
            playSong(firstSong.videoId, firstSong.title, firstSong.thumbnail, firstSong.artist);
            
            showNotification(`"${userPlaylists[playlistIndex].name}" çalma listesi başlatıldı!`, 'success');
        }

        // Süper Admin Paneli
        function showSuperAdminPage() {
            currentView = 'superadmin';
            setActiveLink(document.getElementById('superadmin-link'));
            searchContainer.classList.add('hidden');
            clearContentArea();
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            const totalUsers = Object.keys(savedUsers).length;
            const totalFriends = friends.length;
            
            // Kullanıcı istatistikleri
            const roleStats = {};
            Object.values(savedUsers).forEach(user => {
                roleStats[user.role] = (roleStats[user.role] || 0) + 1;
            });
            
            contentArea.innerHTML = `
                <div class="superadmin-container">
                    <div class="admin-header">
                        <h1><i class="fas fa-crown"></i> Süper Admin Panel</h1>
                        <p>H-Sound Sistem Yönetimi - Hoş geldiniz, ${localStorage.getItem('h_sound_username')}</p>
                    </div>
                    
                    <div class="admin-stats">
                        <div class="stat-card">
                            <h3>${totalUsers}</h3>
                            <p><i class="fas fa-users"></i> Toplam Kullanıcı</p>
                        </div>
                        <div class="stat-card">
                            <h3>${roleStats['Süper Admin'] || 0}</h3>
                            <p><i class="fas fa-crown"></i> Süper Admin</p>
                        </div>
                        <div class="stat-card">
                            <h3>${roleStats['VIP'] || 0}</h3>
                            <p><i class="fas fa-gem"></i> VIP Kullanıcı</p>
                        </div>
                        <div class="stat-card">
                            <h3>${roleStats['Premium'] || 0}</h3>
                            <p><i class="fas fa-star"></i> Premium</p>
                        </div>
                        <div class="stat-card">
                            <h3>${(roleStats['User'] || 0) + (roleStats['Kullanıcı'] || 0)}</h3>
                            <p><i class="fas fa-user"></i> Normal Kullanıcı</p>
                        </div>
                    </div>
                    
                    <div class="users-table-container">
                        <div class="table-header">
                            <h2><i class="fas fa-users-cog"></i> Kullanıcı Yönetimi</h2>
                            <button class="refresh-btn" onclick="showSuperAdminPage()">
                                <i class="fas fa-sync-alt"></i> Yenile
                            </button>
                        </div>
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>Kullanıcı Adı</th>
                                    <th>Rol</th>
                                    <th>Kayıt Tarihi</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                ${generateUsersTableRows(savedUsers)}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Kullanıcı tablosu satırları oluştur
        function generateUsersTableRows(users) {
            let rows = '';
            Object.entries(users).forEach(([username, userData]) => {
                const roleClass = userData.role.toLowerCase().replace(' ', '').replace('ü', 'u');
                const registerDate = new Date(userData.registerDate).toLocaleDateString('tr-TR');
                
                rows += `
                    <tr>
                        <td>
                            <strong>${username}</strong>
                            ${username === 'Hakan' ? '<i class="fas fa-crown" style="color: #E74C3C; margin-left: 5px;" title="Sistem Yöneticisi"></i>' : ''}
                        </td>
                        <td>
                            <span class="role-badge role-${roleClass}">${userData.role}</span>
                        </td>
                        <td>${registerDate}</td>
                        <td>
                            <button class="action-btn btn-edit" onclick="showUserPassword('${username}', '${userData.password}')">
                                <i class="fas fa-eye"></i> Şifre
                            </button>
                            ${username !== 'Hakan' ? `
                                <button class="action-btn btn-edit" onclick="editUserRole('${username}')">
                                    <i class="fas fa-edit"></i> Rol Değiştir
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteUser('${username}')">
                                    <i class="fas fa-trash"></i> Sil
                                </button>
                            ` : `
                                <span style="color: #E74C3C; font-weight: 600;">
                                    <i class="fas fa-shield-alt"></i> Korumalı
                                </span>
                            `}
                        </td>
                    </tr>
                `;
            });
            return rows;
        }

        // Search function (YouTube API + Local Database)
        async function searchMusic(query) {
            if (!query.trim()) return;
            
            contentArea.innerHTML = '<div class="loading-spinner"></div>';
            
            try {
                console.log('🔍 Searching with YouTube API...');
                
                // YouTube API ile ara
                const youtubeResults = await searchYouTubeMusic(query, 20);
                
                if (youtubeResults && youtubeResults.length > 0) {
                    displayResults(youtubeResults);
                    showNotification(`${youtubeResults.length} sonuç YouTube'dan bulundu!`, 'success');
                } else {
                    // YouTube API başarısız olursa yerel veritabanını kullan
                    console.log('🔄 YouTube API failed, using local database...');
                    const localResults = searchLocalMusic(query, 20);
                    
                    if (localResults && localResults.length > 0) {
                        displayResults(localResults);
                        showNotification(`${localResults.length} yerel sonuç bulundu`, 'info');
                    } else {
                        contentArea.innerHTML = `
                            <div class="content-header">
                                <h2><i class="fas fa-search"></i> Arama Sonuçları</h2>
                            </div>
                            <div class="no-content-message">
                                "${query}" için sonuç bulunamadı. Farklı anahtar kelimeler deneyin.
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Search error:', error);
                // Fallback arama sonuçları göster
                displayFallbackSearchResults(query);
            }
        }

        // Yerel veritabanında arama (fallback)
        function searchLocalMusic(query, maxResults = 12) {
            const allSongs = [];
            
            // Tüm dillerdeki şarkıları topla
            Object.values(localMusicDatabase).forEach(songs => {
                if (Array.isArray(songs)) {
                    allSongs.push(...songs);
                }
            });
            
            // Arama yap
            const searchTerms = query.toLowerCase().split(' ');
            const results = allSongs.filter(song => {
                const searchText = `${song.title} ${song.artist}`.toLowerCase();
                return searchTerms.some(term => searchText.includes(term));
            });
            
            return results.slice(0, maxResults).map(song => ({
                videoId: song.id,
                title: song.title,
                artist: song.artist,
                thumbnail: `https://img.youtube.com/vi/${song.id}/mqdefault.jpg`
            }));
        }

        function displayFallbackSearchResults(query) {
            console.log('📱 Using local database fallback results');
            
            // Yerel veritabanından sonuçlar al
            const localResults = searchLocalMusic(query, 12);
            
            if (localResults.length > 0) {
                displayResults(localResults);
                showNotification('Yerel veritabanından sonuçlar gösteriliyor', 'info');
            } else {
                // Eğer hiç sonuç yoksa popüler müzikleri göster
                const popularItems = localMusicDatabase['popular music'].slice(0, 6).map(song => ({
                    id: { videoId: song.id },
                    snippet: {
                        title: song.title,
                        channelTitle: song.artist,
                        thumbnails: { medium: { url: song.thumbnail } }
                    }
                }));
                
                contentArea.innerHTML = `
                    <div class="content-header">
                        <h2><i class="fas fa-search"></i> "${query}" Arama Sonuçları</h2>
                    </div>
                    <div style="margin-bottom: 20px; padding: 15px; background-color: #2C2C2C; border-radius: 8px; text-align: center;">
                        <p><i class="fas fa-info-circle"></i> Aradığınız terim bulunamadı. Popüler müzikler gösteriliyor.</p>
                    </div>
                    <div class="results-grid">
                `;
                
                popularItems.forEach(item => {
                    const videoId = item.id.videoId;
                    const title = item.snippet.title;
                    const thumbnail = item.snippet.thumbnails.medium.url;
                    const channelTitle = item.snippet.channelTitle;
                    
                    contentArea.innerHTML += `
                        <div class="result-item" onclick="playSong('${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${channelTitle.replace(/'/g, "\\'")}')">
                            <img src="${thumbnail}" alt="${title}" onerror="handleThumbnailError(this)" onload="handleThumbnailLoad(this)">
                            <div class="item-title">${title}</div>
                            <button class="add-to-playlist-btn" onclick="event.stopPropagation(); addToPlaylist('${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${channelTitle.replace(/'/g, "\\'")}')">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="add-to-collaborative-btn" onclick="event.stopPropagation(); addToCollaborativePlaylist('${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${channelTitle.replace(/'/g, "\\'")}')">
                                <i class="fas fa-users"></i>
                            </button>
                        </div>
                    `;
                });
                
                contentArea.innerHTML += '</div>';
            }
        }

        function displayResults(items, append = false) {
            const targetContainer = document.getElementById('home-content') || contentArea;
            
            if (!append) {
                // Yeni arama - içeriği temizle
                if (targetContainer.id === 'home-content') {
                    targetContainer.innerHTML = '';
                } else {
                    let html = `
                        <div class="content-header">
                            <h2><i class="fas fa-search"></i> Arama Sonuçları</h2>
                        </div>
                        <div class="results-grid" id="results-container">
                    `;
                    targetContainer.innerHTML = html;
                }
            }
            
            // Sonuçları ekle
            let html = '';
            items.forEach((item, index) => {
                // Yeni format ile uyumlu - videoId direkt item'da olabilir
                const videoId = item.videoId || (item.id && item.id.videoId) || item.id;
                const title = item.title || (item.snippet && item.snippet.title) || 'Bilinmeyen Şarkı';
                const thumbnail = item.thumbnail || 
                                (item.snippet && item.snippet.thumbnails && item.snippet.thumbnails.medium && item.snippet.thumbnails.medium.url) ||
                                `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
                const artist = item.artist || (item.snippet && item.snippet.channelTitle) || 'Bilinmeyen Sanatçı';
                
                // Güvenli string escape
                const safeTitle = title.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const safeArtist = artist.replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                html += `
                    <div class="result-item" onclick="playSong('${videoId}', '${safeTitle}', '${thumbnail}', '${safeArtist}')">
                        <img src="${thumbnail}" alt="${title}" onerror="handleThumbnailError(this)" onload="handleThumbnailLoad(this)">
                        <div class="item-title">${title}</div>
                        <button class="add-to-playlist-btn" onclick="event.stopPropagation(); addToPlaylist('${videoId}', '${safeTitle}', '${thumbnail}', '${safeArtist}')">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="add-to-collaborative-btn" onclick="event.stopPropagation(); addToCollaborativePlaylist('${videoId}', '${safeTitle}', '${thumbnail}', '${safeArtist}')">
                            <i class="fas fa-users"></i>
                        </button>
                    </div>
                `;
            });
            
            if (targetContainer.id === 'home-content') {
                // Ana sayfa - direkt ekle
                targetContainer.innerHTML += html;
            } else {
                // Arama sayfası - results-container'a ekle
                const resultsContainer = document.getElementById('results-container') || targetContainer;
                if (append) {
                    resultsContainer.innerHTML += html;
                } else {
                    resultsContainer.innerHTML = html;
                    targetContainer.innerHTML += '</div>'; // results-grid'i kapat
                }
            }
        }

        // Music player functions - Gelişmiş Playlist Sistemi
        function playSong(videoId, title, thumbnail, artist = 'Bilinmeyen Sanatçı') {
            console.log(`🎵 Playing song: ${title} by ${artist} (ID: ${videoId})`);
            
            // Önceki progress interval'leri temizle
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
            if (window.youtubeProgressInterval) {
                clearInterval(window.youtubeProgressInterval);
                window.youtubeProgressInterval = null;
            }
            
            // Progress bar'ı sıfırla
            const progress = document.getElementById('progress');
            const currentTime = document.getElementById('current-time');
            if (progress) progress.style.width = '0%';
            if (currentTime) currentTime.textContent = '0:00';
            
            // Update player info immediately
            songTitle.textContent = title;
            songArtist.textContent = artist;
            songThumbnail.src = thumbnail;
            
            // Handle thumbnail error
            songThumbnail.onerror = function() {
                this.src = 'https://via.placeholder.com/50x50/3498DB/ffffff?text=H';
            };
            
            // Show player
            playerFooter.classList.remove('hidden');
            
            // Mevcut görünümdeki tüm şarkıları playlist'e ekle (sadece playlist boşsa)
            if (playlist.length === 0) {
                updatePlaylistFromCurrentView();
            }
            
            // Tıklanan şarkının index'ini bul
            let songIndex = playlist.findIndex(song => song.videoId === videoId);
            
            if (songIndex === -1) {
                // Şarkı playlist'te yoksa ekle
                playlist.push({
                    videoId: videoId,
                    title: title,
                    thumbnail: thumbnail,
                    artist: artist
                });
                songIndex = playlist.length - 1;
            }
            
            // Doğru şarkıyı çalmak için index'i güncelle
            currentSongIndex = songIndex;
            
            console.log(`📋 Playing song at index: ${currentSongIndex + 1}/${playlist.length} - ${title}`);
            
            // Background Music Manager entegrasyonu
            if (window.backgroundMusicManager) {
                window.backgroundMusicManager.setCurrentTrack({
                    title: title,
                    artist: artist,
                    thumbnail: thumbnail,
                    videoId: videoId
                });
            }
            
            // Gerçek müzik çalma - Bu şarkıyı çal
            playRealAudio(videoId, title);
            
            console.log(`✅ Now playing: ${title} by ${artist}`);
        }

        // Mevcut görünümdeki şarkıları playlist'e ekle
        function updatePlaylistFromCurrentView() {
            const songs = [];
            const resultItems = document.querySelectorAll('.result-item');
            
            resultItems.forEach(item => {
                const onclick = item.getAttribute('onclick');
                if (onclick) {
                    // onclick'ten şarkı bilgilerini çıkar
                    const match = onclick.match(/playSong\('([^']+)',\s*'([^']*)',\s*'([^']*)',\s*'([^']*)'\)/);
                    if (match) {
                        songs.push({
                            videoId: match[1],
                            title: match[2].replace(/\\'/g, "'").replace(/\\"/g, '"'),
                            thumbnail: match[3],
                            artist: match[4].replace(/\\'/g, "'").replace(/\\"/g, '"')
                        });
                    }
                }
            });
            
            // Playlist'i güncelle (sadece yeni şarkılar varsa)
            if (songs.length > 0) {
                playlist = songs;
                console.log(`📋 Playlist updated with ${playlist.length} songs`);
            }
        }

        // YouTube Data API v3 Configuration - Çoklu API Key Sistemi
        // CORS PROXY + SCRAPING SİSTEMİ - TAMAMEN ÜCRETSİZ! 🆓
        // Invidious CORS sorununu çözmek için proxy kullanıyoruz
        const CORS_PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?',
            'https://cors-anywhere.herokuapp.com/',
            'https://thingproxy.freeboard.io/fetch/'
        ];
        
        const INVIDIOUS_INSTANCES = [
            'https://y.com.sb',
            'https://invidious.privacydev.net',
            'https://vid.puffyan.us',
            'https://invidious.weblibre.org',
            'https://inv.odyssey346.dev'
        ]; // Çalışan instance'lar - tamamen ücretsiz!
        
        let currentInstanceIndex = 0;
        let currentProxyIndex = 0;

        // Invidious thumbnail seçici - en iyi kaliteyi seç
        function getBestThumbnail(videoThumbnails) {
            if (!videoThumbnails || !Array.isArray(videoThumbnails) || videoThumbnails.length === 0) {
                return 'https://via.placeholder.com/320x180/3498DB/ffffff?text=H-Sound';
            }
            
            // Kalite öncelik sırası: medium > high > default > maxres
            const qualityPriority = ['medium', 'high', 'default', 'maxres'];
            
            for (const quality of qualityPriority) {
                const thumbnail = videoThumbnails.find(t => t.quality === quality);
                if (thumbnail && thumbnail.url) {
                    return thumbnail.url;
                }
            }
            
            // Hiçbiri bulunamazsa ilk thumbnail'i al
            return videoThumbnails[0]?.url || 'https://via.placeholder.com/320x180/3498DB/ffffff?text=H-Sound';
        }

        // CORS Proxy + Invidious instance rotation
        function getNextInvidiousInstance() {
            const instance = INVIDIOUS_INSTANCES[currentInstanceIndex];
            console.log(`🆓 Using Invidious Instance ${currentInstanceIndex + 1}/${INVIDIOUS_INSTANCES.length}: ${instance}`);
            return instance;
        }

        function getNextCorsProxy() {
            const proxy = CORS_PROXIES[currentProxyIndex];
            console.log(`🔄 Using CORS Proxy ${currentProxyIndex + 1}/${CORS_PROXIES.length}: ${proxy}`);
            return proxy;
        }

        function rotateInvidiousInstance() {
            currentInstanceIndex = (currentInstanceIndex + 1) % INVIDIOUS_INSTANCES.length;
            console.log(`🔄 Rotating to Invidious Instance ${currentInstanceIndex + 1}: ${INVIDIOUS_INSTANCES[currentInstanceIndex]}`);
        }

        function rotateCorsProxy() {
            currentProxyIndex = (currentProxyIndex + 1) % CORS_PROXIES.length;
            console.log(`🔄 Rotating to CORS Proxy ${currentProxyIndex + 1}: ${CORS_PROXIES[currentProxyIndex]}`);
        }

        // YouTube IFrame Player API ile gerçek müzik çalma
        let youtubePlayer = null;
        let youtubePlayerReady = false;

        // YouTube IFrame API'yi yükle
        function loadYouTubeIFrameAPI() {
            if (window.YT && window.YT.Player) {
                youtubePlayerReady = true;
                console.log('⚡ YouTube API already loaded');
                
                // Hızlı çalma için dummy player oluştur
                createDummyYouTubePlayer();
                return;
            }
            
            console.log('🚀 Loading YouTube IFrame API for fast playback...');
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            tag.async = true;
            tag.defer = true;
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
        
        // Hızlı çalma için dummy player oluştur
        function createDummyYouTubePlayer() {
            if (youtubePlayer && youtubePlayerReady) {
                console.log('⚡ Dummy player already exists');
                return;
            }
            
            try {
                console.log('🔧 Creating dummy YouTube player for fast switching...');
                
                // Gizli container oluştur
                const dummyContainer = document.createElement('div');
                dummyContainer.id = 'youtube-dummy-player';
                dummyContainer.style.position = 'fixed';
                dummyContainer.style.top = '-2000px';
                dummyContainer.style.left = '-2000px';
                dummyContainer.style.width = '1px';
                dummyContainer.style.height = '1px';
                dummyContainer.style.opacity = '0';
                dummyContainer.style.pointerEvents = 'none';
                document.body.appendChild(dummyContainer);
                
                // Dummy player oluştur (sessiz video ile)
                youtubePlayer = new YT.Player('youtube-dummy-player', {
                    height: '1',
                    width: '1',
                    videoId: 'dQw4w9WgXcQ', // Rick Roll - her zaman çalışır :)
                    playerVars: {
                        autoplay: 0,        // Otomatik başlatma
                        controls: 0,
                        disablekb: 1,
                        fs: 0,
                        modestbranding: 1,
                        rel: 0,
                        showinfo: 0,
                        iv_load_policy: 3,
                        cc_load_policy: 0,
                        playsinline: 1,
                        mute: 1            // Sessiz
                    },
                    events: {
                        onReady: function(event) {
                            console.log('⚡ Dummy YouTube player ready - Fast switching enabled!');
                            youtubePlayerReady = true;
                            player = youtubePlayer;
                            playerReady = true;
                            
                            // Dummy player'ı sessiz çal ve hemen durdur
                            event.target.mute();
                            event.target.setVolume(0);
                            event.target.pauseVideo();
                            
                            console.log('🔇 Dummy player muted and paused');
                        },
                        onError: function(event) {
                            console.log('⚠️ Dummy player error (normal):', event.data);
                        }
                    }
                });
                
            } catch (error) {
                console.log('⚠️ Dummy player creation failed:', error);
            }
        }

        // YouTube API hazır olduğunda çağrılır
        window.onYouTubeIframeAPIReady = function() {
            console.log('⚡ YouTube IFrame API loaded - Fast playback ready!');
            youtubePlayerReady = true;
            
            // Hızlı çalma için dummy player oluştur
            createDummyYouTubePlayer();
            
            // Eğer bekleyen bir çalma isteği varsa, onu çal
            if (window.pendingVideoId && window.pendingTitle) {
                const duration = window.pendingDuration || 180;
                console.log(`⚡ Playing pending song: ${window.pendingTitle} (${window.pendingVideoId})`);
                playWithYouTubeIFrame(window.pendingVideoId, window.pendingTitle, duration).then((result) => {
                    if (window.pendingResolve) {
                        window.pendingResolve(result);
                    }
                });
                window.pendingVideoId = null;
                window.pendingTitle = null;
                window.pendingDuration = null;
                window.pendingResolve = null;
            }
        };

        // Gerçek YouTube müzik çalma - Protocol aware
        async function playRealAudio(videoId, title) {
            console.log(`🎵 Playing YouTube music: ${title} (ID: ${videoId})`);
            
            if (!videoId || videoId === 'undefined') {
                console.error('❌ Invalid video ID');
                return;
            }
            
            // Hızlı başlatma için varsayılan süre kullan - detayları arka planda al
            let songDuration = 180; // Varsayılan 3 dakika
            console.log(`🚀 Quick start with default duration: ${formatTime(songDuration)}`);
            
            // file:// protokolü kontrolü - YouTube IFrame API file:// ile çalışmaz
            if (window.location.protocol === 'file:') {
                console.log('ℹ️ File protocol detected, using simple iframe fallback');
                playSimpleIframe(videoId, title, songDuration);
                
                // Arka planda gerçek süreyi al
                getVideoDetailsInBackground(videoId);
                return;
            }
            
            // HTTP/HTTPS protokolü - YouTube IFrame API kullan (hızlı başlatma)
            try {
                const success = await tryPlayYouTubeMusic(videoId, title, songDuration);
                if (success) {
                    console.log(`✅ Successfully playing: ${title}`);
                    
                    // Arka planda gerçek süreyi al ve güncelle
                    getVideoDetailsInBackground(videoId);
                } else {
                    console.log(`⚠️ Failed to play: ${title}, using fallback`);
                    // Fallback: Basit iframe embed
                    playSimpleIframe(videoId, title, songDuration);
                }
            } catch (error) {
                console.error('❌ Error playing YouTube music:', error);
                // Fallback: Basit iframe embed
                playSimpleIframe(videoId, title, songDuration);
            }
        }
        
        // Arka planda video detaylarını al (çalmayı engellemez) - DÜZELTILDI
        async function getVideoDetailsInBackground(videoId) {
            try {
                console.log(`🔍 Getting duration in background for: ${videoId}`);
                
                // YouTube player'dan gerçek süreyi al
                if (youtubePlayer && youtubePlayerReady) {
                    try {
                        const realDuration = youtubePlayer.getDuration();
                        if (realDuration && realDuration > 0) {
                            console.log(`⏱️ Real duration from player: ${formatTime(realDuration)}`);
                            
                            // Progress bar'ı güncelle
                            window.currentSongDuration = realDuration;
                            return;
                        }
                    } catch (error) {
                        console.log('⚠️ Could not get duration from player:', error.message);
                    }
                }
                
                // API'den video detaylarını al
                const videoDetails = await getVideoDetails(videoId);
                
                if (videoDetails && videoDetails.duration) {
                    const realDuration = parseYouTubeDuration(videoDetails.duration);
                    console.log(`⏱️ Real duration from API: ${formatTime(realDuration)} (${videoDetails.duration})`);
                    
                    // Progress bar'ı güncelle
                    if (window.currentSongDuration !== realDuration) {
                        window.currentSongDuration = realDuration;
                        console.log(`🔄 Duration updated to: ${formatTime(realDuration)}`);
                    }
                }
            } catch (error) {
                console.log('⚠️ Background duration fetch failed:', error.message);
            }
        }
        
        // Basit iframe fallback - file:// protokolü için
        function playSimpleIframe(videoId, title, duration = null) {
            console.log(`🎵 Using simple iframe for: ${title} (${videoId})`);
            
            // Önceki player'ı temizle
            const existingContainer = document.getElementById('youtube-player-container');
            if (existingContainer) {
                existingContainer.remove();
            }
            
            const playerContainer = document.createElement('div');
            playerContainer.id = 'youtube-player-container';
            playerContainer.style.cssText = 'position: fixed; top: -9999px; left: -9999px; width: 1px; height: 1px;';
            document.body.appendChild(playerContainer);
            
            // Autoplay parametresi - file:// protokolünde çalışmayabilir
            const autoplayParam = window.location.protocol === 'file:' ? '0' : '1';
            
            playerContainer.innerHTML = `
                <iframe 
                    id="youtube-iframe-player"
                    width="1" 
                    height="1" 
                    src="https://www.youtube.com/embed/${videoId}?autoplay=${autoplayParam}&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&showinfo=0&loop=1&playlist=${videoId}" 
                    frameborder="0" 
                    allow="autoplay; encrypted-media">
                </iframe>
            `;
            
            isPlaying = true;
            playerReady = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            
            // file:// protokolünde autoplay çalışmayabilir uyarısı
            if (window.location.protocol === 'file:') {
                showNotification(`"${title}" yüklendi - Manuel başlatma gerekebilir 🎵`, 'warning');
                console.log('⚠️ File protocol: Autoplay may not work, manual play required');
            } else {
                showNotification(`"${title}" çalıyor 🎵`, 'success');
            }
            
            // Gerçek süre ile progress tracking başlat
            const realDuration = duration || 180; // Varsayılan 3 dakika
            startYouTubeProgressTracking(realDuration);
        }

        // YouTube ISO 8601 duration'ı saniyeye çevir (PT4M13S -> 253 saniye)
        function parseYouTubeDuration(duration) {
            if (!duration) return 180; // Varsayılan 3 dakika
            
            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!match) return 180;
            
            const hours = parseInt(match[1]) || 0;
            const minutes = parseInt(match[2]) || 0;
            const seconds = parseInt(match[3]) || 0;
            
            return hours * 3600 + minutes * 60 + seconds;
        }

        // Müzik videosu kontrolü - sadece müzik içeriği
        function isMusicVideo(title, description, channelTitle) {
            const titleLower = title.toLowerCase();
            const descriptionLower = (description || '').toLowerCase();
            const channelLower = channelTitle.toLowerCase();
            
            // Müzik olmayan içerik türleri (RED LIST)
            const nonMusicKeywords = [
                // Podcast ve konuşma
                'podcast', 'röportaj', 'interview', 'konuşma', 'sohbet', 'talk show',
                'canlı yayın', 'live stream', 'radyo', 'radio',
                
                // Vlog ve günlük
                'vlog', 'günlük', 'daily', 'hayatım', 'my life', 'günüm',
                
                // Eğitim ve tutorial
                'tutorial', 'nasıl yapılır', 'how to', 'öğretici', 'ders', 'lesson',
                'eğitim', 'education', 'kurs', 'course',
                
                // Haber ve politika
                'haber', 'news', 'politika', 'politics', 'gündem', 'breaking',
                
                // Oyun ve teknoloji
                'gameplay', 'oyun', 'game', 'teknoloji', 'technology', 'review',
                'inceleme', 'test', 'unboxing',
                
                // Komedi ve eğlence (müzik olmayan)
                'komedi', 'comedy', 'stand up', 'sketch', 'parodi olmayan',
                
                // Spor
                'maç', 'match', 'futbol', 'football', 'basketbol', 'spor',
                
                // Diğer
                'reaction', 'tepki', 'analiz', 'analysis', 'belgesel', 'documentary'
            ];
            
            // Müzik pozitif anahtar kelimeler (GREEN LIST)
            const musicKeywords = [
                // Genel müzik
                'music', 'müzik', 'song', 'şarkı', 'track', 'parça',
                'album', 'single', 'ep', 'remix', 'cover',
                
                // Müzik türleri
                'rap', 'hip hop', 'pop', 'rock', 'jazz', 'blues', 'electronic',
                'türkçe rap', 'trap', 'drill', 'r&b', 'soul', 'funk',
                'arabesque', 'arabesk', 'türk sanat müziği', 'halk müziği',
                
                // Müzik terimleri
                'official video', 'official audio', 'music video', 'lyric video',
                'acoustic', 'live performance', 'concert', 'konser',
                'feat', 'featuring', 'ft', 'vs', 'x', 'collaboration',
                
                // Müzik kanalları
                'records', 'music', 'entertainment', 'official', 'vevo'
            ];
            
            // Önce müzik olmayan içerikleri filtrele
            for (const keyword of nonMusicKeywords) {
                if (titleLower.includes(keyword) || descriptionLower.includes(keyword)) {
                    console.log(`🚫 Non-music content filtered: "${title}" (contains: ${keyword})`);
                    return false;
                }
            }
            
            // Müzik anahtar kelimesi var mı kontrol et
            let hasMusicKeyword = false;
            for (const keyword of musicKeywords) {
                if (titleLower.includes(keyword) || descriptionLower.includes(keyword) || channelLower.includes(keyword)) {
                    hasMusicKeyword = true;
                    break;
                }
            }
            
            // Müzik kanalı kontrolü
            const musicChannelKeywords = ['music', 'records', 'entertainment', 'official', 'vevo', 'müzik'];
            const isMusicChannel = musicChannelKeywords.some(keyword => channelLower.includes(keyword));
            
            // Müzik videosu olma kriterleri
            const isMusicContent = hasMusicKeyword || isMusicChannel;
            
            if (!isMusicContent) {
                console.log(`🚫 Not music content: "${title}" by ${channelTitle}`);
                return false;
            }
            
            console.log(`✅ Music content approved: "${title}" by ${channelTitle}`);
            return true;
        }
        function startYouTubeProgressTracking(duration = 180) {
            // YouTube player'dan gerçek progress tracking
            if (progressInterval) clearInterval(progressInterval);
            
            // Progress bar elementlerini al
            const progress = document.getElementById('progress');
            const currentTime = document.getElementById('current-time');
            const durationTime = document.getElementById('duration-time');
            
            if (!progress || !currentTime || !durationTime) {
                console.log('⚠️ Progress elements not found');
                return;
            }
            
            let totalDuration = duration; // Başlangıç süresi
            
            // Süreyi hemen göster
            durationTime.textContent = formatTime(totalDuration);
            
            progressInterval = setInterval(() => {
                if (youtubePlayer && youtubePlayerReady && isPlaying) {
                    try {
                        // YouTube player'dan gerçek süre ve pozisyon al
                        const currentSeconds = youtubePlayer.getCurrentTime();
                        const realDuration = youtubePlayer.getDuration();
                        
                        // Gerçek süre varsa güncelle (sadece geçerli değerler için)
                        if (realDuration && realDuration > 0 && isFinite(realDuration) && realDuration !== totalDuration) {
                            totalDuration = realDuration;
                            durationTime.textContent = formatTime(Math.floor(totalDuration));
                            console.log(`⏱️ Duration updated to: ${formatTime(totalDuration)}`);
                        }
                        
                        // Progress bar'ı güncelle
                        if (currentSeconds >= 0 && isFinite(currentSeconds) && totalDuration > 0) {
                            const progressPercent = (currentSeconds / totalDuration) * 100;
                            progress.style.width = Math.min(progressPercent, 100) + '%';
                            currentTime.textContent = formatTime(Math.floor(currentSeconds));
                            
                            // Şarkı bitme kontrolü - YouTube player state change'den önce kontrol et
                            if (currentSeconds >= totalDuration - 1) {
                                console.log('⏰ Song about to end, preparing for transition...');
                                // Progress interval'i temizle ki takılma olmasın
                                clearInterval(progressInterval);
                                progressInterval = null;
                            }
                        }
                        
                    } catch (error) {
                        // Player hatası durumunda simülasyon kullan
                        console.log('⚠️ Progress tracking fallback to simulation');
                        startSimulatedProgress(totalDuration);
                    }
                } else if (isPlaying) {
                    // Player hazır değilse simülasyon kullan
                    startSimulatedProgress(totalDuration);
                }
            }, 1000);
        }
        
        // Simülasyon progress tracking (fallback)
        function startSimulatedProgress(duration) {
            if (progressInterval) clearInterval(progressInterval);
            
            // Progress bar elementlerini al
            const progress = document.getElementById('progress');
            const currentTime = document.getElementById('current-time');
            const durationTime = document.getElementById('duration-time');
            
            if (!progress || !currentTime || !durationTime) {
                console.log('⚠️ Progress elements not found for simulation');
                return;
            }
            
            let simulatedTime = 0;
            const totalDuration = duration;
            
            durationTime.textContent = formatTime(totalDuration);
            progressInterval = setInterval(() => {
                if (isPlaying && simulatedTime < totalDuration) {
                    simulatedTime += 1;
                    const progressPercent = (simulatedTime / totalDuration) * 100;
                    progress.style.width = progressPercent + '%';
                    currentTime.textContent = formatTime(simulatedTime);
                    
                    if (simulatedTime >= totalDuration) {
                        isPlaying = false;
                        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        clearInterval(progressInterval);
                        progressInterval = null;
                        
                        // Simulated progress'te de otomatik geçiş yap
                        console.log('🔚 Simulated song ended, transitioning...');
                        if (repeatMode === 'one' || playbackMode === 'repeat-one') {
                            const currentSong = playlist[currentSongIndex];
                            if (currentSong) {
                                playSong(currentSong.videoId, currentSong.title, currentSong.thumbnail, currentSong.artist);
                            }
                        } else if (repeatMode === 'all' || playbackMode === 'repeat-all' || currentSongIndex < playlist.length - 1 || isShuffling || playbackMode === 'shuffle') {
                            playNextSong();
                        } else {
                            showNotification('Çalma listesi tamamlandı', 'info');
                        }
                    }
                } else if (!isPlaying) {
                    // Şarkı durdurulmuşsa interval'i temizle
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
            }, 1000);
        }

        // YouTube müzik çalmaya çalış
        async function tryPlayYouTubeMusic(videoId, title, duration = 180) {
            try {
                // YouTube IFrame API kullanarak gerçek müzik çal
                if (typeof YT !== 'undefined' && YT.Player) {
                    return await playWithYouTubeIFrame(videoId, title, duration);
                }
                
                // YouTube IFrame API yükle ve çal
                return await loadYouTubeIFrameAPIAndPlay(videoId, title, duration);
                
            } catch (error) {
                console.error('❌ YouTube music playback error:', error);
                return false;
            }
        }

        // YouTube IFrame API yükle ve video çal
        async function loadYouTubeIFrameAPIAndPlay(videoId, title, duration = 180) {
            return new Promise((resolve) => {
                console.log(`🔄 Loading YouTube IFrame API for: ${title} (${videoId})`);
                
                // Video ID kontrolü
                if (!videoId || videoId === 'undefined') {
                    console.error('❌ Invalid video ID in loadYouTubeIFrameAPIAndPlay:', videoId);
                    resolve(false);
                    return;
                }
                
                // YouTube IFrame API script'i yükle
                if (!document.getElementById('youtube-iframe-api')) {
                    const script = document.createElement('script');
                    script.id = 'youtube-iframe-api';
                    script.src = 'https://www.youtube.com/iframe_api';
                    document.head.appendChild(script);
                    
                    // Bekleyen video bilgilerini sakla
                    window.pendingVideoId = videoId;
                    window.pendingTitle = title;
                    window.pendingDuration = duration;
                    window.pendingResolve = resolve;
                    
                } else {
                    // API zaten yüklü
                    if (typeof YT !== 'undefined' && YT.Player) {
                        playWithYouTubeIFrame(videoId, title, duration).then(resolve);
                    } else {
                        // API yükleniyor, bekle
                        window.pendingVideoId = videoId;
                        window.pendingTitle = title;
                        window.pendingDuration = duration;
                        window.pendingResolve = resolve;
                    }
                }
            });
        }

        // YouTube IFrame Player ile çal - HIZLI BAŞLATMA
        async function playWithYouTubeIFrame(videoId, title, duration = 180) {
            return new Promise((resolve) => {
                try {
                    console.log(`🚀 Fast YouTube player for: ${title} (${videoId})`);
                    
                    // Video ID kontrolü
                    if (!videoId || videoId === 'undefined') {
                        console.error('❌ Invalid video ID in playWithYouTubeIFrame:', videoId);
                        resolve(false);
                        return;
                    }
                    
                    // Eğer player zaten varsa, sadece videoyu değiştir (HIZLI)
                    if (youtubePlayer && youtubePlayerReady) {
                        console.log('⚡ Using existing player - instant play!');
                        try {
                            // Önce mevcut şarkıyı durdur
                            youtubePlayer.stopVideo();
                            
                            // Ses açık olduğundan emin ol
                            youtubePlayer.unMute();
                            youtubePlayer.setVolume(100);
                            
                            // Yeni videoyu yükle ve çal
                            youtubePlayer.loadVideoById({
                                videoId: videoId,
                                startSeconds: 0
                            });
                            
                            // Player durumunu güncelle
                            player = youtubePlayer;
                            playerReady = true;
                            isPlaying = true;
                            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                            showNotification(`"${title}" çalıyor 🎵`, 'success');
                            
                            // Progress tracking başlat
                            startYouTubeProgressTracking(duration);
                            resolve(true);
                            return;
                        } catch (error) {
                            console.log('⚠️ Existing player failed, creating new one:', error);
                        }
                    }
                    
                    // Yeni player oluştur
                    console.log('🔄 Creating new YouTube player...');
                    
                    // Mevcut player'ı temizle
                    const existingPlayer = document.getElementById('youtube-player');
                    if (existingPlayer) {
                        existingPlayer.remove();
                    }
                    
                    // YouTube player container oluştur (gizli)
                    const playerContainer = document.createElement('div');
                    playerContainer.id = 'youtube-player';
                    playerContainer.style.position = 'fixed';
                    playerContainer.style.top = '-1000px';
                    playerContainer.style.left = '-1000px';
                    playerContainer.style.width = '1px';
                    playerContainer.style.height = '1px';
                    playerContainer.style.opacity = '0';
                    playerContainer.style.pointerEvents = 'none';
                    document.body.appendChild(playerContainer);
                    
                    // YouTube Player oluştur - HIZLI AYARLAR
                    youtubePlayer = new YT.Player('youtube-player', {
                        height: '1',
                        width: '1',
                        videoId: videoId,
                        playerVars: {
                            autoplay: 1,        // Otomatik başlat
                            controls: 0,        // Kontrolleri gizle
                            disablekb: 1,      // Klavye kontrollerini kapat
                            fs: 0,             // Tam ekran butonunu gizle
                            modestbranding: 1,  // YouTube logosunu küçült
                            rel: 0,            // İlgili videoları gösterme
                            showinfo: 0,       // Video bilgilerini gizle
                            iv_load_policy: 3, // Açıklamaları gizle
                            cc_load_policy: 0, // Altyazıları gizle
                            playsinline: 1,    // Mobilde inline çal
                            start: 0,          // Baştan başlat
                            enablejsapi: 1     // JS API'yi etkinleştir
                        },
                        events: {
                            onReady: function(event) {
                                console.log('⚡ YouTube player ready - INSTANT PLAY!');
                                
                                // Player değişkenlerini senkronize et
                                player = youtubePlayer;
                                playerReady = true;
                                youtubePlayerReady = true;
                                
                                // Ses açık olduğundan emin ol
                                event.target.unMute();
                                event.target.setVolume(100);
                                
                                // Hemen çalmaya başla
                                event.target.playVideo();
                                isPlaying = true;
                                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                                showNotification(`"${title}" çalıyor 🎵`, 'success');
                                
                                // Progress tracking başlat
                                startYouTubeProgressTracking(duration);
                                resolve(true);
                            },
                            onStateChange: function(event) {
                                handleYouTubePlayerStateChange(event, title);
                            },
                            onError: function(event) {
                                console.log('❌ YouTube player error:', event.data);
                                showNotification('Bu şarkı çalınamıyor, sonraki şarkıya geçiliyor...', 'warning');
                                setTimeout(() => playNextSong(), 1000); // Daha hızlı geçiş
                                resolve(false);
                            }
                        }
                    });
                    
                } catch (error) {
                    console.error('❌ YouTube IFrame player creation error:', error);
                    resolve(false);
                }
            });
        }

        // YouTube Player kontrollerini ayarla
        function setupYouTubePlayerControls(player, title) {
            console.log('🎛️ Setting up YouTube player controls for:', title);
            
            // Play/Pause buton kontrolü ana togglePlayPause fonksiyonuna bırakıldı
            // (Çakışmayı önlemek için burada ayrı handler koymuyoruz)
            
            // Progress bar güncelleme
            const updateProgress = () => {
                try {
                    if (player && player.getCurrentTime && player.getDuration) {
                        const currentTime = player.getCurrentTime();
                        const duration = player.getDuration();
                        
                        if (duration > 0) {
                            const progressPercent = (currentTime / duration) * 100;
                            const progress = document.getElementById('progress');
                            const currentTimeEl = document.getElementById('current-time');
                            const durationTimeEl = document.getElementById('duration-time');
                            
                            if (progress) progress.style.width = progressPercent + '%';
                            if (currentTimeEl) currentTimeEl.textContent = formatTime(Math.floor(currentTime));
                            if (durationTimeEl) durationTimeEl.textContent = formatTime(Math.floor(duration));
                        }
                    }
                } catch (error) {
                    // Sessizce devam et, player henüz hazır olmayabilir
                }
            };
            
            // Progress bar interval'ını temizle ve yeniden başlat
            if (window.youtubeProgressInterval) {
                clearInterval(window.youtubeProgressInterval);
            }
            window.youtubeProgressInterval = setInterval(updateProgress, 1000);
            
            // Progress bar tıklama kontrolü
            const progressBar = document.getElementById('progress-bar');
            if (progressBar) {
                progressBar.onclick = (e) => {
                    try {
                        const rect = progressBar.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const width = rect.width;
                        const percentage = clickX / width;
                        const duration = player.getDuration();
                        const seekTime = duration * percentage;
                        
                        player.seekTo(seekTime, true);
                        console.log(`⏭️ Seeking to ${formatTime(Math.floor(seekTime))}`);
                    } catch (error) {
                        console.error('❌ Seek error:', error);
                    }
                };
            }
        }

        // YouTube Player state değişikliklerini handle et - DÜZELTILMIŞ VERSİYON
        function handleYouTubePlayerStateChange(event, title) {
            const playPauseBtn = document.getElementById('play-pause-btn');
            
            switch (event.data) {
                case YT.PlayerState.PLAYING:
                    console.log('⚡ YouTube music playing:', title);
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    isPlaying = true;
                    
                    // Ses açık olduğundan emin ol
                    if (youtubePlayer) {
                        try {
                            youtubePlayer.unMute();
                            youtubePlayer.setVolume(100);
                            console.log('🔊 Volume set to 100%');
                        } catch (error) {
                            console.log('⚠️ Could not set volume:', error);
                        }
                    }
                    
                    // Background Music Manager'a playing state bildir
                    if (window.backgroundMusicManager) {
                        window.backgroundMusicManager.setPlayingState(true);
                    }
                    break;
                    
                case YT.PlayerState.PAUSED:
                    console.log('⏸️ YouTube music paused:', title);
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                    isPlaying = false;
                    
                    // Background Music Manager'a paused state bildir
                    if (window.backgroundMusicManager) {
                        window.backgroundMusicManager.setPlayingState(false);
                    }
                    break;
                    
                case YT.PlayerState.ENDED:
                    console.log('🔚 YouTube music ended:', title);
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                    isPlaying = false;
                    
                    // Progress interval'i temizle
                    if (progressInterval) {
                        clearInterval(progressInterval);
                        progressInterval = null;
                    }
                    if (window.youtubeProgressInterval) {
                        clearInterval(window.youtubeProgressInterval);
                        window.youtubeProgressInterval = null;
                    }
                    
                    // Progress bar'ı sıfırla
                    const progress = document.getElementById('progress');
                    const currentTime = document.getElementById('current-time');
                    if (progress) progress.style.width = '0%';
                    if (currentTime) currentTime.textContent = '0:00';
                    
                    // Otomatik sonraki şarkıya geçiş - DÜZELTILDI
                    console.log(`🔄 Song ended, checking modes: playbackMode=${playbackMode}, repeatMode=${repeatMode}, shuffle=${isShuffling}`);
                    
                    // Hemen geçiş yap (timeout olmadan)
                    if (repeatMode === 'one' || playbackMode === 'repeat-one') {
                        // Tek şarkı tekrarı - aynı şarkıyı çal
                        console.log('🔂 Repeating current song');
                        const currentSong = playlist[currentSongIndex];
                        if (currentSong) {
                            playSong(currentSong.videoId, currentSong.title, currentSong.thumbnail, currentSong.artist);
                        }
                    } else if (repeatMode === 'all' || playbackMode === 'repeat-all' || currentSongIndex < playlist.length - 1 || isShuffling || playbackMode === 'shuffle') {
                        // Tümünü tekrarla, normal ilerleme veya karışık mod
                        console.log('⏭️ Playing next song');
                        playNextSong();
                    } else {
                        // Hiç tekrar yok ve liste sonu
                        console.log('🏁 Playlist ended');
                        showNotification('Çalma listesi tamamlandı', 'info');
                    }
                    break;
                    
                case YT.PlayerState.BUFFERING:
                    console.log('⏳ YouTube music buffering:', title);
                    // Buffering sırasında bildirim gösterme - gereksiz
                    break;
                    
                default:
                    console.log('🔄 YouTube player state:', event.data);
            }
        }
        
        // YouTube Popular Scraping
        async function scrapeYouTubePopular() {
            console.log('🕷️ YouTube popular scraping...');
            
            // Popüler müzik arama terimleri
            const popularQueries = [
                'popular music 2024',
                'trending songs',
                'top hits 2024',
                'viral music',
                'chart music'
            ];
            
            const randomQuery = popularQueries[Math.floor(Math.random() * popularQueries.length)];
            return await scrapeYouTubeSearchNew(randomQuery, 50);
        }

        // 🚀 H-SOUND ÖZEL API SERVERİ - SINIRSIZ MÜZİK SİSTEMİ
        // Production ve development API URL'leri
        const H_SOUND_API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3001' 
            : 'https://h-sound-production.up.railway.app'; // Railway production URL
        async function scrapeYouTubeSearch(query, maxResults = 12) {
            console.log(`� Sıonırsız YouTube arama başlatılıyor: "${query}"`);
            showNotification('Sınırsız müzik araması başlatılıyor...', 'info');
            
            // YÖNTEM 1: Invidious API (En güvenilir)
            console.log('🔄 Yöntem 1: Invidious API deneniyor...');
            try {
                const invidiousResults = await searchInvidious(query, maxResults);
                if (invidiousResults.length > 0) {
                    console.log(`✅ Invidious API başarılı: ${invidiousResults.length} sonuç`);
                    showNotification(`${invidiousResults.length} sonuç Invidious API'den bulundu!`, 'success');
                    return invidiousResults;
                }
            } catch (error) {
                console.log('❌ Invidious API başarısız:', error.message);
            }
            
            // YÖNTEM 2: Piped API
            console.log('🔄 Yöntem 2: Piped API deneniyor...');
            try {
                const pipedResults = await searchPiped(query, maxResults);
                if (pipedResults.length > 0) {
                    console.log(`✅ Piped API başarılı: ${pipedResults.length} sonuç`);
                    showNotification(`${pipedResults.length} sonuç Piped API'den bulundu!`, 'success');
                    return pipedResults;
                }
            } catch (error) {
                console.log('❌ Piped API başarısız:', error.message);
            }
            
            // YÖNTEM 3: YouTube Suggest API
            console.log('🔄 Yöntem 3: YouTube Suggest API deneniyor...');
            try {
                const suggestResults = await searchYouTubeSuggest(query, maxResults);
                if (suggestResults.length > 0) {
                    console.log(`✅ YouTube Suggest başarılı: ${suggestResults.length} sonuç`);
                    showNotification(`${suggestResults.length} sonuç YouTube Suggest'den bulundu!`, 'success');
                    return suggestResults;
                }
            } catch (error) {
                console.log('❌ YouTube Suggest başarısız:', error.message);
            }
            
            // YÖNTEM 4: Çoklu CORS Proxy Scraping
            console.log('🔄 Yöntem 4: CORS Proxy Scraping deneniyor...');
            try {
                const scrapingResults = await corsProxyScraping(query, maxResults);
                if (scrapingResults.length > 0) {
                    console.log(`✅ CORS Scraping başarılı: ${scrapingResults.length} sonuç`);
                    showNotification(`${scrapingResults.length} sonuç scraping'den bulundu!`, 'success');
                    return scrapingResults;
                }
            } catch (error) {
                console.log('❌ CORS Scraping başarısız:', error.message);
            }
            
            // YÖNTEM 5: Gelişmiş Yerel Veritabanı
            console.log('🔄 Yöntem 5: Gelişmiş yerel veritabanı kullanılıyor...');
            const fallbackResults = getAdvancedFallbackMusic(query, maxResults);
            showNotification(`${fallbackResults.length} sonuç yerel veritabanından bulundu!`, 'info');
            return fallbackResults;
        }
        
        // 🚀 NEW H-SOUND API CLIENT - SINIRSIZ MÜZİK SİSTEMİ
        async function scrapeYouTubeSearchNew(query, maxResults = 12) {
            console.log(`🎵 H-Sound API ile arama başlatılıyor: "${query}"`);
            showNotification('H-Sound API ile müzik aranıyor...', 'info');
            
            try {
                // H-Sound Custom API'ye istek gönder
                const response = await fetch(`${H_SOUND_API_URL}/api/search?q=${encodeURIComponent(query)}&limit=${maxResults}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.results && data.results.length > 0) {
                    console.log(`✅ H-Sound API başarılı: ${data.results.length} sonuç (Yöntem: ${data.method})`);
                    showNotification(`${data.results.length} sonuç bulundu! (${data.method})`, 'success');
                    return data.results;
                }
                
                throw new Error('No results from API');
                
            } catch (error) {
                console.error('❌ H-Sound API hatası:', error);
                showNotification('API bağlantı hatası! Yerel veritabanı kullanılıyor...', 'warning');
                
                // Fallback: Yerel veritabanı
                const fallbackResults = getAdvancedFallbackMusic(query, maxResults);
                return fallbackResults;
            }
        }
        
        // Invidious API - Tamamen sınırsız
        async function searchInvidious(query, maxResults) {
            const invidiousInstances = [
                'https://invidious.io',
                'https://invidious.snopyta.org', 
                'https://invidious.kavin.rocks',
                'https://vid.puffyan.us',
                'https://invidious.namazso.eu',
                'https://invidious.tube'
            ];
            
            for (const instance of invidiousInstances) {
                try {
                    const response = await fetch(`${instance}/api/v1/search?q=${encodeURIComponent(query)}&type=video&sort_by=relevance`, {
                        timeout: 8000
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data && data.length > 0) {
                            return data.slice(0, maxResults).map(video => ({
                                videoId: video.videoId,
                                title: cleanTitle(video.title),
                                artist: video.author || 'Bilinmeyen Sanatçı',
                                thumbnail: `https://i.ytimg.com/vi/${video.videoId}/mqdefault.jpg`,
                                channelTitle: video.author || 'Bilinmeyen Kanal',
                                publishedAt: video.published || Date.now(),
                                description: video.description || '',
                                duration: video.lengthSeconds || 180,
                                viewCount: video.viewCount || 0
                            }));
                        }
                    }
                } catch (error) {
                    console.log(`Invidious ${instance} başarısız:`, error.message);
                    continue;
                }
            }
            
            return [];
        }
        
        // Piped API - Tamamen sınırsız
        async function searchPiped(query, maxResults) {
            const pipedInstances = [
                'https://pipedapi.kavin.rocks',
                'https://api-piped.mha.fi',
                'https://pipedapi.adminforge.de',
                'https://api.piped.projectsegfau.lt'
            ];
            
            for (const instance of pipedInstances) {
                try {
                    const response = await fetch(`${instance}/search?q=${encodeURIComponent(query)}&filter=videos`, {
                        timeout: 8000
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.items && data.items.length > 0) {
                            return data.items.slice(0, maxResults).map(video => ({
                                videoId: video.url.replace('/watch?v=', ''),
                                title: cleanTitle(video.title),
                                artist: video.uploaderName || 'Bilinmeyen Sanatçı',
                                thumbnail: video.thumbnail || `https://i.ytimg.com/vi/${video.url.replace('/watch?v=', '')}/mqdefault.jpg`,
                                channelTitle: video.uploaderName || 'Bilinmeyen Kanal',
                                publishedAt: Date.now(),
                                description: '',
                                duration: video.duration || 180,
                                viewCount: video.views || 0
                            }));
                        }
                    }
                } catch (error) {
                    console.log(`Piped ${instance} başarısız:`, error.message);
                    continue;
                }
            }
            
            return [];
        }
        
        // YouTube Suggest API - Sınırsız
        async function searchYouTubeSuggest(query, maxResults) {
            try {
                const response = await fetch(`https://suggestqueries.google.com/complete/search?client=youtube&ds=yt&q=${encodeURIComponent(query)}`, {
                    timeout: 5000
                });
                
                if (response.ok) {
                    const text = await response.text();
                    const jsonMatch = text.match(/\[.*\]/);
                    
                    if (jsonMatch) {
                        const data = JSON.parse(jsonMatch[0]);
                        const suggestions = data[1] || [];
                        
                        return suggestions.slice(0, maxResults).map((suggestion, index) => {
                            const fakeVideoId = generateFakeVideoId(suggestion[0]);
                            return {
                                videoId: fakeVideoId,
                                title: cleanTitle(suggestion[0]),
                                artist: extractArtist(suggestion[0], 'Bilinmeyen Sanatçı'),
                                thumbnail: `https://i.ytimg.com/vi/${fakeVideoId}/mqdefault.jpg`,
                                channelTitle: extractArtist(suggestion[0], 'Bilinmeyen Kanal'),
                                publishedAt: Date.now(),
                                description: `Önerilen: ${suggestion[0]}`,
                                duration: 180 + Math.floor(Math.random() * 120),
                                viewCount: Math.floor(Math.random() * 10000000)
                            };
                        });
                    }
                }
            } catch (error) {
                console.error('YouTube Suggest hatası:', error);
            }
            
            return [];
        }
        
        // CORS Proxy Scraping - Çoklu proxy
        async function corsProxyScraping(query, maxResults) {
            const corsProxies = [
                'https://api.allorigins.win/raw?url=',
                'https://cors-anywhere.herokuapp.com/',
                'https://thingproxy.freeboard.io/fetch/',
                'https://api.codetabs.com/v1/proxy?quest='
            ];
            
            for (let i = 0; i < corsProxies.length; i++) {
                try {
                    const proxy = corsProxies[i];
                    const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(query + ' music')}`;
                    
                    const response = await fetch(proxy + encodeURIComponent(searchUrl), {
                        timeout: 10000
                    });
                    
                    if (response.ok) {
                        const html = await response.text();
                        const results = extractVideoDataFromHTML(html, maxResults);
                        
                        if (results.length > 0) {
                            return results;
                        }
                    }
                } catch (error) {
                    console.log(`CORS Proxy ${i + 1} başarısız:`, error.message);
                    continue;
                }
            }
            
            return [];
        }
        
        // Gelişmiş fallback müzik veritabanı
        function getAdvancedFallbackMusic(query, maxResults) {
            const advancedSongs = [
                // Türk Pop/Rock
                { title: 'Tarkan - Şımarık', artist: 'Tarkan', videoId: 'qDptS1WbBFY' },
                { title: 'Sezen Aksu - Şarkı Söylemek Lazım', artist: 'Sezen Aksu', videoId: 'BNm6b5vGJwY' },
                { title: 'Barış Manço - Dağlar Dağlar', artist: 'Barış Manço', videoId: 'YqBLxzn6kcU' },
                { title: 'Cem Karaca - Tamirci Çırağı', artist: 'Cem Karaca', videoId: 'HgGAzBDE454' },
                
                // Türk Rap
                { title: 'Ceza - Suspus', artist: 'Ceza', videoId: 'BNm6b5vGJwY' },
                { title: 'Sagopa Kajmer - Bir Pesimistin Gözyaşları', artist: 'Sagopa Kajmer', videoId: 'qDptS1WbBFY' },
                { title: 'Ezhel - Geceler', artist: 'Ezhel', videoId: 'YqBLxzn6kcU' },
                { title: 'Şanışer - Susamam', artist: 'Şanışer', videoId: 'HgGAzBDE454' },
                { title: 'Norm Ender - Mekanın Sahibi', artist: 'Norm Ender', videoId: 'qDptS1WbBFY' },
                
                // Dünya Pop
                { title: 'Ed Sheeran - Shape of You', artist: 'Ed Sheeran', videoId: 'JGwWNGJdvx8' },
                { title: 'The Weeknd - Blinding Lights', artist: 'The Weeknd', videoId: '4NRXx6U8ABQ' },
                { title: 'Dua Lipa - Levitating', artist: 'Dua Lipa', videoId: 'TUVcZfQe-Kw' },
                { title: 'Billie Eilish - Bad Guy', artist: 'Billie Eilish', videoId: 'DyDfgMOUjCI' },
                { title: 'Ariana Grande - 7 rings', artist: 'Ariana Grande', videoId: 'QYh6mYIJG2Y' },
                
                // Klasikler
                { title: 'Queen - Bohemian Rhapsody', artist: 'Queen', videoId: 'fJ9rUzIMcZQ' },
                { title: 'The Beatles - Hey Jude', artist: 'The Beatles', videoId: 'A_MjCqQoLLA' },
                { title: 'Michael Jackson - Billie Jean', artist: 'Michael Jackson', videoId: 'Zi_XLOBDo_Y' }
            ];
            
            // Query'ye göre filtrele
            let filtered = advancedSongs.filter(song => 
                song.title.toLowerCase().includes(query.toLowerCase()) ||
                song.artist.toLowerCase().includes(query.toLowerCase())
            );
            
            // Eşleşme yoksa tümünü döndür
            if (filtered.length === 0) {
                filtered = advancedSongs;
            }
            
            return filtered.slice(0, maxResults).map(song => ({
                videoId: song.videoId,
                title: song.title,
                artist: song.artist,
                thumbnail: `https://i.ytimg.com/vi/${song.videoId}/mqdefault.jpg`,
                channelTitle: song.artist,
                publishedAt: Date.now(),
                description: `Yerel: ${song.title}`,
                duration: 180 + Math.floor(Math.random() * 120),
                viewCount: Math.floor(Math.random() * 10000000)
            }));
        }
        
        // Yardımcı fonksiyonlar
        function generateFakeVideoId(title) {
            return btoa(title).replace(/[^a-zA-Z0-9]/g, '').substring(0, 11);
        }
        
        function extractArtist(title, fallback = 'Bilinmeyen Sanatçı') {
            const separators = [' - ', ' | ', ' by ', ' ft. ', ' feat. '];
            for (const sep of separators) {
                if (title.includes(sep)) {
                    return title.split(sep)[0].trim();
                }
            }
            return fallback;
        }
        
        function cleanTitle(title) {
            return title.replace(/[^\w\s\-\(\)\[\]]/g, '').trim();
        }

        // YOUTUBE API ARAMA - ÇOKLU KEY SİSTEMİ! 🚀
        async function searchYouTubeMusic(query, maxResults = 12) {
            console.log(`   YouTube API ile aranıyor: "${query}" (Çoklu Key Sistemi)`);
            showNotification(`"${query}" aranıyor...`, 'info');
            
            try {
                // YouTube API ile ara
                const results = await searchYouTube(query, maxResults);
                
                if (results && results.length > 0) {
                    console.log(`✅ YouTube API başarılı: ${results.length} şarkı bulundu`);
                    showNotification(`${results.length} şarkı bulundu!`, 'success');
                    return results;
                } else {
                    // API başarısız olursa yerel veritabanını kullan
                    console.log('🔄 YouTube API boş sonuç, yerel veritabanı kullanılıyor...');
                    const localResults = searchLocalMusic(query, maxResults);
                    
                    if (localResults && localResults.length > 0) {
                        showNotification(`Yerel veritabanından ${localResults.length} şarkı bulundu`, 'info');
                        return localResults.map(item => ({
                            videoId: item.id?.videoId || item.videoId,
                            title: item.snippet?.title || item.title,
                            artist: item.snippet?.channelTitle || item.artist,
                            thumbnail: item.snippet?.thumbnails?.medium?.url || item.thumbnail,
                            duration: item.duration || 180
                        }));
                    } else {
                        showNotification('Arama sonucu bulunamadı', 'error');
                        return [];
                    }
                }
            } catch (error) {
                console.error('❌ YouTube API arama hatası:', error);
                
                // Hata durumunda yerel veritabanını kullan
                console.log('🔄 API hatası, yerel veritabanı kullanılıyor...');
                const localResults = searchLocalMusic(query, maxResults);
                
                if (localResults && localResults.length > 0) {
                    showNotification(`Yerel veritabanından ${localResults.length} şarkı bulundu`, 'info');
                    return localResults.map(item => ({
                        videoId: item.id?.videoId || item.videoId,
                        title: item.snippet?.title || item.title,
                        artist: item.snippet?.channelTitle || item.artist,
                        thumbnail: item.snippet?.thumbnails?.medium?.url || item.thumbnail,
                        duration: item.duration || 180
                    }));
                } else {
                    showNotification('Arama başarısız oldu', 'error');
                    return [];
                }
            }
        }

        // YouTube API ile popüler müzikleri getir - ÇOKLU KEY SİSTEMİ
        async function getYouTubePopularMusic(maxResults = 12) {
            console.log('  YoruTube API ile popüler müzikler getiriliyor... (Çoklu Key Sistemi)');
            
            try {
                // Rastgele popüler arama terimi seç
                const randomTerm = POPULAR_SEARCH_TERMS[Math.floor(Math.random() * POPULAR_SEARCH_TERMS.length)];
                console.log(`🎵 Popüler müzik terimi: "${randomTerm}"`);
                
                // YouTube API ile ara
                const results = await searchYouTube(randomTerm, maxResults);
                
                if (results && results.length > 0) {
                    console.log(`✅ YouTube API başarılı: ${results.length} popüler şarkı yüklendi`);
                    return results;
                } else {
                    // API başarısız olursa yerel veritabanını kullan
                    console.log('🔄 YouTube API boş sonuç, yerel popüler müzikler kullanılıyor...');
                    return getLocalPopularMusic();
                }
            } catch (error) {
                console.error('❌ YouTube API popüler müzik hatası:', error);
                
                // Hata durumunda yerel veritabanını kullan
                console.log('🔄 API hatası, yerel popüler müzikler kullanılıyor...');
                return getLocalPopularMusic();
            }
        }

        // YouTube API ile şarkı detaylarını getir - Yerel Mock Data
        async function getYouTubeVideoDetails(videoId) {
            console.log(`🎵 Yerel mock data ile video detayları getiriliyor: ${videoId}`);
            
            // Mock data döndür - API çağrısı yok
            return {
                duration: 'PT' + (180 + Math.floor(Math.random() * 120)) + 'S', // 3-5 dakika
                viewCount: Math.floor(Math.random() * 10000000), // Rastgele görüntülenme
                likeCount: Math.floor(Math.random() * 100000), // Rastgele beğeni
                tags: ['music', 'song', 'audio', 'official']
            };
        }

        // Yerel popüler müzikleri getir (fallback)
        function getLocalPopularMusic() {
            console.log('🎵 Loading local popular music as fallback...');
            
            // Yerel veritabanından popüler şarkıları al
            const popularSongs = localMusicDatabase['popular music'] || [];
            
            return popularSongs.map(song => ({
                videoId: song.id,
                title: song.title,
                artist: song.artist,
                thumbnail: `https://img.youtube.com/vi/${song.id}/mqdefault.jpg`,
                channelTitle: song.artist,
                publishedAt: new Date().toISOString(),
                description: `${song.title} - ${song.artist}`
            }));
        }

        // Başlık temizleme fonksiyonu
        function cleanTitle(title) {
            // YouTube başlıklarından gereksiz kelimeleri temizle
            return title
                .replace(/\(Official.*?\)/gi, '')
                .replace(/\[Official.*?\]/gi, '')
                .replace(/Official Music Video/gi, '')
                .replace(/Official Video/gi, '')
                .replace(/Official Audio/gi, '')
                .replace(/Lyrics/gi, '')
                .replace(/HD/gi, '')
                .replace(/4K/gi, '')
                .replace(/\s+/g, ' ')
                .trim();
        }

        // Sanatçı adını çıkarma fonksiyonu
        function extractArtist(title, channelTitle) {
            // Başlıktan sanatçı adını çıkarmaya çalış
            const patterns = [
                /^([^-]+)\s*-\s*(.+)/, // "Artist - Song" format
                /^([^–]+)\s*–\s*(.+)/, // "Artist – Song" format (em dash)
                /(.+?)\s*by\s*(.+)/i,  // "Song by Artist" format
            ];

            for (const pattern of patterns) {
                const match = title.match(pattern);
                if (match) {
                    return match[1].trim();
                }
            }

            // Eğer pattern bulunamazsa channel title'ı kullan
            return channelTitle || 'Bilinmeyen Sanatçı';
        }



        function playFallbackAudio(title) {
            // Fallback müzik kaynakları
            const fallbackSources = [
                'https://archive.org/download/testmp3testfile/mpthreetest.mp3',
                'https://www.w3schools.com/html/horse.mp3',
                'https://mdn.github.io/webaudio-examples/audio-analyser/viper.mp3',
                'https://archive.org/download/SampleAudio0011/SampleAudio_0011.mp3'
            ];
            
            const audio = document.createElement('audio');
            audio.id = 'html5-audio-player';
            audio.controls = false;
            audio.autoplay = true;
            audio.preload = 'auto';
            
            const selectedSource = fallbackSources[Math.floor(Math.random() * fallbackSources.length)];
            audio.src = selectedSource;
            
            console.log(`🎵 Playing fallback audio: ${selectedSource}`);
            showNotification(`"${title}" fallback müzik çalıyor`, 'info');
            
            audio.addEventListener('play', () => {
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            });
            
            audio.addEventListener('pause', () => {
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            });
            
            audio.addEventListener('ended', () => {
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                if (currentSongIndex < playlist.length - 1) {
                    setTimeout(() => playNextSong(), 1000);
                }
            });
            
            audio.addEventListener('timeupdate', () => {
                if (audio.duration > 0) {
                    const progressPercent = (audio.currentTime / audio.duration) * 100;
                    progress.style.width = progressPercent + '%';
                    currentTime.textContent = formatTime(Math.floor(audio.currentTime));
                    durationTime.textContent = formatTime(Math.floor(audio.duration));
                }
            });
            
            audio.addEventListener('error', () => {
                console.log('❌ Fallback audio failed, using simulation');
                simulatePlayback(title);
            });
            
            audio.style.display = 'none';
            document.body.appendChild(audio);
            playerReady = true;
            
            audio.play().catch(() => {
                simulatePlayback(title);
            });
        }



        function simulatePlayback(title) {
            console.log('🎵 Simulating playback for:', title);
            
            // Son çare olarak basit bir ses tonu oluştur
            try {
                createSimpleAudioTone(title);
            } catch (error) {
                console.log('❌ Audio tone creation failed, using visual simulation');
                createVisualSimulation(title);
            }
        }

        function createSimpleAudioTone(title) {
            // Web Audio API ile basit bir ton oluştur
            if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                const AudioContextClass = AudioContext || webkitAudioContext;
                const audioContext = new AudioContextClass();
                
                // Basit bir sinüs dalgası oluştur
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A note
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime); // Düşük ses seviyesi
                
                oscillator.start();
                
                // Görsel olarak çalıyor gibi göster
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                playerReady = true;
                
                showNotification(`"${title}" çalıyor (ses tonu)`, 'success');
                
                // 3 saniye sonra durdur
                setTimeout(() => {
                    oscillator.stop();
                    createVisualSimulation(title);
                }, 3000);
                
            } else {
                createVisualSimulation(title);
            }
        }

        function createVisualSimulation(title) {
            console.log('🎵 Creating visual simulation for:', title);
            
            // Görsel olarak çalıyor gibi göster
            isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            playerReady = true;
            
            showNotification(`"${title}" çalıyor (H-Sound simülasyonu)`, 'success');
            
            // Gerçekçi progress bar animasyonu
            if (progressInterval) clearInterval(progressInterval);
            
            let simulatedTime = 0;
            const totalDuration = 180; // 3 dakika simülasyon
            
            // Süreyi göster
            durationTime.textContent = formatTime(totalDuration);
            
            progressInterval = setInterval(() => {
                if (isPlaying && simulatedTime < totalDuration) {
                    simulatedTime += 1;
                    const progressPercent = (simulatedTime / totalDuration) * 100;
                    progress.style.width = progressPercent + '%';
                    currentTime.textContent = formatTime(simulatedTime);
                    
                    // Şarkı bittiğinde
                    if (simulatedTime >= totalDuration) {
                        isPlaying = false;
                        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        showNotification('Şarkı bitti', 'info');
                        
                        // Sonraki şarkıya geç
                        if (currentSongIndex < playlist.length - 1) {
                            setTimeout(() => {
                                playNextSong();
                            }, 1000);
                        }
                        clearInterval(progressInterval);
                    }
                } else if (!isPlaying) {
                    // Durakladığında interval'ı durdur ama süreyi koru
                    // clearInterval(progressInterval);
                }
            }, 1000);
        }

        // Basit toggle play/pause - YouTube player ile entegre
        function togglePlayPause() {
            console.log('🎵 Toggle play/pause clicked');
            console.log('Player exists:', !!player);
            console.log('YouTube Player exists:', !!youtubePlayer);
            console.log('Player ready:', playerReady);
            console.log('YouTube Player ready:', youtubePlayerReady);
            console.log('Is playing:', isPlaying);
            
            // YouTube player'ı öncelikle kontrol et (yeni sistem)
            if (youtubePlayer && youtubePlayerReady) {
                try {
                    // YouTube player'ın gerçek durumunu kontrol et
                    const playerState = youtubePlayer.getPlayerState();
                    console.log('YouTube player state:', playerState);
                    
                    // Eğer çalıyorsa (state 1) durdur
                    if (playerState === 1 || isPlaying) {
                        youtubePlayer.pauseVideo();
                        isPlaying = false;
                        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        
                        // Background Music Manager'a bildir
                        if (window.backgroundMusicManager) {
                            window.backgroundMusicManager.setPlayingState(false);
                        }
                        
                        showNotification('Müzik duraklatıldı', 'info');
                        console.log('⏸️ YouTube music paused');
                        return;
                    }
                    
                    // Eğer duraklatılmışsa (state 2) veya çalmıyorsa devam ettir
                    if (playerState === 2 || !isPlaying) {
                        youtubePlayer.playVideo();
                        isPlaying = true;
                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                        
                        // Background Music Manager'a bildir
                        if (window.backgroundMusicManager) {
                            window.backgroundMusicManager.setPlayingState(true);
                        }
                        
                        showNotification('Müzik devam ediyor', 'info');
                        console.log('▶️ YouTube music resumed');
                        return;
                    }
                    
                } catch (error) {
                    console.error('❌ YouTube player toggle error:', error);
                }
            }
            
            // Eski player sistemini kontrol et (fallback)
            if (player && playerReady) {
                try {
                    // Eski player'ın gerçek durumunu kontrol et
                    const playerState = player.getPlayerState();
                    console.log('Old player state:', playerState);
                    
                    // Eğer çalıyorsa (state 1) durdur
                    if (playerState === 1 || isPlaying) {
                        player.pauseVideo();
                        isPlaying = false;
                        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        
                        // Background Music Manager'a bildir
                        if (window.backgroundMusicManager) {
                            window.backgroundMusicManager.setPlayingState(false);
                        }
                        
                        showNotification('Müzik duraklatıldı', 'info');
                        console.log('⏸️ Old music paused');
                        return;
                    }
                    
                    // Eğer duraklatılmışsa (state 2) veya çalmıyorsa devam ettir
                    if (playerState === 2 || !isPlaying) {
                        player.playVideo();
                        isPlaying = true;
                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                        
                        // Background Music Manager'a bildir
                        if (window.backgroundMusicManager) {
                            window.backgroundMusicManager.setPlayingState(true);
                        }
                        
                        showNotification('Müzik devam ediyor', 'info');
                        console.log('▶️ Old music resumed');
                        return;
                    }
                    
                } catch (error) {
                    console.error('❌ Old player toggle error:', error);
                }
            }
            
            // Hiç şarkı seçilmemişse
            showNotification('Önce bir şarkı seçin', 'warning');
            console.log('⚠️ No song selected - no player available');
        }

        function playNextSong() {
            if (playlist.length === 0) {
                showNotification('Çalma listesi boş', 'warning');
                return;
            }
            
            console.log(`🎵 Playing next song - Current modes: playbackMode=${playbackMode}, repeatMode=${repeatMode}, shuffle=${isShuffling}`);
            
            // Repeat mode kontrolü
            if (repeatMode === 'one' || playbackMode === 'repeat-one') {
                // Tek şarkı tekrarı - aynı şarkıyı çal
                const currentSong = playlist[currentSongIndex];
                if (currentSong) {
                    console.log('🔂 Repeating current song:', currentSong.title);
                    playSong(currentSong.videoId, currentSong.title, currentSong.thumbnail, currentSong.artist);
                }
                return;
            }
            
            // Shuffle mode kontrolü
            if (isShuffling || playbackMode === 'shuffle') {
                // Karışık çalma - rastgele şarkı seç
                const availableSongs = playlist.filter((_, index) => index !== currentSongIndex);
                if (availableSongs.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableSongs.length);
                    const randomSong = availableSongs[randomIndex];
                    
                    currentSongIndex = playlist.findIndex(song => song.videoId === randomSong.videoId);
                    console.log(`🔀 Playing random song: ${randomSong.title} (${currentSongIndex + 1}/${playlist.length})`);
                    playSong(randomSong.videoId, randomSong.title, randomSong.thumbnail, randomSong.artist);
                    return;
                }
            }
            
            // Normal sıralı çalma
            if (currentSongIndex < playlist.length - 1) {
                currentSongIndex++;
                const nextSong = playlist[currentSongIndex];
                console.log(`⏭️ Playing next song: ${nextSong.title} (${currentSongIndex + 1}/${playlist.length})`);
                playSong(nextSong.videoId, nextSong.title, nextSong.thumbnail, nextSong.artist);
            } else {
                // Liste sonuna gelindi
                if (repeatMode === 'all' || playbackMode === 'repeat-all') {
                    // Tümünü tekrarla modunda başa dön
                    currentSongIndex = 0;
                    const firstSong = playlist[0];
                    console.log('🔁 Playlist restarting - repeat all mode');
                    playSong(firstSong.videoId, firstSong.title, firstSong.thumbnail, firstSong.artist);
                } else {
                    showNotification('Çalma listesinin sonuna geldiniz', 'info');
                    console.log('🔚 End of playlist reached');
                }
            }
        }

        function playPreviousSong() {
            if (playlist.length === 0) {
                showNotification('Çalma listesi boş', 'warning');
                return;
            }
            
            console.log(`🎵 Playing previous song - Current modes: playbackMode=${playbackMode}, repeatMode=${repeatMode}, shuffle=${isShuffling}`);
            
            // Repeat mode kontrolü
            if (repeatMode === 'one' || playbackMode === 'repeat-one') {
                // Tek şarkı tekrarı - aynı şarkıyı çal
                const currentSong = playlist[currentSongIndex];
                if (currentSong) {
                    console.log('🔂 Repeating current song:', currentSong.title);
                    playSong(currentSong.videoId, currentSong.title, currentSong.thumbnail, currentSong.artist);
                }
                return;
            }
            
            // Shuffle mode kontrolü
            if (isShuffling || playbackMode === 'shuffle') {
                // Karışık çalma - rastgele şarkı seç
                const availableSongs = playlist.filter((_, index) => index !== currentSongIndex);
                if (availableSongs.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableSongs.length);
                    const randomSong = availableSongs[randomIndex];
                    
                    currentSongIndex = playlist.findIndex(song => song.videoId === randomSong.videoId);
                    console.log(`🔀 Playing random previous song: ${randomSong.title} (${currentSongIndex + 1}/${playlist.length})`);
                    playSong(randomSong.videoId, randomSong.title, randomSong.thumbnail, randomSong.artist);
                    return;
                }
            }
            
            // Normal sıralı çalma
            if (currentSongIndex > 0) {
                currentSongIndex--;
                const prevSong = playlist[currentSongIndex];
                console.log(`⏮️ Playing previous song: ${prevSong.title} (${currentSongIndex + 1}/${playlist.length})`);
                playSong(prevSong.videoId, prevSong.title, prevSong.thumbnail, prevSong.artist);
            } else {
                // Liste başında
                if (repeatMode === 'all' || playbackMode === 'repeat-all') {
                    // Tümünü tekrarla modunda sona git
                    currentSongIndex = playlist.length - 1;
                    const lastSong = playlist[currentSongIndex];
                    console.log('🔁 Going to end of playlist - repeat all mode');
                    playSong(lastSong.videoId, lastSong.title, lastSong.thumbnail, lastSong.artist);
                } else {
                    showNotification('Çalma listesinin başındasınız', 'info');
                    console.log('🔚 Beginning of playlist reached');
                }
            }
        }

        // Playback mode toggle function - Tek butonla 4 mod arası geçiş
        function togglePlaybackMode() {
            // Modes: sequential -> shuffle -> repeat-one -> repeat-all -> sequential
            switch (playbackMode) {
                case 'sequential':
                    playbackMode = 'shuffle';
                    repeatMode = 'none';
                    isShuffling = true;
                    playbackModeBtn.className = 'control-btn shuffle';
                    playbackModeBtn.title = 'Karışık Çalma';
                    playbackModeBtn.innerHTML = '<i class="fas fa-random"></i>';
                    
                    // Orijinal playlist'i sakla ve karıştır
                    if (originalPlaylist.length === 0) {
                        originalPlaylist = [...playlist];
                    }
                    shufflePlaylist();
                    
                    showNotification('🔀 Karışık çalma', 'success');
                    console.log('🔀 Shuffle mode enabled');
                    break;
                    
                case 'shuffle':
                    playbackMode = 'repeat-one';
                    repeatMode = 'one';
                    isShuffling = false;
                    playbackModeBtn.className = 'control-btn repeat-one';
                    playbackModeBtn.title = 'Tek Şarkı Tekrarla';
                    playbackModeBtn.innerHTML = '<i class="fas fa-redo"></i><span style="font-size: 10px; position: absolute; top: 2px; right: 2px;">1</span>';
                    
                    // Orijinal playlist'e geri dön
                    restoreOriginalPlaylist();
                    
                    showNotification('🔂 Tek şarkı tekrarı', 'success');
                    console.log('🔂 Repeat one enabled');
                    break;
                    
                case 'repeat-one':
                    playbackMode = 'repeat-all';
                    repeatMode = 'all';
                    isShuffling = false;
                    playbackModeBtn.className = 'control-btn repeat-all';
                    playbackModeBtn.title = 'Tümünü Tekrarla';
                    playbackModeBtn.innerHTML = '<i class="fas fa-redo"></i>';
                    
                    showNotification('🔁 Tümünü tekrarla', 'success');
                    console.log('🔁 Repeat all enabled');
                    break;
                    
                case 'repeat-all':
                    playbackMode = 'sequential';
                    repeatMode = 'none';
                    isShuffling = false;
                    playbackModeBtn.className = 'control-btn sequential';
                    playbackModeBtn.title = 'Sırayla Çal';
                    playbackModeBtn.innerHTML = '<i class="fas fa-list-ol"></i>';
                    
                    showNotification('📋 Sırayla çalma', 'info');
                    console.log('📋 Sequential mode enabled');
                    break;
            }
            
            updatePlaylistDisplay();
        }

        // Playlist'i karıştır
        function shufflePlaylist() {
            if (playlist.length <= 1) return;
            
            const currentSong = playlist[currentSongIndex];
            const otherSongs = playlist.filter((_, index) => index !== currentSongIndex);
            const shuffledOthers = otherSongs.sort(() => Math.random() - 0.5);
            
            playlist = [currentSong, ...shuffledOthers];
            currentSongIndex = 0;
        }

        // Orijinal playlist'e geri dön
        function restoreOriginalPlaylist() {
            if (originalPlaylist.length > 0) {
                const currentSong = playlist[currentSongIndex];
                playlist = [...originalPlaylist];
                
                // Mevcut şarkının orijinal pozisyonunu bul
                currentSongIndex = playlist.findIndex(song => song.videoId === currentSong.videoId);
                if (currentSongIndex === -1) currentSongIndex = 0;
            }
        }

        // Update playlist display (placeholder function)
        function updatePlaylistDisplay() {
            // Bu fonksiyon playlist görünümünü güncellemek için kullanılabilir
            // Şu anda sadece console log ile bilgi veriyor
            console.log(`📋 Playlist updated: ${playlist.length} songs, current: ${currentSongIndex + 1}, mode: ${playbackMode}`);
        }

        function formatTime(seconds) {
            // Geçersiz değerleri kontrol et
            if (!seconds || seconds < 0 || !isFinite(seconds)) {
                return '0:00';
            }
            
            const totalSeconds = Math.floor(seconds);
            const minutes = Math.floor(totalSeconds / 60);
            const remainingSeconds = totalSeconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }



        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 H-Sound starting...');
            
            // Setup thumbnail error handling immediately
            setupGlobalThumbnailErrorHandling();
            
            // Hakan hesabını oluştur
            initializeHakanAccount();
            
            // Event listener'ları kur
            setupSimpleLoginListeners();
            
            // ÖNCELİKLE: Giriş durumunu kontrol et ve UI'ı güncelle
            const isLoggedIn = localStorage.getItem('h_sound_logged_in') === 'true';
            const lastLoggedUser = localStorage.getItem('h_sound_username');
            const loginScreen = document.getElementById('login-screen');
            const mainApp = document.getElementById('main-app');
            
            console.log('🔍 Giriş durumu kontrolü:', { isLoggedIn, lastLoggedUser });
            
            if (isLoggedIn && lastLoggedUser) {
                // Kullanıcı daha önce giriş yapmış - direkt uygulamayı göster
                console.log('✅ Kullanıcı giriş yapmış, uygulama gösteriliyor:', lastLoggedUser);
                
                if (loginScreen) loginScreen.classList.add('hidden');
                if (mainApp) mainApp.classList.remove('hidden');
                
                // Uygulamayı başlat
                setTimeout(() => {
                    initializeApp();
                    initializeUserRole();
                    showNotification(`🎉 Tekrar hoş geldin ${lastLoggedUser}! 🎵`, 'success');
                }, 300);
            } else {
                // Giriş yapılmamış - giriş ekranını göster
                console.log('🔐 Giriş yapılmamış, giriş ekranı gösteriliyor');
                
                if (loginScreen) loginScreen.classList.remove('hidden');
                if (mainApp) mainApp.classList.add('hidden');
                
                // Kayıtlı bilgileri forma doldur
                fillSavedCredentials();
            }
            
            // Eğer giriş yapılmışsa event listener'ları ekle
            if (isLoggedIn) {
                // DOM elementlerini kontrol et
                console.log('📋 DOM Elements:', {
                    homeLink: !!homeLink,
                    searchLink: !!searchLink,
                    playlistsLink: !!playlistsLink,
                    friendsLink: !!friendsLink,
                    settingsLink: !!settingsLink,
                    superadminLink: !!superadminLink
                });
                
                // Event listeners
                if (homeLink) {
                    homeLink.addEventListener('click', (e) => {
                        console.log('🏠 Home clicked');
                        e.preventDefault();
                        sidebar.classList.remove('open');
                        overlay.classList.add('hidden');
                        showHomePage();
                    });
                }

                if (searchLink) {
                    searchLink.addEventListener('click', (e) => {
                        console.log('🔍 Search clicked');
                        e.preventDefault();
                        sidebar.classList.remove('open');
                        overlay.classList.add('hidden');
                        showSearchPage();
                    });
                }

                if (playlistsLink) {
                    playlistsLink.addEventListener('click', (e) => {
                        console.log('🎵 Playlists clicked');
                        e.preventDefault();
                        sidebar.classList.remove('open');
                        overlay.classList.add('hidden');
                        showPlaylistsPage();
                    });
                }

                if (friendsLink) {
                    friendsLink.addEventListener('click', (e) => {
                        console.log('👥 Friends clicked');
                        e.preventDefault();
                        sidebar.classList.remove('open');
                        overlay.classList.add('hidden');
                        showFriendsPage();
                    });
                }

                if (settingsLink) {
                    settingsLink.addEventListener('click', (e) => {
                        console.log('⚙️ Settings clicked');
                        e.preventDefault();
                        sidebar.classList.remove('open');
                        overlay.classList.add('hidden');
                        showSettingsPage();
                    });
                }

                if (superadminLink) {
                    superadminLink.addEventListener('click', (e) => {
                        console.log('👑 Super Admin Panel clicked');
                        e.preventDefault();
                        sidebar.classList.remove('open');
                        overlay.classList.add('hidden');
                        openSuperAdminPanel();
                    });
                }

                if (menuToggleBtn) {
                    menuToggleBtn.addEventListener('click', () => {
                        console.log('📱 Menu toggle clicked');
                        sidebar.classList.toggle('open');
                        overlay.classList.toggle('hidden');
                    });
                }

                if (overlay) {
                    overlay.addEventListener('click', () => {
                        if (sidebar.classList.contains('open')) {
                            sidebar.classList.remove('open');
                            overlay.classList.add('hidden');
                        }
                    });
                }

                if (searchBtn) {
                    searchBtn.addEventListener('click', () => {
                        const query = searchBar.value.trim();
                        if (query) {
                            searchMusic(query);
                        }
                    });
                }

                if (searchBar) {
                    searchBar.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const query = searchBar.value.trim();
                            if (query) {
                                searchMusic(query);
                            }
                        }
                    });
                }

                if (playPauseBtn) {
                    playPauseBtn.addEventListener('click', togglePlayPause);
                }

                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        console.log('⏮️ Previous song');
                        playPreviousSong();
                    });
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        console.log('⏭️ Next song');
                        playNextSong();
                    });
                }

                // Playback mode button
                if (playbackModeBtn) {
                    playbackModeBtn.addEventListener('click', () => {
                        togglePlaybackMode();
                    });
                }

                // Progress bar click
                if (progressBar) {
                    progressBar.addEventListener('click', (e) => {
                        const rect = progressBar.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const progressPercent = (clickX / rect.width) * 100;
                        progress.style.width = progressPercent + '%';
                    });
                }

                // Initialize app
                console.log('✅ Event listeners added, starting app...');
                initializeApp();
            } else {
                console.log('🔐 User not logged in, showing login screen...');
            }
        });

        // SOSYAL ÖZELLİKLER FONKSİYONLARI
        
        // Global değişkenler
        let friends = [];
        let friendRequests = []; // Gelen arkadaşlık istekleri
        let sentRequests = []; // Gönderilen arkadaşlık istekleri
        let currentChatFriend = null;
        let privacyAccepted = localStorage.getItem('h_sound_privacy_accepted') === 'true';

        // Yerel verileri yükle
        function loadLocalData() {
            const currentUser = localStorage.getItem('h_sound_username');
            friends = JSON.parse(localStorage.getItem(`h_sound_friends_${currentUser}`) || '[]');
            friendRequests = JSON.parse(localStorage.getItem(`h_sound_friend_requests_${currentUser}`) || '[]');
            sentRequests = JSON.parse(localStorage.getItem(`h_sound_sent_requests_${currentUser}`) || '[]');
        }

        // Sosyal özellik fonksiyonları
        function showFriendsFeature() {
            const featureContent = document.getElementById('feature-content');
            featureContent.innerHTML = `
                <div class="friends-container">
                    <div class="content-header">
                        <h2><i class="fas fa-users"></i> Arkadaşlar</h2>
                        <button onclick="openModal('add-friend-modal')" class="btn">
                            <i class="fas fa-user-plus"></i> Arkadaş Ekle
                        </button>
                    </div>
                    
                    <div id="friends-section">
                        <h3>Arkadaşlarım (${friends.length})</h3>
                        <div id="friends-list"></div>
                    </div>
                </div>
            `;
            
            displayFriends();
        }

        function showMusicSharingFeature() {
            const featureContent = document.getElementById('feature-content');
            featureContent.innerHTML = `
                <div class="downloads-container">
                    <div class="content-header">
                        <h2><i class="fas fa-share-alt"></i> Müzik Paylaşma</h2>
                        <p>Arkadaşlarınızla müzik paylaşın ve keşfedin</p>
                    </div>
                    
                    <div class="no-content-message">
                        <i class="fas fa-share-alt" style="font-size: 48px; color: var(--primary-color); margin-bottom: 20px;"></i>
                        <h3>Müzik Paylaşma</h3>
                        <p>Bir şarkı çalarken arkadaşlarınızla paylaşabilirsiniz!</p>
                    </div>
                </div>
            `;
        }

        // Arkadaşlık isteklerini göster
        function displayFriendRequests() {
            const requestsList = document.getElementById('friend-requests-list');
            if (!requestsList) return;
            
            if (friendRequests.length === 0) {
                requestsList.innerHTML = '<p class="no-content-message">Henüz arkadaşlık isteğiniz yok.</p>';
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            let requestsHtml = '';
            friendRequests.forEach((requesterName, index) => {
                const requesterData = savedUsers[requesterName];
                const requesterRole = requesterData ? requesterData.role : 'Bilinmiyor';
                
                // Rol rengini belirle
                let roleColor = '#95A5A6';
                switch(requesterRole) {
                    case 'VIP': roleColor = '#9B59B6'; break;
                    case 'Premium': roleColor = '#3498DB'; break;
                    case 'User': roleColor = '#27AE60'; break;
                }
                
                requestsHtml += `
                    <div class="friend-item" style="border-left: 4px solid #F39C12;">
                        <div class="friend-info">
                            <div class="friend-avatar" style="background: linear-gradient(135deg, ${roleColor}, ${roleColor}CC);">
                                ${requesterName.charAt(0).toUpperCase()}
                            </div>
                            <div class="friend-status">
                                <div class="friend-name">${requesterName}</div>
                                <div class="friend-activity">
                                    <span style="color: ${roleColor}; font-weight: 600;">${requesterRole}</span> • Arkadaşlık isteği gönderdi
                                </div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-btn chat-btn" onclick="acceptFriendRequest('${requesterName}', ${index})">
                                <i class="fas fa-check"></i> Kabul Et
                            </button>
                            <button class="friend-btn remove-btn" onclick="rejectFriendRequest('${requesterName}', ${index})">
                                <i class="fas fa-times"></i> Reddet
                            </button>
                        </div>
                    </div>
                `;
            });
            
            requestsList.innerHTML = requestsHtml;
        }

        // Arkadaşlık isteğini kabul et
        function acceptFriendRequest(requesterName, index) {
            const currentUser = localStorage.getItem('h_sound_username');
            
            // Arkadaş listesine ekle (her iki taraf için)
            friends.push(requesterName);
            localStorage.setItem(`h_sound_friends_${currentUser}`, JSON.stringify(friends));
            
            const requesterFriends = JSON.parse(localStorage.getItem(`h_sound_friends_${requesterName}`) || '[]');
            requesterFriends.push(currentUser);
            localStorage.setItem(`h_sound_friends_${requesterName}`, JSON.stringify(requesterFriends));
            
            // İsteği kaldır
            friendRequests.splice(index, 1);
            localStorage.setItem(`h_sound_friend_requests_${currentUser}`, JSON.stringify(friendRequests));
            
            // Gönderenin sent requests listesinden kaldır
            const requesterSentRequests = JSON.parse(localStorage.getItem(`h_sound_sent_requests_${requesterName}`) || '[]');
            const reqIndex = requesterSentRequests.indexOf(currentUser);
            if (reqIndex > -1) {
                requesterSentRequests.splice(reqIndex, 1);
                localStorage.setItem(`h_sound_sent_requests_${requesterName}`, JSON.stringify(requesterSentRequests));
            }
            
            showNotification(`${requesterName} arkadaş olarak eklendi!`, 'success');
            showFriendsPage(); // Sayfayı yenile
        }

        // Arkadaşlık isteğini reddet
        function rejectFriendRequest(requesterName, index) {
            const currentUser = localStorage.getItem('h_sound_username');
            
            // İsteği kaldır
            friendRequests.splice(index, 1);
            localStorage.setItem(`h_sound_friend_requests_${currentUser}`, JSON.stringify(friendRequests));
            
            // Gönderenin sent requests listesinden kaldır
            const requesterSentRequests = JSON.parse(localStorage.getItem(`h_sound_sent_requests_${requesterName}`) || '[]');
            const reqIndex = requesterSentRequests.indexOf(currentUser);
            if (reqIndex > -1) {
                requesterSentRequests.splice(reqIndex, 1);
                localStorage.setItem(`h_sound_sent_requests_${requesterName}`, JSON.stringify(requesterSentRequests));
            }
            
            showNotification(`${requesterName} arkadaşlık isteği reddedildi`, 'info');
            showFriendsPage(); // Sayfayı yenile
        }

        function displayFriends() {
            const friendsList = document.getElementById('friends-list');
            if (!friendsList) return;
            
            if (friends.length === 0) {
                friendsList.innerHTML = '<p class="no-content-message">Henüz arkadaşınız yok. Arkadaş ekleyerek başlayın!</p>';
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            let friendsHtml = '';
            friends.forEach((friendName, index) => {
                const friendData = savedUsers[friendName];
                const friendRole = friendData ? friendData.role : 'Bilinmiyor';
                const isOnline = Math.random() > 0.5; // Rastgele online durumu (demo için)
                const onlineStatus = isOnline ? '🟢 Online' : '🔴 Offline';
                
                // Rol rengini belirle
                let roleColor = '#95A5A6';
                switch(friendRole) {
                    case 'VIP': roleColor = '#9B59B6'; break;
                    case 'Premium': roleColor = '#3498DB'; break;
                    case 'User': roleColor = '#27AE60'; break;
                }
                
                friendsHtml += `
                    <div class="friend-item">
                        <div class="friend-info">
                            <div class="friend-avatar" style="background: linear-gradient(135deg, ${roleColor}, ${roleColor}CC);">
                                ${friendName.charAt(0).toUpperCase()}
                            </div>
                            <div class="friend-status">
                                <div class="friend-name">${friendName}</div>
                                <div class="friend-activity">
                                    <span style="color: ${roleColor}; font-weight: 600;">${friendRole}</span> • ${onlineStatus}
                                </div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-btn chat-btn" onclick="openChat('${friendName}')">
                                <i class="fas fa-comment"></i> Sohbet
                            </button>
                            <button class="friend-btn remove-btn" onclick="removeFriend(${index})">
                                <i class="fas fa-trash"></i> Kaldır
                            </button>
                        </div>
                    </div>
                `;
            });
            
            friendsList.innerHTML = friendsHtml;
        }

        // Sohbet için arkadaşları göster (Gerçek hesap bilgileri ile)
        function displayFriendsForChat() {
            const friendsList = document.getElementById('friends-list-chat');
            if (!friendsList) return;
            
            if (friends.length === 0) {
                friendsList.innerHTML = '<p class="no-content-message">Henüz arkadaşınız yok. Arkadaş ekleyerek sohbet etmeye başlayın!</p>';
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            let friendsHtml = '';
            friends.forEach((friendName) => {
                const friendData = savedUsers[friendName];
                const friendRole = friendData ? friendData.role : 'Bilinmiyor';
                const isOnline = Math.random() > 0.5; // Rastgele online durumu (demo için)
                const onlineStatus = isOnline ? '🟢 Online' : '🔴 Offline';
                
                // Rol rengini belirle
                let roleColor = '#95A5A6';
                switch(friendRole) {
                    case 'VIP': roleColor = '#9B59B6'; break;
                    case 'Premium': roleColor = '#3498DB'; break;
                    case 'User': roleColor = '#27AE60'; break;
                }
                
                friendsHtml += `
                    <div class="friend-item">
                        <div class="friend-info">
                            <div class="friend-avatar" style="background: linear-gradient(135deg, ${roleColor}, ${roleColor}CC);">
                                ${friendName.charAt(0).toUpperCase()}
                            </div>
                            <div class="friend-status">
                                <div class="friend-name">${friendName}</div>
                                <div class="friend-activity">
                                    <span style="color: ${roleColor}; font-weight: 600;">${friendRole}</span> • ${onlineStatus}
                                </div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-btn chat-btn" onclick="openChat('${friendName}')">
                                <i class="fas fa-comment"></i> Sohbet Et
                            </button>
                        </div>
                    </div>
                `;
            });
            
            friendsList.innerHTML = friendsHtml;
        }

        // Arkadaş kaldır
        function removeFriend(index) {
            const friendName = friends[index];
            const currentUser = localStorage.getItem('h_sound_username');
            
            if (!confirm(`${friendName} adlı arkadaşı kaldırmak istediğinizden emin misiniz?`)) return;
            
            // Kendi listesinden kaldır
            friends.splice(index, 1);
            localStorage.setItem(`h_sound_friends_${currentUser}`, JSON.stringify(friends));
            
            // Karşı tarafın listesinden de kaldır
            const friendFriends = JSON.parse(localStorage.getItem(`h_sound_friends_${friendName}`) || '[]');
            const friendIndex = friendFriends.indexOf(currentUser);
            if (friendIndex > -1) {
                friendFriends.splice(friendIndex, 1);
                localStorage.setItem(`h_sound_friends_${friendName}`, JSON.stringify(friendFriends));
            }
            
            displayFriends();
            showNotification(`${friendName} arkadaş listesinden kaldırıldı`, 'info');
        }

        // Sohbet aç
        function openChat(friendName) {
            if (!privacyAccepted) {
                openModal('privacy-modal');
                return;
            }
            
            // Arkadaşlık kontrolü - sadece arkadaşlarla mesajlaşma
            const currentUser = localStorage.getItem('h_sound_username');
            const userFriends = JSON.parse(localStorage.getItem(`h_sound_friends_${currentUser}`) || '[]');
            
            if (!userFriends.includes(friendName)) {
                showNotification(`${friendName} ile mesajlaşmak için önce arkadaş olmanız gerekiyor!`, 'warning');
                return;
            }
            
            currentChatFriend = friendName;
            document.getElementById('chat-friend-name').textContent = friendName;
            openModal('chat-modal');
            
            loadMessages(friendName);
        }

        // Mesajları yükle (Gerçek hesaplar arası)
        function loadMessages(friendName) {
            const currentUser = localStorage.getItem('h_sound_username');
            const chatKey = `h_sound_chat_${currentUser}_${friendName}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            messages.forEach((message, index) => {
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message-container';
                
                const messageEl = document.createElement('div');
                messageEl.className = `message ${message.sender === currentUser ? 'sent' : 'received'}`;
                
                // Favori mesaj işaretleme
                if (message.favorited) {
                    messageEl.classList.add('favorited');
                }
                
                if (message.type === 'music') {
                    messageEl.classList.add('music');
                    messageEl.innerHTML = `
                        <i class="fas fa-music"></i>
                        <div>
                            <div>${message.musicTitle}</div>
                            <div style="font-size: 12px; opacity: 0.8;">Müzik paylaşıldı</div>
                        </div>
                    `;
                    messageEl.onclick = () => {
                        if (message.musicVideoId) {
                            playSong(message.musicVideoId, message.musicTitle, message.musicThumbnail || 'https://placehold.co/50x50/3498DB/ffffff?text=M');
                            closeModal('chat-modal');
                        }
                    };
                } else {
                    messageEl.textContent = message.text;
                }
                
                const timeEl = document.createElement('div');
                timeEl.className = 'message-time';
                timeEl.textContent = new Date(message.timestamp).toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
                messageEl.appendChild(timeEl);
                
                // Mesaj aksiyonları (silme ve favorileme butonları)
                const actionsEl = document.createElement('div');
                actionsEl.className = 'message-actions';
                
                // Favori butonu
                const favoriteBtn = document.createElement('button');
                favoriteBtn.className = `message-favorite-btn ${message.favorited ? 'favorited' : ''}`;
                favoriteBtn.innerHTML = '<i class="fas fa-star"></i>';
                favoriteBtn.title = message.favorited ? 'Favorilerden çıkar' : 'Favorilere ekle';
                favoriteBtn.onclick = () => toggleMessageFavorite(friendName, index);
                
                // Silme butonu
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'message-delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.title = 'Mesajı sil';
                deleteBtn.onclick = () => deleteMessage(friendName, index);
                
                actionsEl.appendChild(favoriteBtn);
                actionsEl.appendChild(deleteBtn);
                
                // Mesaj container'ına ekle
                if (message.sender === currentUser) {
                    messageContainer.appendChild(actionsEl);
                    messageContainer.appendChild(messageEl);
                } else {
                    messageContainer.appendChild(messageEl);
                    messageContainer.appendChild(actionsEl);
                }
                
                chatMessages.appendChild(messageContainer);
            });
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Bu fonksiyon artık kullanılmıyor - gerçek hesaplar arası mesajlaşma için aşağıdaki fonksiyon kullanılıyor
        /*
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            
            if (!text || !currentChatFriend) return;
            
            const chatKey = `h_sound_chat_${currentChatFriend}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const newMessage = {
                text: text,
                sender: 'me',
                type: 'text',
                timestamp: new Date().toISOString()
            };
            
            messages.push(newMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));
            
            input.value = '';
            loadMessages(currentChatFriend);
        }
        */

        // Müzik paylaşma modalını göster
        function showMusicShareModal() {
            if (!currentChatFriend) return;
            
            openModal('music-share-modal');
            
            const musicList = document.getElementById('music-share-list');
            musicList.innerHTML = '';
            
            if (playlist.length === 0) {
                musicList.innerHTML = '<p class="no-content-message">Paylaşılacak müzik bulunamadı. Önce müzik arayın.</p>';
                return;
            }
            
            playlist.slice(0, 10).forEach(song => {
                const item = document.createElement('div');
                item.className = 'friend-item';
                item.style.cursor = 'pointer';
                item.innerHTML = `
                    <div class="friend-info">
                        <img src="${song.thumbnail}" style="width: 50px; height: 50px; border-radius: 8px; margin-right: 15px;">
                        <div class="friend-status">
                            <div class="friend-name">${song.title}</div>
                            <div class="friend-activity">Müzik</div>
                        </div>
                    </div>
                    <div class="friend-actions">
                        <button class="friend-btn chat-btn" onclick="shareMusic('${song.videoId}', '${song.title.replace(/'/g, "\\'")}', '${song.thumbnail}')">
                            <i class="fas fa-share"></i> Paylaş
                        </button>
                    </div>
                `;
                musicList.appendChild(item);
            });
        }

        // Müzik paylaş
        function shareMusic(videoId, title, thumbnail) {
            if (!currentChatFriend) return;
            
            const chatKey = `h_sound_chat_${currentChatFriend}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const musicMessage = {
                text: `🎵 ${title}`,
                sender: 'me',
                type: 'music',
                musicVideoId: videoId,
                musicTitle: title,
                musicThumbnail: thumbnail,
                timestamp: new Date().toISOString()
            };
            
            messages.push(musicMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));
            
            closeModal('music-share-modal');
            loadMessages(currentChatFriend);
        }

        // Gizlilik politikasını kabul et
        function acceptPrivacy() {
            privacyAccepted = true;
            localStorage.setItem('h_sound_privacy_accepted', 'true');
            closeModal('privacy-modal');
            
            showNotification('Gizlilik politikası kabul edildi! Artık mesajlaşabilirsiniz.', 'success');
            
            // Mesajlaşma özelliğini göster
            setTimeout(() => {
                showMessagingFeature();
            }, 1000);
        }

        // Gizlilik politikasını reddet
        function declinePrivacy() {
            closeModal('privacy-modal');
            showNotification('Mesajlaşma özelliğini kullanmak için gizlilik politikasını kabul etmeniz gerekiyor.', 'warning');
        }

        // İndirilen şarkıları göster (Downloads sayfası için güncelleme) - KALDIRILDI
        function showDownloadsPage() {
            currentView = 'downloads';
            setActiveLink(downloadsLink);
            searchContainer.classList.add('hidden');
            clearContentArea();
            
            contentArea.innerHTML = `
                <div class="downloads-container">
                    <div class="content-header">
                        <h2><i class="fas fa-download"></i> İndirilen Müzikler</h2>
                        <span style="font-size: 14px; color: var(--secondary-text-color);">
                            (${downloadedSongs.length} şarkı)
                        </span>
                    </div>
                    <div id="downloads-list"></div>
                </div>
            `;
            
            displayDownloads();
        }

        // İndirilen şarkıları listele
        function displayDownloads() {
            const downloadsList = document.getElementById('downloads-list');
            if (!downloadsList) return;
            
            if (downloadedSongs.length === 0) {
                downloadsList.innerHTML = '<p class="no-content-message">Henüz indirilen müzik yok. Müzik arayıp indirme butonuna tıklayın.</p>';
                return;
            }
            
            let downloadsHtml = '';
            downloadedSongs.forEach((song, index) => {
                downloadsHtml += `
                    <div class="download-item">
                        <div class="download-info">
                            <img src="${song.thumbnail}" style="width: 50px; height: 50px; border-radius: 4px; margin-right: 15px;">
                            <div>
                                <div style="font-weight: 600;">${song.title}</div>
                                <div style="font-size: 12px; color: var(--secondary-text-color);">
                                    ${song.artist} • İndirilme: ${new Date(song.downloadedAt).toLocaleDateString('tr-TR')}
                                </div>
                            </div>
                        </div>
                        <div class="download-actions">
                            <button class="download-btn" onclick="playDownloadedSong(${index})" title="Çal">
                                <i class="fas fa-play"></i> Çal
                            </button>
                            <button class="download-btn delete-download-btn" onclick="deleteDownload(${index})" title="Sil">
                                <i class="fas fa-trash"></i> Sil
                            </button>
                        </div>
                    </div>
                `;
            });
            
            downloadsList.innerHTML = downloadsHtml;
        }

        // İndirilen şarkıyı çal
        function playDownloadedSong(index) {
            const song = downloadedSongs[index];
            if (song && song.videoId) {
                playSong(song.videoId, song.title, song.thumbnail, song.artist);
            }
        }

        // İndirilen şarkıyı sil
        function deleteDownload(index) {
            const song = downloadedSongs[index];
            if (confirm('Bu şarkıyı silmek istediğinizden emin misiniz?')) {
                downloadedSongs.splice(index, 1);
                localStorage.setItem('h_sound_downloads', JSON.stringify(downloadedSongs));
                displayDownloads();
                showNotification(`"${song.title}" silindi`, 'info');
            }
        }

        // Modal fonksiyonları
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById('overlay').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById('overlay').classList.add('hidden');
        }



        // Bildirim sistemi
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = 'fas fa-info-circle';
            let bgColor = 'var(--primary-color)';
            
            switch(type) {
                case 'success':
                    icon = 'fas fa-check-circle';
                    bgColor = '#27AE60';
                    break;
                case 'warning':
                    icon = 'fas fa-exclamation-triangle';
                    bgColor = '#F39C12';
                    break;
                case 'error':
                    icon = 'fas fa-times-circle';
                    bgColor = '#E74C3C';
                    break;
            }
            
            notification.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${bgColor}CC 100%)`;
            notification.innerHTML = `
                <i class="${icon}" style="margin-right: 10px;"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            // 3 saniye sonra kaldır
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Arkadaşlık isteği gönder
        function sendFriendRequest() {
            const username = document.getElementById('friend-username').value.trim();
            const currentUser = localStorage.getItem('h_sound_username');
            
            if (!username) {
                showNotification('Lütfen kullanıcı adı girin!', 'warning');
                return;
            }
            
            if (username === currentUser) {
                showNotification('Kendinize arkadaşlık isteği gönderemezsiniz!', 'warning');
                return;
            }
            
            // Gerçek hesap kontrolü
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            console.log('🔍 Registered users:', savedUsers);
            console.log('🔍 Searched user:', username);
            
            if (!savedUsers[username]) {
                showNotification('Kullanıcı bulunamadı', 'error');
                return;
            }
            
            if (friends.includes(username)) {
                showNotification('Bu kullanıcı zaten arkadaşınız!', 'warning');
                return;
            }
            
            if (sentRequests.includes(username)) {
                showNotification('Bu kullanıcıya zaten arkadaşlık isteği gönderdiniz!', 'warning');
                return;
            }
            
            // Arkadaşlık isteği gönder
            sentRequests.push(username);
            localStorage.setItem(`h_sound_sent_requests_${currentUser}`, JSON.stringify(sentRequests));
            
            // Karşı tarafa isteği ekle
            const targetRequests = JSON.parse(localStorage.getItem(`h_sound_friend_requests_${username}`) || '[]');
            targetRequests.push(currentUser);
            localStorage.setItem(`h_sound_friend_requests_${username}`, JSON.stringify(targetRequests));
            
            showNotification(`${username} kullanıcısına arkadaşlık isteği gönderildi!`, 'success');
            document.getElementById('friend-username').value = '';
            closeModal('add-friend-modal');
        }

        // Müzik paylaş (Gerçek hesaplar arası)
        function shareMusic(videoId, title, thumbnail) {
            const currentUser = localStorage.getItem('h_sound_username');
            if (!currentChatFriend || !currentUser) return;
            
            const chatKey = `h_sound_chat_${currentUser}_${currentChatFriend}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const musicMessage = {
                text: `🎵 ${title}`,
                sender: currentUser,
                type: 'music',
                musicVideoId: videoId,
                musicTitle: title,
                musicThumbnail: thumbnail,
                timestamp: new Date().toISOString()
            };
            
            messages.push(musicMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));
            
            // Arkadaşın sohbet geçmişine de ekle
            const friendChatKey = `h_sound_chat_${currentChatFriend}_${currentUser}`;
            const friendMessages = JSON.parse(localStorage.getItem(friendChatKey) || '[]');
            friendMessages.push(musicMessage);
            localStorage.setItem(friendChatKey, JSON.stringify(friendMessages));
            
            closeModal('music-share-modal');
            loadMessages(currentChatFriend);
            showNotification(`Müzik ${currentChatFriend} ile paylaşıldı!`, 'success');
        }

        // Mesajı favorilere ekle/çıkar
        function toggleMessageFavorite(friendName, messageIndex) {
            const currentUser = localStorage.getItem('h_sound_username');
            const chatKey = `h_sound_chat_${currentUser}_${friendName}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            if (messages[messageIndex]) {
                messages[messageIndex].favorited = !messages[messageIndex].favorited;
                localStorage.setItem(chatKey, JSON.stringify(messages));
                loadMessages(friendName);
                
                const action = messages[messageIndex].favorited ? 'favorilere eklendi' : 'favorilerden çıkarıldı';
                showNotification(`Mesaj ${action}`, 'success');
            }
        }

        // Tek mesajı sil
        function deleteMessage(friendName, messageIndex) {
            if (!confirm('Bu mesajı silmek istediğinizden emin misiniz?')) return;
            
            const currentUser = localStorage.getItem('h_sound_username');
            const chatKey = `h_sound_chat_${currentUser}_${friendName}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            if (messages[messageIndex]) {
                messages.splice(messageIndex, 1);
                localStorage.setItem(chatKey, JSON.stringify(messages));
                loadMessages(friendName);
                showNotification('Mesaj silindi', 'success');
            }
        }

        // Tüm sohbeti sil
        function clearAllMessages() {
            if (!currentChatFriend) return;
            
            const result = confirm(`${currentChatFriend} ile olan tüm sohbeti silmek istediğinizden emin misiniz?\n\nBu işlem geri alınamaz!`);
            if (!result) return;
            
            const currentUser = localStorage.getItem('h_sound_username');
            const chatKey = `h_sound_chat_${currentUser}_${currentChatFriend}`;
            
            // Favori mesajları kontrol et
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            const favoritedMessages = messages.filter(msg => msg.favorited);
            
            if (favoritedMessages.length > 0) {
                const keepFavorites = confirm(`${favoritedMessages.length} favori mesajınız var.\n\nFavori mesajları korumak istiyor musunuz?`);
                
                if (keepFavorites) {
                    // Sadece favori mesajları tut
                    localStorage.setItem(chatKey, JSON.stringify(favoritedMessages));
                    showNotification(`Sohbet silindi, ${favoritedMessages.length} favori mesaj korundu`, 'success');
                } else {
                    // Tümünü sil
                    localStorage.removeItem(chatKey);
                    showNotification('Tüm sohbet silindi', 'success');
                }
            } else {
                // Favori mesaj yok, tümünü sil
                localStorage.removeItem(chatKey);
                showNotification('Tüm sohbet silindi', 'success');
            }
            
            loadMessages(currentChatFriend);
        }

        // Sadece favori olmayan mesajları sil
        function clearNonFavoriteMessages() {
            if (!currentChatFriend) return;
            
            const result = confirm('Favori olmayan tüm mesajları silmek istediğinizden emin misiniz?');
            if (!result) return;
            
            const currentUser = localStorage.getItem('h_sound_username');
            const chatKey = `h_sound_chat_${currentUser}_${currentChatFriend}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const favoritedMessages = messages.filter(msg => msg.favorited);
            localStorage.setItem(chatKey, JSON.stringify(favoritedMessages));
            
            loadMessages(currentChatFriend);
            showNotification(`${messages.length - favoritedMessages.length} mesaj silindi, ${favoritedMessages.length} favori mesaj korundu`, 'success');
        }

        // Mesaj gönder (Gerçek hesaplar arası)
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            const currentUser = localStorage.getItem('h_sound_username');
            
            if (!text || !currentChatFriend || !currentUser) return;
            
            const chatKey = `h_sound_chat_${currentUser}_${currentChatFriend}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const newMessage = {
                text: text,
                sender: currentUser,
                type: 'text',
                timestamp: new Date().toISOString()
            };
            
            messages.push(newMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));
            
            // Arkadaşın sohbet geçmişine de ekle (karşılıklı sohbet için)
            const friendChatKey = `h_sound_chat_${currentChatFriend}_${currentUser}`;
            const friendMessages = JSON.parse(localStorage.getItem(friendChatKey) || '[]');
            friendMessages.push(newMessage);
            localStorage.setItem(friendChatKey, JSON.stringify(friendMessages));
            
            input.value = '';
            loadMessages(currentChatFriend);
            
            showNotification(`Mesaj ${currentChatFriend} kullanıcısına gönderildi`, 'success');
        }

        // CSS animasyonu ekle
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOutRight {
                from {
                    opacity: 1;
                    transform: translateX(0);
                }
                to {
                    opacity: 0;
                    transform: translateX(100%);
                }
            }
        `;
        document.head.appendChild(style);

        // AYARLAR FONKSİYONLARI (Sadeleştirilmiş)
        
        // Hesap bilgilerini göster
        function showAccountInfo() {
            const currentUsername = localStorage.getItem('h_sound_username') || 'Kullanıcı';
            let userRole = localStorage.getItem('h_sound_user_role') || 'Kullanıcı';
            
            // Hakan için özel kontrol - eğer rolü doğru set edilmemişse düzelt
            if (currentUsername === 'Hakan' && (userRole !== 'Super Admin' && userRole !== 'Süper Admin')) {
                userRole = 'Super Admin';
                localStorage.setItem('h_sound_user_role', 'Super Admin');
                console.log('🔧 Hakan\'ın rolü Super Admin olarak düzeltildi');
            }
            
            // Süper Admin ve Super Admin arasındaki tutarsızlığı düzelt
            if (userRole === 'Süper Admin') {
                userRole = 'Super Admin';
                localStorage.setItem('h_sound_user_role', 'Super Admin');
            }
            
            // Hesap oluşturulma tarihi (eğer yoksa bugünün tarihini kullan)
            let accountCreationDate = localStorage.getItem(`h_sound_account_created_${currentUsername}`);
            if (!accountCreationDate) {
                accountCreationDate = Date.now();
                localStorage.setItem(`h_sound_account_created_${currentUsername}`, accountCreationDate);
            }
            
            const creationDate = new Date(parseInt(accountCreationDate));
            const creationYear = creationDate.getFullYear();
            const currentYear = new Date().getFullYear();
            const accountAge = currentYear - creationYear;
            
            // Rol açıklamaları
            const roleDescriptions = {
                'Super Admin': 'Tüm yetkilere sahip sistem yöneticisi',
                'Admin': 'Yönetici yetkilerine sahip kullanıcı',
                'VIP': 'Premium özelliklere erişimi olan kullanıcı',
                'Premium': 'Gelişmiş özelliklere erişimi olan kullanıcı',
                'Kullanıcı': 'Standart kullanıcı hesabı',
                'User': 'Standart kullanıcı hesabı'
            };
            
            let roleDescription = roleDescriptions[userRole] || 'Standart kullanıcı hesabı';
            
            // Hakan için özel açıklama
            if (currentUsername === 'Hakan') {
                roleDescription = 'H-Sound\'un kurucusu ve baş geliştiricisi';
            }
            
            // Modal oluştur
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-user-circle"></i> Hesap Hakkında</h3>
                    
                    <div style="background: rgba(52, 152, 219, 0.1); padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid var(--primary-color);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold;">
                                ${currentUsername.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h4 style="margin: 0; color: var(--text-color); font-size: 20px;">${currentUsername}</h4>
                                <p style="margin: 5px 0 0 0; color: var(--secondary-text-color); font-size: 14px;">${roleDescription}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                            <div>
                                <strong style="color: var(--text-color);">Hesap İsmi:</strong>
                                <div style="color: var(--secondary-text-color); font-size: 14px; margin-top: 2px;">${currentUsername}</div>
                            </div>
                            <i class="fas fa-user" style="color: var(--primary-color); font-size: 18px;"></i>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                            <div>
                                <strong style="color: var(--text-color);">Hesap Rolü:</strong>
                                <div style="color: var(--secondary-text-color); font-size: 14px; margin-top: 2px;">${userRole}</div>
                            </div>
                            <i class="fas fa-crown" style="color: var(--primary-color); font-size: 18px;"></i>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                            <div>
                                <strong style="color: var(--text-color);">Hesap Yaşı:</strong>
                                <div style="color: var(--secondary-text-color); font-size: 14px; margin-top: 2px;">
                                    ${accountAge === 0 ? 'Bu yıl oluşturuldu' : `${accountAge} yıl`} (${creationYear})
                                </div>
                            </div>
                            <i class="fas fa-calendar-alt" style="color: var(--primary-color); font-size: 18px;"></i>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                            <div>
                                <strong style="color: var(--text-color);">Oluşturulma Tarihi:</strong>
                                <div style="color: var(--secondary-text-color); font-size: 14px; margin-top: 2px;">${creationDate.toLocaleDateString('tr-TR')}</div>
                            </div>
                            <i class="fas fa-clock" style="color: var(--primary-color); font-size: 18px;"></i>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-check"></i> Tamam
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Rol bilgisi göster
        function showRoleInfo() {
            const userRole = localStorage.getItem('h_sound_user_role') || 'Kullanıcı';
            const username = localStorage.getItem('h_sound_username') || 'Kullanıcı';
            
            let roleDescription = '';
            let roleColor = '';
            switch(userRole) {
                case 'VIP':
                    roleDescription = '💎 VIP - Premium özellikler ve öncelikli destek';
                    roleColor = '#9B59B6';
                    break;
                case 'Premium':
                    roleDescription = '💰 Premium - Gelişmiş özellikler ve reklamsız deneyim';
                    roleColor = '#3498DB';
                    break;
                case 'User':
                    roleDescription = '👤 User - Standart kullanıcı yetkileri';
                    roleColor = '#27AE60';
                    break;
                default:
                    roleDescription = '👤 Kullanıcı - Standart kullanıcı yetkileri';
                    roleColor = '#95A5A6';
            }
            
            alert(`
🎵 H-Sound Hesap Bilgileri

👤 Hesap Adı: ${username}
🏷️ Rol: ${userRole}
📋 Açıklama: ${roleDescription}
📅 Kayıt Tarihi: ${new Date().toLocaleDateString('tr-TR')}
👥 Arkadaş Sayısı: ${friends.length}
📱 İndirilen Müzik: ${downloadedSongs.length}
            `);
        }

        // Hesabı sil (Hakan hesabı koruması ile)
        function deleteAccount() {
            const username = localStorage.getItem('h_sound_username') || 'Kullanıcı';
            
            // Hakan hesabı koruması
            if (username === 'Hakan') {
                showNotification('⚠️ Hakan hesabı silinemez!', 'error');
                alert('🔒 GÜVENLİK KORUMASI\n\nHakan hesabı sistem güvenliği için silinemez.\nBu hesap H-Sound\'un ana yönetici hesabıdır.');
                return;
            }
            
            const userRole = localStorage.getItem('h_sound_user_role') || 'Kullanıcı';
            
            if (confirm(`⚠️ HESAP SİLME UYARISI\n\nHesabınız: ${username}\nRol: ${userRole}\n\nHesabınız kalıcı olarak silinecek!\nTüm verileriniz kaybolacak.\n\nDevam etmek istiyor musunuz?`)) {
                if (confirm('🚨 SON ONAY\n\nGerçekten hesabınızı silmek istiyor musunuz?\nBu işlem GERİ ALINAMAZ!')) {
                    // Kullanıcıyı users listesinden sil
                    const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                    delete savedUsers[username];
                    localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                    
                    // Kullanıcının tüm verilerini sil
                    const allKeys = Object.keys(localStorage);
                    allKeys.forEach(key => {
                        if (key.startsWith('h_sound_') && !key.includes('users')) {
                            localStorage.removeItem(key);
                        }
                    });
                    
                    // Global değişkenleri sıfırla
                    friends = [];
                    downloadedSongs = [];
                    privacyAccepted = false;
                    
                    showNotification('Hesabınız başarıyla silindi!', 'info');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                }
            }
        }

        // Çıkış yap (basit versiyon - kullanılmıyor, alttaki Firebase entegrasyonlu kullanılıyor)
        // Bu fonksiyon artık kullanılmıyor - alttaki logout() fonksiyonu kullanılıyor

        // Uygulama başlatıldığında varsayılan rol ata ve Hakan hesabını oluştur
        function initializeUserRole() {
            console.log('🔧 Initializing user roles...');
            
            // Hakan süper admin hesabını oluştur (eğer yoksa)
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            // Hakan kullanıcısını her zaman oluştur/güncelle
            savedUsers['Hakan'] = {
                password: 'Hakan5225522541',
                role: 'Süper Admin',
                registerDate: new Date().toISOString()
            };
            localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
            console.log('👑 Hakan super admin account created/updated');
            
            // Mevcut kullanıcının rolünü kontrol et
            const currentUsername = localStorage.getItem('h_sound_username');
            const currentUserRole = localStorage.getItem('h_sound_user_role');
            
            // Eğer Hakan giriş yapmışsa rolünü süper admin yap
            if (currentUsername === 'Hakan') {
                localStorage.setItem('h_sound_user_role', 'Süper Admin');
                console.log('👑 Hakan role updated to Süper Admin');
            } else if (!currentUserRole) {
                localStorage.setItem('h_sound_user_role', 'Kullanıcı');
            }
            
            const finalUserRole = localStorage.getItem('h_sound_user_role');
            console.log('  SCurrent user:', currentUsername, 'Final Role:', finalUserRole);
            
            // Süper admin linkini kontrol et
            const superadminElement = document.getElementById('superadmin-link');
            console.log('🔗 Superadmin link element:', superadminElement);
            
            if (superadminElement) {
                // Hakan olarak giriş yapmışsa veya Süper Admin rolü varsa paneli göster
                if (currentUsername === 'Hakan' || finalUserRole === 'Süper Admin' || finalUserRole === 'Super Admin') {
                    superadminElement.classList.remove('hidden');
                    superadminElement.style.display = 'block';
                    console.log('  Suuper admin panel enabled for:', currentUsername);
                } else {
                    superadminElement.classList.add('hidden');
                    superadminElement.style.display = 'none';
                    console.log('🚫 Super admin panel hidden for:', currentUsername);
                }
            } else {
                console.error('❌ Superadmin link element not found!');
            }
        }

        // SÜPER ADMİN FONKSİYONLARI

        // Şifre görünürlüğünü değiştir
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
                button.title = 'Şifreyi gizle';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
                button.title = 'Şifreyi göster';
            }
        }

        // Kullanıcı şifresini göster (Süper Admin hariç)
        function showUserPassword(username, password) {
            // Süper Admin şifresi gösterilmez
            if (username === 'Hakan' || password === 'Hakan5225522541') {
                alert(`🔐 ${username} Hesap Bilgileri\n\n👤 Kullanıcı Adı: ${username}\n🔑 Şifre: [GİZLİ - SÜPER ADMİN]\n\n⚠️ Süper admin şifresi güvenlik nedeniyle gizlidir!`);
                return;
            }
            
            alert(`🔐 ${username} Hesap Bilgileri\n\n👤 Kullanıcı Adı: ${username}\n🔑 Şifre: ${password}\n\n⚠️ Bu bilgiyi güvenli tutun!`);
        }

        // Kullanıcı rolünü değiştir (Admin ve Süper Admin hariç)
        function editUserRole(username) {
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            const currentRole = savedUsers[username].role;
            
            // Admin ve Süper Admin rolleri verilemez - sadece Hakan süper admin
            const roles = ['Kullanıcı', 'User', 'Premium', 'VIP'];
            let roleOptions = '';
            roles.forEach(role => {
                roleOptions += `${role === currentRole ? '✓ ' : ''}${role}\n`;
            });
            
            const newRole = prompt(`${username} kullanıcısının yeni rolünü seçin:\n\n${roleOptions}\nYeni rol:`);
            
            if (newRole && roles.includes(newRole)) {
                savedUsers[username].role = newRole;
                localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                showNotification(`${username} kullanıcısının rolü "${newRole}" olarak değiştirildi!`, 'success');
                showSuperAdminPage(); // Sayfayı yenile
            } else if (newRole) {
                showNotification('Geçersiz rol! Lütfen listeden bir rol seçin.', 'error');
            }
        }

        // Kullanıcıyı sil
        function deleteUser(username) {
            if (username === 'Hakan') {
                showNotification('Hakan hesabı silinemez!', 'error');
                return;
            }
            
            if (confirm(`${username} kullanıcısını silmek istediğinizden emin misiniz?\n\nBu işlem geri alınamaz!`)) {
                const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                delete savedUsers[username];
                localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                
                showNotification(`${username} kullanıcısı silindi!`, 'success');
                showSuperAdminPage(); // Sayfayı yenile
            }
        }

        // YENİ BASİT GİRİŞ SİSTEMİ FONKSİYONLARI

        // Hakan hesabını oluştur
        function initializeHakanAccount() {
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            // Hakan kullanıcısı yoksa veya eksik bilgileri varsa güncelle
            if (!savedUsers['Hakan'] || !savedUsers['Hakan'].email) {
                savedUsers['Hakan'] = {
                    email: 'alparmaklih@gmail.com',
                    password: 'Hakan5225522541',
                    role: 'Süper Admin',
                    registerDate: new Date().toISOString(),
                    isDefault: true,
                    createdBy: 'system'
                };
                localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                console.log('👑 Hakan süper admin hesabı oluşturuldu/güncellendi');
                console.log('📧 Email: alparmaklih@gmail.com');
                console.log('🔑 Şifre: Hakan5225522541');
                console.log('👤 Kullanıcı Adı: Hakan');
            } else {
                console.log('✅ Hakan hesabı zaten mevcut');
            }
        }

        // Giriş durumunu kontrol et
        function checkSimpleLoginStatus() {
            // Firebase Auth durumunu kontrol et
            if (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) {
                const loginScreen = document.getElementById('login-screen');
                const mainApp = document.getElementById('main-app');
                
                loginScreen.classList.add('hidden');
                mainApp.classList.remove('hidden');
                console.log('✅ Firebase kullanıcısı zaten giriş yapmış');
                return;
            }
            
            // TÜM KULLANICILAR İÇİN OTOMATİK GİRİŞ SİSTEMİ
            console.log('🚀 Otomatik giriş sistemi kontrol ediliyor...');
            
            // 1. Önce localStorage'dan son giriş yapan kullanıcıyı kontrol et
            const lastLoggedUser = localStorage.getItem('h_sound_username');
            const isLoggedIn = localStorage.getItem('h_sound_logged_in') === 'true';
            
            if (isLoggedIn && lastLoggedUser) {
                console.log('🔄 Son giriş yapan kullanıcı bulundu:', lastLoggedUser);
                
                const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                
                if (savedUsers[lastLoggedUser]) {
                    // Son kullanıcı ile otomatik giriş
                    const userRole = savedUsers[lastLoggedUser].role || 'Kullanıcı';
                    
                    localStorage.setItem('h_sound_user_role', userRole);
                    localStorage.setItem('h_sound_remember_me', 'true');
                    localStorage.setItem('h_sound_saved_username', lastLoggedUser);
                    localStorage.setItem('h_sound_saved_password', savedUsers[lastLoggedUser].password);
                    
                    const loginScreen = document.getElementById('login-screen');
                    const mainApp = document.getElementById('main-app');
                    
                    loginScreen.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    
                    console.log('✅ Otomatik giriş başarılı:', lastLoggedUser);
                    console.log('👤 Kullanıcı:', lastLoggedUser);
                    console.log('🎭 Rol:', userRole);
                    
                    // Başarı mesajı göster
                    setTimeout(() => {
                        showNotification(`🎉 Tekrar hoş geldin ${lastLoggedUser}! 🎵`, 'success');
                    }, 1000);
                    
                    // Uygulamayı başlat
                    setTimeout(() => {
                        initializeApp();
                        initializeUserRole();
                    }, 500);
                    
                    return;
                }
            }
            
            // 2. Remember Me kontrolü - Kayıtlı kullanıcı var mı?
            const rememberMe = localStorage.getItem('h_sound_remember_me') === 'true';
            const savedUsername = localStorage.getItem('h_sound_saved_username');
            const savedPassword = localStorage.getItem('h_sound_saved_password');
            
            if (rememberMe && savedUsername && savedPassword) {
                console.log('🔄 Remember Me aktif - Otomatik giriş yapılıyor:', savedUsername);
                
                const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                
                if (savedUsers[savedUsername] && savedUsers[savedUsername].password === savedPassword) {
                    // Remember Me ile otomatik giriş
                    const userRole = savedUsers[savedUsername].role || 'Kullanıcı';
                    
                    localStorage.setItem('h_sound_logged_in', 'true');
                    localStorage.setItem('h_sound_username', savedUsername);
                    localStorage.setItem('h_sound_user_role', userRole);
                    
                    const loginScreen = document.getElementById('login-screen');
                    const mainApp = document.getElementById('main-app');
                    
                    loginScreen.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    
                    console.log('✅ Remember Me otomatik giriş başarılı:', savedUsername);
                    console.log('👤 Kullanıcı:', savedUsername);
                    console.log('🎭 Rol:', userRole);
                    
                    // Başarı mesajı göster
                    setTimeout(() => {
                        showNotification(`🎉 Otomatik giriş: Hoş geldin ${savedUsername}! 🎵`, 'success');
                    }, 1000);
                    
                    // Uygulamayı başlat
                    setTimeout(() => {
                        initializeApp();
                        initializeUserRole();
                    }, 500);
                    
                    return;
                } else {
                    // Kayıtlı bilgiler geçersiz, temizle
                    localStorage.removeItem('h_sound_remember_me');
                    localStorage.removeItem('h_sound_saved_username');
                    localStorage.removeItem('h_sound_saved_password');
                    console.log('❌ Kayıtlı bilgiler geçersiz, temizlendi');
                }
            }
            
            // 3. Hakan hesabını otomatik oluştur (fallback)
            console.log('🔧 Hakan hesabı kontrol ediliyor...');
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            if (!savedUsers['Hakan']) {
                savedUsers['Hakan'] = {
                    password: 'Hakan5225522541',
                    role: 'Süper Admin',
                    email: 'alparmaklih@gmail.com'
                };
                localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                console.log('✅ Hakan hesabı otomatik oluşturuldu');
            }
            
            // 4. Hiçbir otomatik giriş yoksa, giriş ekranını göster
            console.log('🔐 Giriş ekranı gösteriliyor - İlk kullanım');
            
            // Giriş ekranında kayıtlı bilgileri doldur
            fillSavedCredentials();
            
            const loginScreen = document.getElementById('login-screen');
            const mainApp = document.getElementById('main-app');
            
            loginScreen.classList.remove('hidden');
            mainApp.classList.add('hidden');
        }

        // Kayıtlı bilgileri giriş formuna doldur
        function fillSavedCredentials() {
            const rememberMe = localStorage.getItem('h_sound_remember_me') === 'true';
            const savedUsername = localStorage.getItem('h_sound_saved_username');
            const savedPassword = localStorage.getItem('h_sound_saved_password');
            
            if (rememberMe && savedUsername && savedPassword) {
                const usernameInput = document.getElementById('simple-login-username');
                const passwordInput = document.getElementById('simple-login-password');
                const rememberCheckbox = document.getElementById('remember-me-checkbox');
                
                if (usernameInput) usernameInput.value = savedUsername;
                if (passwordInput) passwordInput.value = savedPassword;
                if (rememberCheckbox) rememberCheckbox.checked = true;
                
                console.log('📝 Kayıtlı bilgiler forma dolduruldu:', savedUsername);
            }
        }

        // Event listener'ları kur
        function setupSimpleLoginListeners() {
            // Giriş butonu
            const loginBtn = document.getElementById('simple-login-btn');
            if (loginBtn) {
                loginBtn.onclick = function() {
                    simpleLogin();
                };
            }

            // Kayıt butonu
            const registerBtn = document.getElementById('simple-register-btn');
            if (registerBtn) {
                registerBtn.onclick = function() {
                    simpleRegister();
                };
            }

            // Kayıt formunu göster
            const showRegisterBtn = document.getElementById('show-register-btn');
            if (showRegisterBtn) {
                showRegisterBtn.onclick = function() {
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('register-section').classList.remove('hidden');
                };
            }

            // Giriş formunu göster
            const showLoginBtn = document.getElementById('show-login-btn');
            if (showLoginBtn) {
                showLoginBtn.onclick = function() {
                    document.getElementById('register-section').classList.add('hidden');
                    document.getElementById('login-section').classList.remove('hidden');
                };
            }

            // Enter tuşu ile giriş
            const loginUsername = document.getElementById('simple-login-username');
            const loginPassword = document.getElementById('simple-login-password');
            
            if (loginUsername) {
                loginUsername.onkeypress = function(e) {
                    if (e.key === 'Enter') simpleLogin();
                };
            }
            
            if (loginPassword) {
                loginPassword.onkeypress = function(e) {
                    if (e.key === 'Enter') simpleLogin();
                };
            }

            // Enter tuşu ile kayıt
            const registerEmail = document.getElementById('simple-register-email');
            const registerUsername = document.getElementById('simple-register-username');
            const registerPassword = document.getElementById('simple-register-password');
            const registerConfirm = document.getElementById('simple-register-confirm');
            
            if (registerEmail) {
                registerEmail.onkeypress = function(e) {
                    if (e.key === 'Enter') simpleRegister();
                };
            }
            
            if (registerUsername) {
                registerUsername.onkeypress = function(e) {
                    if (e.key === 'Enter') simpleRegister();
                };
            }
            
            if (registerPassword) {
                registerPassword.onkeypress = function(e) {
                    if (e.key === 'Enter') simpleRegister();
                };
            }
            
            if (registerConfirm) {
                registerConfirm.onkeypress = function(e) {
                    if (e.key === 'Enter') simpleRegister();
                };
            }

            console.log('✅ Event listenerlar kuruldu');
        }

        // Firebase entegrasyonlu giriş fonksiyonu
        function simpleLogin() {
            const username = document.getElementById('simple-login-username').value.trim();
            const password = document.getElementById('simple-login-password').value.trim();
            // TÜM KULLANICILAR İÇİN OTOMATİK REMEMBER ME - HER ZAMAN AKTİF
            const rememberMe = true; // Her zaman true
            
            console.log('🔐 Giriş denemesi:', username, 'Remember Me: HER ZAMAN AKTİF');
            
            if (!username || !password) {
                showNotification('❌ Kullanıcı adı ve şifre gerekli!', 'warning');
                return;
            }
            
            // Sadece localStorage sistemi kullan (kullanıcı adı ile giriş)
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            if (savedUsers[username] && savedUsers[username].password === password) {
                // Başarılı giriş
                localStorage.setItem('h_sound_logged_in', 'true');
                localStorage.setItem('h_sound_username', username);
                localStorage.setItem('h_sound_user_role', savedUsers[username].role);
                
                if (username === 'Hakan') {
                    localStorage.setItem('h_sound_user_role', 'Süper Admin');
                }
                
                // Remember Me özelliği - HER ZAMAN AKTİF
                localStorage.setItem('h_sound_remember_me', 'true');
                localStorage.setItem('h_sound_saved_username', username);
                localStorage.setItem('h_sound_saved_password', password);
                console.log('💾 Kullanıcı bilgileri otomatik kaydedildi (Remember Me her zaman aktif)');
                
                console.log('✅ Giriş başarılı:', username);
                showNotification(`✅ Hoş geldiniz, ${username}! Otomatik giriş aktif 🎵`, 'success');
                
                // UI'ı hemen güncelle
                const loginScreen = document.getElementById('login-screen');
                const mainApp = document.getElementById('main-app');
                
                if (loginScreen) loginScreen.classList.add('hidden');
                if (mainApp) mainApp.classList.remove('hidden');
                
                setTimeout(() => {
                    initializeApp();
                    initializeUserRole();
                }, 500);
            } else {
                console.log('❌ Giriş başarısız');
                showNotification('Kullanıcı adı veya şifre hatalı!', 'error');
            }
        }

        // Firebase entegrasyonlu kayıt fonksiyonu
        function simpleRegister() {
            const email = document.getElementById('simple-register-email').value.trim();
            const username = document.getElementById('simple-register-username').value.trim();
            const password = document.getElementById('simple-register-password').value.trim();
            const confirm = document.getElementById('simple-register-confirm').value.trim();
            
            console.log('📝 Kayıt denemesi:', username, email);
            
            if (!email || !username || !password || !confirm) {
                showNotification('❌ Tüm alanları doldurun!', 'warning');
                return;
            }
            
            if (password !== confirm) {
                showNotification('❌ Şifreler eşleşmiyor!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('❌ Şifre en az 6 karakter olmalı!', 'warning');
                return;
            }
            
            // Email formatı kontrolü
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('❌ Geçerli bir email adresi girin!', 'error');
                return;
            }
            
            // Firebase ile kayıt dene
            if (typeof firebase !== 'undefined' && firebase.auth) {
                // Firebase ile email/şifre kaydı
                authSystem.registerWithEmail(email, password, username).then(() => {
                    // Firebase başarılı olursa localStorage'a da kaydet
                    const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
                    savedUsers[username] = {
                        email: email,
                        password: password,
                        role: 'Kullanıcı',
                        registerDate: new Date().toISOString(),
                        firebaseUser: true
                    };
                    localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                }).catch(() => {
                    // Firebase başarısız olursa sadece localStorage'a kaydet
                    registerToLocalStorage(email, username, password);
                });
            } else {
                // Firebase yoksa sadece localStorage'a kaydet
                registerToLocalStorage(email, username, password);
            }
        }
        
        // localStorage'a kayıt fonksiyonu
        function registerToLocalStorage(email, username, password) {
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            // Kullanıcı adı kontrolü
            if (savedUsers[username]) {
                showNotification('❌ Bu kullanıcı adı zaten alınmış!', 'error');
                return;
            }
            
            // Email kontrolü
            const existingUser = Object.values(savedUsers).find(user => user.email === email);
            if (existingUser) {
                showNotification('❌ Bu email adresi zaten kullanımda!', 'error');
                return;
            }
            
            // Yeni kullanıcıyı kaydet
            savedUsers[username] = {
                email: email,
                password: password,
                role: 'Kullanıcı',
                registerDate: new Date().toISOString()
            };
            
            localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
            console.log('✅ Kayıt başarılı:', username);
            
            showNotification('✅ Kayıt başarılı! Şimdi giriş yapabilirsiniz.', 'success');
            
            // Giriş ekranına geç ve bilgileri doldur
            setTimeout(() => {
                // Kayıt bölümünü gizle, giriş bölümünü göster
                document.getElementById('register-section').classList.add('hidden');
                document.getElementById('login-section').classList.remove('hidden');
                
                // Kayıt bilgilerini giriş formuna doldur
                const loginUsernameInput = document.getElementById('simple-login-username');
                const loginPasswordInput = document.getElementById('simple-login-password');
                
                if (loginUsernameInput) loginUsernameInput.value = username;
                if (loginPasswordInput) loginPasswordInput.value = password;
                
                console.log('🔄 Giriş ekranına yönlendirildi');
            }, 1500);
            
            // Remember Me bilgilerini kaydet (otomatik aktif)
            localStorage.setItem('h_sound_remember_me', 'true');
            localStorage.setItem('h_sound_saved_username', username);
            localStorage.setItem('h_sound_saved_password', password);
            
            console.log('💾 Yeni kullanıcı giriş bilgileri kaydedildi');
            
            // Formu temizle
            document.getElementById('simple-register-email').value = '';
            document.getElementById('simple-register-username').value = '';
            document.getElementById('simple-register-password').value = '';
            document.getElementById('simple-register-confirm').value = '';
        }

        // Şifre gösterme/gizleme
        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
                button.title = 'Şifreyi gizle';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
                button.title = 'Şifreyi göster';
            }
        }

        // Çıkış yap (Firebase entegrasyonlu)
        function logout() {
            if (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) {
                // Firebase çıkışı
                const username = firebase.auth().currentUser.displayName || firebase.auth().currentUser.email;
                
                if (confirm(`Çıkış yapmak istediğinizden emin misiniz?\n\nHesap: ${username}\n\nVerileriniz korunacak ve tekrar giriş yapabilirsiniz.`)) {
                    // Remember Me bilgilerini temizleme seçeneği
                    const rememberMe = localStorage.getItem('h_sound_remember_me') === 'true';
                    if (rememberMe) {
                        const clearRememberMe = confirm('🔐 Kayıtlı giriş bilgilerinizi de silmek istiyor musunuz?\n\n✅ EVET: Bir dahaki sefere şifre girmeniz gerekecek\n❌ HAYIR: Otomatik giriş devam edecek');
                        if (clearRememberMe) {
                            localStorage.removeItem('h_sound_remember_me');
                            localStorage.removeItem('h_sound_saved_username');
                            localStorage.removeItem('h_sound_saved_password');
                            console.log('🗑️ Remember Me bilgileri temizlendi');
                        }
                    }
                    
                    authSystem.logout();
                    
                    // Giriş durumunu temizle
                    localStorage.setItem('h_sound_logged_in', 'false');
                    document.documentElement.removeAttribute('data-logged-in');
                    
                    // UI'ı hemen güncelle - giriş sayfasına yönlendir
                    const loginScreen = document.getElementById('login-screen');
                    const mainApp = document.getElementById('main-app');
                    
                    if (loginScreen) loginScreen.classList.remove('hidden');
                    if (mainApp) mainApp.classList.add('hidden');
                    
                    showNotification('Güvenli çıkış yapıldı! Görüşmek üzere...', 'info');
                }
            } else {
                // Fallback: localStorage çıkışı
                const username = localStorage.getItem('h_sound_username') || 'Kullanıcı';
                
                if (confirm(`Çıkış yapmak istediğinizden emin misiniz?\n\nHesap: ${username}\n\nVerileriniz korunacak ve tekrar giriş yapabilirsiniz.`)) {
                    // Remember Me bilgilerini temizleme seçeneği
                    const rememberMe = localStorage.getItem('h_sound_remember_me') === 'true';
                    if (rememberMe) {
                        const clearRememberMe = confirm('🔐 Kayıtlı giriş bilgilerinizi de silmek istiyor musunuz?\n\n✅ EVET: Bir dahaki sefere şifre girmeniz gerekecek\n❌ HAYIR: Otomatik giriş devam edecek');
                        if (clearRememberMe) {
                            localStorage.removeItem('h_sound_remember_me');
                            localStorage.removeItem('h_sound_saved_username');
                            localStorage.removeItem('h_sound_saved_password');
                            console.log('🗑️ Remember Me bilgileri temizlendi');
                        }
                    }
                    
                    // Giriş durumunu temizle
                    localStorage.setItem('h_sound_logged_in', 'false');
                    document.documentElement.removeAttribute('data-logged-in');
                    
                    // UI'ı hemen güncelle - giriş sayfasına yönlendir
                    const loginScreen = document.getElementById('login-screen');
                    const mainApp = document.getElementById('main-app');
                    
                    if (loginScreen) loginScreen.classList.remove('hidden');
                    if (mainApp) mainApp.classList.add('hidden');
                    
                    // Kayıtlı bilgileri forma doldur (eğer remember me aktifse)
                    fillSavedCredentials();
                    
                    showNotification('Güvenli çıkış yapıldı! Görüşmek üzere...', 'info');
                }
            }
        }

        // Kullanıcı rolünü başlat
        function initializeUserRole() {
            if (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) {
                // Firebase kullanıcısı için admin kontrolü
                if (superAdmin) {
                    superAdmin.checkAdminStatus().then(() => {
                        superAdmin.updateAdminVisibility();
                    });
                }
            } else {
                // localStorage kullanıcısı için admin kontrolü
                const userRole = localStorage.getItem('h_sound_user_role');
                const currentUsername = localStorage.getItem('h_sound_username');
                const superadminLink = document.getElementById('superadmin-link');
                
                if (superadminLink) {
                    if (currentUsername === 'Hakan' || userRole === 'Süper Admin' || userRole === 'Super Admin') {
                        superadminLink.classList.remove('hidden');
                        superadminLink.style.display = 'block';
                        console.log('👑 Süper Admin linki gösterildi (localStorage)');
                    } else {
                        superadminLink.classList.add('hidden');
                    }
                }
            }
        }

        // Süper Admin Panel'i aç
        function openSuperAdminPanel() {
            if (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) {
                // Firebase kullanıcısı için
                if (superAdmin && superAdmin.isAdmin) {
                    superAdmin.loadAdminPanel();
                } else {
                    showNotification('Bu sayfaya erişim yetkiniz yok!', 'error');
                }
            } else {
                // localStorage kullanıcısı için
                const userRole = localStorage.getItem('h_sound_user_role');
                const currentUsername = localStorage.getItem('h_sound_username');
                if (currentUsername === 'Hakan' || userRole === 'Süper Admin' || userRole === 'Super Admin') {
                    // Basit admin panel göster
                    showSimpleAdminPanel();
                } else {
                    showNotification('Bu sayfaya erişim yetkiniz yok!', 'error');
                }
            }
        }

        // Gelişmiş admin panel (localStorage kullanıcıları için)
        function showSimpleAdminPanel() {
            const contentArea = document.getElementById('content-area');
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            const userCount = Object.keys(savedUsers).length;
            const activeUsers = Object.values(savedUsers).filter(user => !user.banned).length;
            const bannedUsers = Object.values(savedUsers).filter(user => user.banned).length;
            const premiumUsers = Object.values(savedUsers).filter(user => user.role === 'Premium').length;
            const vipUsers = Object.values(savedUsers).filter(user => user.role === 'VIP').length;
            
            contentArea.innerHTML = `
                <div class="admin-panel-container">
                    <div class="admin-header">
                        <h2><i class="fas fa-crown"></i> Süper Admin Panel</h2>
                        <p>Hoş geldin, ${localStorage.getItem('h_sound_username')}</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h4>👥 Toplam Kullanıcı</h4>
                            <p class="stat-number">${userCount}</p>
                        </div>
                        <div class="stat-card">
                            <h4>✅ Aktif Kullanıcı</h4>
                            <p class="stat-number">${activeUsers}</p>
                        </div>
                        <div class="stat-card">
                            <h4>🚫 Banlı Kullanıcı</h4>
                            <p class="stat-number">${bannedUsers}</p>
                        </div>
                        <div class="stat-card">
                            <h4>💎 Premium/VIP</h4>
                            <p class="stat-number">${premiumUsers + vipUsers}</p>
                        </div>
                    </div>
                    
                    <div class="admin-section active">
                        <h3>👥 Gelişmiş Kullanıcı Yönetimi</h3>
                        <div class="admin-actions">
                            <button class="btn btn-success" onclick="createNewUser()">
                                <i class="fas fa-user-plus"></i> Yeni Kullanıcı Oluştur
                            </button>
                            <button class="btn btn-info" onclick="exportUserData()">
                                <i class="fas fa-download"></i> Kullanıcı Verilerini İndir
                            </button>
                        </div>
                        <div class="users-container">
                            ${Object.entries(savedUsers).map(([username, userData]) => `
                                <div class="user-card ${userData.banned ? 'banned-user' : ''}" data-username="${username}">
                                    <div class="user-info">
                                        <div class="user-avatar ${getRoleColor(userData.role)}">
                                            ${username.charAt(0).toUpperCase()}
                                        </div>
                                        <div class="user-details">
                                            <h4>${username} ${userData.banned ? '🚫' : ''}</h4>
                                            <p><strong>Email:</strong> ${userData.email || 'Belirtilmemiş'}</p>
                                            <p><strong>Rol:</strong> <span class="role-badge role-${userData.role.toLowerCase()}">${userData.role}</span></p>
                                            <small><strong>Kayıt:</strong> ${new Date(userData.registerDate).toLocaleDateString('tr-TR')}</small>
                                            ${userData.lastLogin ? `<small><strong>Son Giriş:</strong> ${new Date(userData.lastLogin).toLocaleDateString('tr-TR')}</small>` : ''}
                                        </div>
                                    </div>
                                    <div class="user-actions">
                                        <button class="btn btn-sm btn-info" onclick="viewUserDetails('${username}')" title="Detayları Görüntüle">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        ${username !== 'Hakan' ? `<button class="btn btn-sm btn-warning" onclick="changeUserPassword('${username}')" title="Şifre Değiştir">
                                            <i class="fas fa-key"></i>
                                        </button>` : ''}
                                        ${username !== 'Hakan' ? `<button class="btn btn-sm btn-secondary" onclick="changeUserRole('${username}')" title="Rol Değiştir">
                                            <i class="fas fa-user-tag"></i>
                                        </button>` : ''}
                                        ${username !== 'Hakan' ? `<button class="btn btn-sm ${userData.banned ? 'btn-success' : 'btn-danger'}" onclick="toggleUserBan('${username}')" title="${userData.banned ? 'Ban Kaldır' : 'Ban At'}">
                                            <i class="fas fa-${userData.banned ? 'unlock' : 'ban'}"></i>
                                        </button>` : ''}
                                        ${username !== 'Hakan' ? `<button class="btn btn-sm btn-danger" onclick="deleteUser('${username}')" title="Hesabı Sil">
                                            <i class="fas fa-trash"></i>
                                        </button>` : ''}
                                        ${username === 'Hakan' ? `<span class="btn btn-sm" style="background: linear-gradient(135deg, #E74C3C, #C0392B); color: white; cursor: default;" title="Korumalı Hesap">
                                            <i class="fas fa-shield-alt"></i> KORUMALI
                                        </span>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <p style="color: var(--secondary-text-color); font-size: 14px;">
                            <i class="fas fa-shield-alt"></i> 
                            Gelişmiş Süper Admin Panel - Tüm kullanıcı yönetimi özellikleri aktif
                        </p>
                    </div>
                </div>
            `;
        }

        // Rol rengini belirle
        function getRoleColor(role) {
            switch(role) {
                case 'VIP': return 'role-vip';
                case 'Premium': return 'role-premium';
                default: return 'role-user';
            }
        }

        // Kullanıcı detaylarını görüntüle
        function viewUserDetails(username) {
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            const userData = savedUsers[username];
            
            if (!userData) {
                showNotification('Kullanıcı bulunamadı!', 'error');
                return;
            }
            
            // Hakan için şifre koruması
            const isHakan = username === 'Hakan';
            const passwordDisplay = isHakan ? '🔒 [KORUMALI]' : userData.password;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);">
                        <i class="fas fa-${isHakan ? 'crown' : 'user'}"></i> ${username} - Kullanıcı Detayları
                        ${isHakan ? '<span style="color: #E74C3C; font-size: 14px; margin-left: 10px;">👑 KORUMALI HESAP</span>' : ''}
                    </h3>
                    
                    <div class="user-detail-grid">
                        <div class="detail-item">
                            <strong>👤 Kullanıcı Adı:</strong>
                            <span>${username}</span>
                        </div>
                        <div class="detail-item">
                            <strong>📧 Email:</strong>
                            <span>${userData.email || 'Belirtilmemiş'}</span>
                        </div>
                        <div class="detail-item">
                            <strong>🔑 Şifre:</strong>
                            <span style="color: ${isHakan ? '#E74C3C' : 'inherit'}; font-weight: ${isHakan ? 'bold' : 'normal'};">${passwordDisplay}</span>
                        </div>
                        <div class="detail-item">
                            <strong>👑 Rol:</strong>
                            <span class="role-badge role-${userData.role.toLowerCase()}">${userData.role}</span>
                        </div>
                        <div class="detail-item">
                            <strong>📅 Kayıt Tarihi:</strong>
                            <span>${new Date(userData.registerDate).toLocaleString('tr-TR')}</span>
                        </div>
                        <div class="detail-item">
                            <strong>🕒 Son Giriş:</strong>
                            <span>${userData.lastLogin ? new Date(userData.lastLogin).toLocaleString('tr-TR') : 'Hiç giriş yapmamış'}</span>
                        </div>
                        <div class="detail-item">
                            <strong>🚫 Ban Durumu:</strong>
                            <span class="${userData.banned ? 'text-danger' : 'text-success'}">${userData.banned ? 'Banlı' : 'Aktif'}</span>
                        </div>
                        <div class="detail-item">
                            <strong>🔧 Oluşturan:</strong>
                            <span>${userData.createdBy || 'Kullanıcı'}</span>
                        </div>
                    </div>
                    
                    ${isHakan ? `
                    <div style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1)); 
                                border: 1px solid rgba(231, 76, 60, 0.3); 
                                border-radius: 8px; 
                                padding: 15px; 
                                margin: 15px 0; 
                                text-align: center;">
                        <i class="fas fa-shield-alt" style="color: #E74C3C; font-size: 20px; margin-bottom: 5px;"></i>
                        <p style="margin: 0; color: #E74C3C; font-weight: bold;">
                            Bu hesap korumalı! Şifre, rol ve ban işlemleri yapılamaz.
                        </p>
                    </div>
                    ` : ''}
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-check"></i> Tamam
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Kullanıcı şifresini değiştir
        function changeUserPassword(username) {
            // Hakan'ın şifresi değiştirilemez
            if (username === 'Hakan') {
                showNotification('🔒 Hakan kullanıcısının şifresi değiştirilemez! Bu hesap korumalıdır.', 'error');
                return;
            }
            
            const newPassword = prompt(`${username} kullanıcısının yeni şifresini girin:`);
            
            if (!newPassword) return;
            
            if (newPassword.length < 6) {
                showNotification('Şifre en az 6 karakter olmalıdır!', 'error');
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            if (savedUsers[username]) {
                savedUsers[username].password = newPassword;
                savedUsers[username].passwordChangedBy = localStorage.getItem('h_sound_username');
                savedUsers[username].passwordChangedAt = new Date().toISOString();
                
                localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                showNotification(`${username} kullanıcısının şifresi başarıyla değiştirildi!`, 'success');
                showSimpleAdminPanel(); // Paneli yenile
            }
        }

        // Kullanıcı rolünü değiştir
        function changeUserRole(username) {
            // Hakan'ın rolü değiştirilemez
            if (username === 'Hakan') {
                showNotification('Hakan kullanıcısının rolü değiştirilemez!', 'error');
                return;
            }
            
            const roles = ['Kullanıcı', 'Premium', 'VIP'];
            const currentRole = JSON.parse(localStorage.getItem('h_sound_users') || '{}')[username]?.role || 'Kullanıcı';
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);">
                        <i class="fas fa-user-tag"></i> ${username} - Rol Değiştir
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Mevcut Rol: <span class="role-badge role-${currentRole.toLowerCase()}">${currentRole}</span></label>
                        <select id="new-role-select" class="form-input">
                            ${roles.map(role => `
                                <option value="${role}" ${role === currentRole ? 'selected' : ''}>${role}</option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="updateUserRole('${username}')">
                            <i class="fas fa-check"></i> Rol Değiştir
                        </button>
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> İptal
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Kullanıcı rolünü güncelle
        function updateUserRole(username) {
            const newRole = document.getElementById('new-role-select').value;
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            if (savedUsers[username]) {
                const oldRole = savedUsers[username].role;
                savedUsers[username].role = newRole;
                savedUsers[username].roleChangedBy = localStorage.getItem('h_sound_username');
                savedUsers[username].roleChangedAt = new Date().toISOString();
                
                localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
                showNotification(`${username} kullanıcısının rolü ${oldRole} → ${newRole} olarak değiştirildi!`, 'success');
                
                document.querySelector('.modal').remove();
                showSimpleAdminPanel(); // Paneli yenile
            }
        }

        // Kullanıcıyı banla/ban kaldır
        function toggleUserBan(username) {
            // Hakan banlanamaz
            if (username === 'Hakan') {
                showNotification('🔒 Hakan kullanıcısı banlanamaz! Bu hesap korumalıdır.', 'error');
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            const userData = savedUsers[username];
            
            if (!userData) return;
            
            const action = userData.banned ? 'ban kaldırmak' : 'banlamak';
            
            if (!confirm(`${username} kullanıcısını ${action} istediğinizden emin misiniz?`)) {
                return;
            }
            
            userData.banned = !userData.banned;
            userData.banChangedBy = localStorage.getItem('h_sound_username');
            userData.banChangedAt = new Date().toISOString();
            
            if (userData.banned) {
                userData.banReason = prompt('Ban sebebi (opsiyonel):') || 'Sebep belirtilmedi';
            }
            
            localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
            showNotification(`${username} kullanıcısı ${userData.banned ? 'banlandı' : 'ban kaldırıldı'}!`, userData.banned ? 'warning' : 'success');
            showSimpleAdminPanel(); // Paneli yenile
        }

        // Kullanıcıyı sil
        function deleteUser(username) {
            if (username === 'Hakan') {
                showNotification('Hakan kullanıcısı silinemez!', 'error');
                return;
            }
            
            if (!confirm(`${username} kullanıcısını kalıcı olarak silmek istediğinizden emin misiniz?\n\nBu işlem geri alınamaz!`)) {
                return;
            }
            
            const confirmDelete = prompt(`Silme işlemini onaylamak için "${username}" yazın:`);
            if (confirmDelete !== username) {
                showNotification('Silme işlemi iptal edildi!', 'info');
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            delete savedUsers[username];
            localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
            
            showNotification(`${username} kullanıcısı kalıcı olarak silindi!`, 'success');
            showSimpleAdminPanel(); // Paneli yenile
        }

        // Yeni kullanıcı oluştur
        function createNewUser() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);">
                        <i class="fas fa-user-plus"></i> Yeni Kullanıcı Oluştur
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Kullanıcı Adı</label>
                        <input type="text" id="new-username" class="form-input" placeholder="Kullanıcı adını girin">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="new-email" class="form-input" placeholder="Email adresini girin">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Şifre</label>
                        <input type="password" id="new-password" class="form-input" placeholder="Şifre girin (en az 6 karakter)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Rol</label>
                        <select id="new-role" class="form-input">
                            <option value="Kullanıcı">Kullanıcı</option>
                            <option value="Premium">Premium</option>
                            <option value="VIP">VIP</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveNewUser()">
                            <i class="fas fa-save"></i> Kullanıcı Oluştur
                        </button>
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> İptal
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Yeni kullanıcıyı kaydet
        function saveNewUser() {
            const username = document.getElementById('new-username').value.trim();
            const email = document.getElementById('new-email').value.trim();
            const password = document.getElementById('new-password').value.trim();
            const role = document.getElementById('new-role').value;
            
            if (!username || !email || !password) {
                showNotification('Tüm alanları doldurun!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Şifre en az 6 karakter olmalıdır!', 'error');
                return;
            }
            
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            
            if (savedUsers[username]) {
                showNotification('Bu kullanıcı adı zaten alınmış!', 'error');
                return;
            }
            
            savedUsers[username] = {
                email: email,
                password: password,
                role: role,
                registerDate: new Date().toISOString(),
                createdBy: localStorage.getItem('h_sound_username'),
                banned: false
            };
            
            localStorage.setItem('h_sound_users', JSON.stringify(savedUsers));
            showNotification(`${username} kullanıcısı başarıyla oluşturuldu!`, 'success');
            
            document.querySelector('.modal').remove();
            showSimpleAdminPanel(); // Paneli yenile
        }

        // Kullanıcı verilerini dışa aktar
        function exportUserData() {
            const savedUsers = JSON.parse(localStorage.getItem('h_sound_users') || '{}');
            const dataStr = JSON.stringify(savedUsers, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `h-sound-users-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Kullanıcı verileri başarıyla indirildi!', 'success');
        }

        // Sidebar metinlerini güncelle
        function updateSidebarLanguage() {
            const homeLink = document.getElementById('home-link');
            const searchLink = document.getElementById('search-link');
            const playlistsLink = document.getElementById('playlists-link');
            const friendsLink = document.getElementById('friends-link');
            const downloadsLink = document.getElementById('downloads-link');
            const settingsLink = document.getElementById('settings-link');
            const searchBar = document.getElementById('search-bar');
            const searchBtn = document.getElementById('search-btn');
            
            if (homeLink) homeLink.innerHTML = `<i class="fas fa-home"></i> ${t('home')}`;
            if (searchLink) searchLink.innerHTML = `<i class="fas fa-search"></i> ${t('search')}`;
            if (playlistsLink) playlistsLink.innerHTML = `<i class="fas fa-compact-disc"></i> ${t('playlists')}`;
            if (friendsLink) friendsLink.innerHTML = `<i class="fas fa-users"></i> ${t('friends')}`;
            if (downloadsLink) downloadsLink.innerHTML = `<i class="fas fa-download"></i> ${t('downloads')}`;
            if (settingsLink) settingsLink.innerHTML = `<i class="fas fa-cog"></i> ${t('settings')}`;
            if (searchBar) searchBar.placeholder = t('searchPlaceholder');
            if (searchBtn) searchBtn.textContent = t('search');
        }

        // ORTAK ÇALMA LİSTESİ VE ORTAM MÜZİK ÖZELLİKLERİ
        
        // Ortak çalma listesi oluşturma modalı
        function showCollaborativePlaylistModal() {
            const currentUser = localStorage.getItem('h_sound_username');
            const friends = JSON.parse(localStorage.getItem(`h_sound_friends_${currentUser}`) || '[]');
            
            if (friends.length === 0) {
                showNotification('Ortak çalma listesi oluşturmak için arkadaşınız olmalı!', 'warning');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-users"></i> Ortak Çalma Listesi Oluştur</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Liste Adı</label>
                        <input type="text" id="collab-playlist-name" class="form-input" placeholder="Ortak listenin adını girin">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Arkadaşları Seç</label>
                        <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; padding: 10px;">
                            ${friends.map(friend => `
                                <label style="display: flex; align-items: center; padding: 8px; cursor: pointer; border-radius: 4px; transition: background 0.2s;" 
                                       onmouseover="this.style.background='rgba(52,152,219,0.1)'" 
                                       onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" value="${friend}" style="margin-right: 10px;">
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 10px;">
                                        ${friend.charAt(0).toUpperCase()}
                                    </div>
                                    ${friend}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    
                    <button onclick="createCollaborativePlaylist()" class="btn" style="width: 100%; margin-top: 15px;">
                        <i class="fas fa-plus"></i> Ortak Liste Oluştur
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Ortak çalma listesi oluştur
        function createCollaborativePlaylist() {
            const playlistName = document.getElementById('collab-playlist-name').value.trim();
            const selectedFriends = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
            const currentUser = localStorage.getItem('h_sound_username');
            
            if (!playlistName) {
                showNotification('Liste adı gerekli!', 'warning');
                return;
            }
            
            if (selectedFriends.length === 0) {
                showNotification('En az bir arkadaş seçmelisiniz!', 'warning');
                return;
            }
            
            const collaborativePlaylist = {
                id: Date.now().toString(),
                name: playlistName,
                creator: currentUser,
                collaborators: [currentUser, ...selectedFriends],
                songs: [],
                createdDate: Date.now(),
                lastModified: Date.now()
            };
            
            // Kendi ortak listelerine ekle
            const userCollabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            userCollabPlaylists.push(collaborativePlaylist);
            localStorage.setItem(`h_sound_collab_playlists_${currentUser}`, JSON.stringify(userCollabPlaylists));
            
            // Arkadaşların ortak listelerine de ekle (simülasyon)
            selectedFriends.forEach(friend => {
                const friendCollabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${friend}`) || '[]');
                friendCollabPlaylists.push(collaborativePlaylist);
                localStorage.setItem(`h_sound_collab_playlists_${friend}`, JSON.stringify(friendCollabPlaylists));
            });
            
            showNotification(`"${playlistName}" ortak çalma listesi oluşturuldu!`, 'success');
            document.querySelector('.modal').remove();
            showFriendsPage(); // Sayfayı yenile
        }
        
        // Ortak çalma listelerini göster
        function displayCollaborativePlaylists() {
            const currentUser = localStorage.getItem('h_sound_username');
            const collabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            const collabPlaylistsList = document.getElementById('collaborative-playlists-list');
            const collabPlaylistsCount = document.getElementById('collab-playlists-count');
            
            if (collabPlaylistsCount) collabPlaylistsCount.textContent = collabPlaylists.length;
            
            if (!collabPlaylistsList) return;
            
            if (collabPlaylists.length === 0) {
                collabPlaylistsList.innerHTML = `
                    <div class="no-content-message" style="text-align: center; padding: 20px; color: var(--secondary-text-color);">
                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Henüz ortak çalma listeniz yok.</p>
                        <p style="font-size: 14px;">Arkadaşlarınızla birlikte liste oluşturun!</p>
                    </div>
                `;
                return;
            }
            
            collabPlaylistsList.innerHTML = collabPlaylists.map(playlist => `
                <div class="friend-item" style="cursor: pointer;" onclick="openCollaborativePlaylist('${playlist.id}')">
                    <div class="friend-info">
                        <div class="friend-avatar" style="background: linear-gradient(135deg, #9B59B6, #8E44AD);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="friend-status">
                            <div class="friend-name">${playlist.name}</div>
                            <div class="friend-activity">
                                ${playlist.songs.length} şarkı • ${playlist.collaborators.length} kişi
                                ${playlist.creator === localStorage.getItem('h_sound_username') ? ' • Sizin listeniz' : ` • ${playlist.creator} tarafından oluşturuldu`}
                            </div>
                        </div>
                    </div>
                    <div class="friend-actions">
                        <button class="friend-btn chat-btn" onclick="event.stopPropagation(); openCollaborativePlaylist('${playlist.id}')">
                            <i class="fas fa-play"></i> Aç
                        </button>
                        ${playlist.creator === localStorage.getItem('h_sound_username') ? `
                            <button class="friend-btn remove-btn" onclick="event.stopPropagation(); deleteCollaborativePlaylist('${playlist.id}')">
                                <i class="fas fa-trash"></i> Sil
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Ortak müzik davetiyelerini göster
        function displayPartyInvitations() {
            const currentUser = localStorage.getItem('h_sound_username');
            const invitations = JSON.parse(localStorage.getItem(`h_sound_party_invitations_${currentUser}`) || '[]');
            const invitationsList = document.getElementById('party-invitations-list');
            const invitationsCount = document.getElementById('party-invitations-count');
            
            // Süresi dolmuş davetiyeler temizle
            const validInvitations = invitations.filter(inv => Date.now() <= inv.expiresAt);
            if (validInvitations.length !== invitations.length) {
                localStorage.setItem(`h_sound_party_invitations_${currentUser}`, JSON.stringify(validInvitations));
            }
            
            if (invitationsCount) invitationsCount.textContent = validInvitations.length;
            
            if (!invitationsList) return;
            
            if (validInvitations.length === 0) {
                invitationsList.innerHTML = `
                    <div class="no-content-message" style="text-align: center; padding: 20px; color: var(--secondary-text-color);">
                        <i class="fas fa-music" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Ortak müzik davetiyeniz yok.</p>
                        <p style="font-size: 14px;">Arkadaşlarınız sizi ortak müzik oturumuna davet ettiğinde burada görünecek.</p>
                    </div>
                `;
                return;
            }
            
            invitationsList.innerHTML = validInvitations.map(invitation => {
                const timeLeft = Math.max(0, invitation.expiresAt - Date.now());
                const minutesLeft = Math.floor(timeLeft / (1000 * 60));
                const secondsLeft = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                return `
                    <div class="friend-item" style="border-left: 4px solid #9B59B6;">
                        <div class="friend-info">
                            <div class="friend-avatar" style="background: linear-gradient(135deg, #9B59B6, #8E44AD);">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="friend-status">
                                <div class="friend-name">${invitation.sessionName}</div>
                                <div class="friend-activity">
                                    ${invitation.host} sizi ortak müzik oturumuna davet etti
                                    <br><small style="color: #F39C12;">⏰ ${minutesLeft}:${secondsLeft.toString().padStart(2, '0')} kaldı</small>
                                </div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-btn chat-btn" onclick="acceptPartyInvitation('${invitation.id}')">
                                <i class="fas fa-check"></i> Kabul Et
                            </button>
                            <button class="friend-btn remove-btn" onclick="rejectPartyInvitation('${invitation.id}')">
                                <i class="fas fa-times"></i> Reddet
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Ortak müzik modalı
        function showPartyModeModal() {
            const currentUser = localStorage.getItem('h_sound_username');
            const friends = JSON.parse(localStorage.getItem(`h_sound_friends_${currentUser}`) || '[]');
            
            if (friends.length === 0) {
                showNotification('Ortak müzik için arkadaşınız olmalı!', 'warning');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: #9B59B6;"><i class="fas fa-music"></i> Ortak Müzik Oturumu</h3>
                    
                    <div style="background: linear-gradient(135deg, rgba(155, 89, 182, 0.1) 0%, rgba(142, 68, 173, 0.1) 100%); padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #9B59B6;">
                        <h4 style="margin: 0 0 10px 0; color: var(--text-color);">🎵 Ortak Müzik Nedir?</h4>
                        <p style="margin: 0; color: var(--secondary-text-color); font-size: 14px;">
                            Arkadaşlarınızla aynı anda aynı şarkıları dinleyin! Host şarkı değiştirdiğinde herkesin şarkısı otomatik değişir.
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Oturum Adı</label>
                        <input type="text" id="party-session-name" class="form-input" placeholder="Ortak müzik oturum adını girin">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Arkadaşları Davet Et</label>
                        <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; padding: 10px;">
                            ${friends.map(friend => `
                                <label style="display: flex; align-items: center; padding: 8px; cursor: pointer; border-radius: 4px; transition: background 0.2s;" 
                                       onmouseover="this.style.background='rgba(155,89,182,0.1)'" 
                                       onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" value="${friend}" style="margin-right: 10px;">
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #9B59B6, #8E44AD); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 10px;">
                                        ${friend.charAt(0).toUpperCase()}
                                    </div>
                                    ${friend}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    
                    <button onclick="createPartyMode()" class="btn" style="width: 100%; margin-top: 15px; background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);">
                        <i class="fas fa-play"></i> Ortak Müzik Başlat
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Ortak müzik oturumu oluştur
        function createPartyMode() {
            const sessionName = document.getElementById('party-session-name').value.trim();
            const selectedFriends = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
            const currentUser = localStorage.getItem('h_sound_username');
            
            if (!sessionName) {
                showNotification('Oturum adı gerekli!', 'warning');
                return;
            }
            
            if (selectedFriends.length === 0) {
                showNotification('En az bir arkadaş davet etmelisiniz!', 'warning');
                return;
            }
            
            // Ortak müzik davetiyesi gönder (izin sistemi)
            sendPartyInvitations(sessionName, selectedFriends);
            
            document.querySelector('.modal').remove();
            showNotification('Ortak müzik davetiyesi gönderildi! Arkadaşlarınızın onayı bekleniyor...', 'info');
            showFriendsPage(); // Sayfayı yenile
        }

        // Ortak müzik davetiyesi gönder
        function sendPartyInvitations(sessionName, selectedFriends) {
            const currentUser = localStorage.getItem('h_sound_username');
            const invitationId = Date.now().toString();
            
            const invitation = {
                id: invitationId,
                sessionName: sessionName,
                host: currentUser,
                invitedFriends: selectedFriends,
                acceptedFriends: [],
                rejectedFriends: [],
                status: 'pending', // pending, accepted, rejected, expired
                createdDate: Date.now(),
                expiresAt: Date.now() + (5 * 60 * 1000) // 5 dakika sonra süresi doluyor
            };
            
            // Host için davetiye kaydı
            localStorage.setItem(`h_sound_party_invitation_${currentUser}`, JSON.stringify(invitation));
            
            // Her arkadaş için davetiye gönder
            selectedFriends.forEach(friend => {
                const friendInvitation = {
                    id: invitationId,
                    sessionName: sessionName,
                    host: currentUser,
                    invitedBy: currentUser,
                    status: 'pending',
                    createdDate: Date.now(),
                    expiresAt: Date.now() + (5 * 60 * 1000)
                };
                
                // Arkadaşın gelen davetiyeler listesine ekle
                let friendInvitations = JSON.parse(localStorage.getItem(`h_sound_party_invitations_${friend}`) || '[]');
                friendInvitations.push(friendInvitation);
                localStorage.setItem(`h_sound_party_invitations_${friend}`, JSON.stringify(friendInvitations));
            });
            
            console.log(`📨 Party invitation sent to: ${selectedFriends.join(', ')}`);
        }

        // Ortak müzik davetiyesini kabul et
        function acceptPartyInvitation(invitationId) {
            const currentUser = localStorage.getItem('h_sound_username');
            let invitations = JSON.parse(localStorage.getItem(`h_sound_party_invitations_${currentUser}`) || '[]');
            
            const invitationIndex = invitations.findIndex(inv => inv.id === invitationId);
            if (invitationIndex === -1) {
                showNotification('Davetiye bulunamadı!', 'error');
                return;
            }
            
            const invitation = invitations[invitationIndex];
            const host = invitation.host;
            
            // Süresi dolmuş mu kontrol et
            if (Date.now() > invitation.expiresAt) {
                showNotification('Davetiye süresi dolmuş!', 'warning');
                invitations.splice(invitationIndex, 1);
                localStorage.setItem(`h_sound_party_invitations_${currentUser}`, JSON.stringify(invitations));
                showFriendsPage();
                return;
            }
            
            // Host'un davetiye kaydını güncelle
            let hostInvitation = JSON.parse(localStorage.getItem(`h_sound_party_invitation_${host}`) || 'null');
            if (hostInvitation && hostInvitation.id === invitationId) {
                hostInvitation.acceptedFriends.push(currentUser);
                localStorage.setItem(`h_sound_party_invitation_${host}`, JSON.stringify(hostInvitation));
                
                // Tüm arkadaşlar kabul ettiyse oturumu başlat
                if (hostInvitation.acceptedFriends.length === hostInvitation.invitedFriends.length) {
                    startPartySession(hostInvitation);
                }
            }
            
            // Kendi davetiye listesinden kaldır
            invitations.splice(invitationIndex, 1);
            localStorage.setItem(`h_sound_party_invitations_${currentUser}`, JSON.stringify(invitations));
            
            showNotification(`"${invitation.sessionName}" ortak müzik davetiyesi kabul edildi!`, 'success');
            showFriendsPage();
        }

        // Ortak müzik davetiyesini reddet
        function rejectPartyInvitation(invitationId) {
            const currentUser = localStorage.getItem('h_sound_username');
            let invitations = JSON.parse(localStorage.getItem(`h_sound_party_invitations_${currentUser}`) || '[]');
            
            const invitationIndex = invitations.findIndex(inv => inv.id === invitationId);
            if (invitationIndex === -1) {
                showNotification('Davetiye bulunamadı!', 'error');
                return;
            }
            
            const invitation = invitations[invitationIndex];
            const host = invitation.host;
            
            // Host'un davetiye kaydını güncelle
            let hostInvitation = JSON.parse(localStorage.getItem(`h_sound_party_invitation_${host}`) || 'null');
            if (hostInvitation && hostInvitation.id === invitationId) {
                hostInvitation.rejectedFriends.push(currentUser);
                localStorage.setItem(`h_sound_party_invitation_${host}`, JSON.stringify(hostInvitation));
            }
            
            // Kendi davetiye listesinden kaldır
            invitations.splice(invitationIndex, 1);
            localStorage.setItem(`h_sound_party_invitations_${currentUser}`, JSON.stringify(invitations));
            
            showNotification(`"${invitation.sessionName}" ortak müzik davetiyesi reddedildi`, 'info');
            showFriendsPage();
        }

        // Ortak müzik oturumunu başlat (tüm onaylar alındıktan sonra)
        function startPartySession(invitation) {
            const partySession = {
                id: invitation.id,
                name: invitation.sessionName,
                host: invitation.host,
                participants: [invitation.host, ...invitation.acceptedFriends],
                currentSong: null,
                currentTime: 0,
                isPlaying: false,
                createdDate: Date.now(),
                playlist: []
            };
            
            // Host ve tüm katılımcılar için oturum kaydet
            partySession.participants.forEach(participant => {
                localStorage.setItem(`h_sound_active_party_${participant}`, JSON.stringify(partySession));
            });
            
            // Host'un davetiye kaydını temizle
            localStorage.removeItem(`h_sound_party_invitation_${invitation.host}`);
            
            console.log(`🎉 Party session started: ${invitation.sessionName}`);
            console.log(`👥 Participants: ${partySession.participants.join(', ')}`);
        }
        
        // Aktif ortak müzik oturumunu kontrol et
        function checkActivePartyMode() {
            const currentUser = localStorage.getItem('h_sound_username');
            const activeParty = JSON.parse(localStorage.getItem(`h_sound_active_party_${currentUser}`) || 'null');
            const activePartySection = document.getElementById('active-party-section');
            
            if (!activePartySection) return;
            
            if (activeParty) {
                activePartySection.classList.remove('hidden');
                document.getElementById('party-host').textContent = `Host: ${activeParty.host}`;
                document.getElementById('party-participants').textContent = `Katılımcılar: ${activeParty.participants.join(', ')}`;
            } else {
                activePartySection.classList.add('hidden');
            }
        }
        
        // Ortak müzik oturumundan ayrıl
        function leavePartyMode() {
            const currentUser = localStorage.getItem('h_sound_username');
            localStorage.removeItem(`h_sound_active_party_${currentUser}`);
            showNotification('Ortak müzik oturumundan ayrıldınız', 'info');
            showFriendsPage(); // Sayfayı yenile
        }
        
        // Ortak çalma listesini aç
        function openCollaborativePlaylist(playlistId) {
            const currentUser = localStorage.getItem('h_sound_username');
            const collabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            const playlist = collabPlaylists.find(p => p.id === playlistId);
            
            if (!playlist) {
                showNotification('Çalma listesi bulunamadı!', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px; max-height: 85vh; overflow-y: auto;">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: #9B59B6;"><i class="fas fa-users"></i> ${playlist.name}</h3>
                    
                    <div style="background: rgba(155, 89, 182, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #9B59B6;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div>
                                <strong>Oluşturan:</strong> ${playlist.creator}<br>
                                <strong>Katılımcılar:</strong> ${playlist.collaborators.join(', ')}<br>
                                <strong>Şarkı Sayısı:</strong> ${playlist.songs.length}
                            </div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="showCollaborativeMusicSearch('${playlistId}')" class="btn" style="background: #27AE60;">
                                    <i class="fas fa-search"></i> Müzik Ara
                                </button>
                                <button onclick="playAllCollaborativePlaylist('${playlistId}')" class="btn" style="background: #9B59B6;">
                                    <i class="fas fa-play"></i> Tümünü Çal
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="collab-playlist-songs">
                        ${playlist.songs.length === 0 ? `
                            <div style="text-align: center; padding: 40px; color: var(--secondary-text-color);">
                                <i class="fas fa-music" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                <p>Bu ortak listede henüz şarkı yok.</p>
                                <p style="font-size: 14px;">Aşağıdaki "Müzik Ara" butonunu kullanarak şarkı ekleyin!</p>
                            </div>
                        ` : playlist.songs.map((song, index) => `
                            <div class="friend-item" style="margin: 10px 0;">
                                <div class="friend-info">
                                    <img src="${song.thumbnail}" alt="${song.title}" style="width: 50px; height: 50px; border-radius: 4px; object-fit: cover; margin-right: 15px;">
                                    <div class="friend-status">
                                        <div class="friend-name">${song.title}</div>
                                        <div class="friend-activity">${song.artist} • Ekleyen: ${song.addedBy || 'Bilinmeyen'}</div>
                                    </div>
                                </div>
                                <div class="friend-actions">
                                    <button class="friend-btn chat-btn" onclick="playSong('${song.videoId}', '${song.title.replace(/'/g, "\\'")}', '${song.thumbnail}', '${song.artist.replace(/'/g, "\\'")}')">
                                        <i class="fas fa-play"></i> Çal
                                    </button>
                                    ${playlist.creator === currentUser || song.addedBy === currentUser ? `
                                        <button class="friend-btn remove-btn" onclick="removeFromCollaborativePlaylist('${playlistId}', ${index})">
                                            <i class="fas fa-trash"></i> Kaldır
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Ortak çalma listesi için müzik arama modalı
        function showCollaborativeMusicSearch(playlistId) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: #27AE60;"><i class="fas fa-search"></i> Ortak Listeye Müzik Ara ve Ekle</h3>
                    
                    <div class="search-container" style="margin-bottom: 20px;">
                        <input type="text" id="collab-search-input" placeholder="Şarkı, sanatçı veya albüm ara..." 
                               style="flex: 1; padding: 12px; border: 2px solid #27AE60; border-radius: 8px; background-color: #2C2C2C; color: white; font-size: 16px;">
                        <button onclick="searchMusicForCollaborativePlaylist('${playlistId}')" class="btn" style="background: #27AE60; margin-left: 10px;">
                            <i class="fas fa-search"></i> Ara
                        </button>
                    </div>
                    
                    <div id="collab-search-results" style="min-height: 200px;">
                        <div style="text-align: center; padding: 40px; color: var(--secondary-text-color);">
                            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>Yukarıdaki arama kutusunu kullanarak müzik arayın</p>
                            <p style="font-size: 14px;">Sonuçlar YouTube API'den gelecek</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="this.parentElement.parentElement.remove(); openCollaborativePlaylist('${playlistId}')" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Ortak Listeye Dön
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Enter tuşu ile arama
            document.getElementById('collab-search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchMusicForCollaborativePlaylist(playlistId);
                }
            });
            
            // Input'a focus ver
            setTimeout(() => {
                document.getElementById('collab-search-input').focus();
            }, 100);
        }

        // Ortak çalma listesi için müzik ara
        async function searchMusicForCollaborativePlaylist(playlistId) {
            const searchInput = document.getElementById('collab-search-input');
            const resultsDiv = document.getElementById('collab-search-results');
            const query = searchInput.value.trim();
            
            if (!query) {
                showNotification('Lütfen arama terimi girin!', 'warning');
                return;
            }
            
            // Loading göster
            resultsDiv.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 20px;">YouTube'da "${query}" aranıyor...</p>
                </div>
            `;
            
            try {
                console.log(`🔍 Searching for collaborative playlist: ${query}`);
                const results = await searchYouTubeMusic(query, 20);
                
                if (results && results.length > 0) {
                    let html = `
                        <div style="margin-bottom: 15px; padding: 10px; background: rgba(39, 174, 96, 0.1); border-radius: 8px; border-left: 4px solid #27AE60;">
                            <strong>${results.length} sonuç bulundu</strong> - Eklemek istediğiniz şarkının yanındaki "+" butonuna tıklayın
                        </div>
                        <div class="results-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                    `;
                    
                    results.forEach(song => {
                        const safeTitle = song.title.replace(/'/g, "\\'").replace(/"/g, '\\"');
                        const safeArtist = song.artist.replace(/'/g, "\\'").replace(/"/g, '\\"');
                        
                        html += `
                            <div class="result-item" style="position: relative; background: #2C2C2C; border-radius: 8px; overflow: hidden; transition: transform 0.2s;">
                                <img src="${song.thumbnail}" alt="${song.title}" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="padding: 10px;">
                                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${song.title}</div>
                                    <div style="font-size: 12px; color: var(--secondary-text-color); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${song.artist}</div>
                                </div>
                                <button onclick="addSongToCollaborativePlaylistFromSearch('${playlistId}', '${song.videoId}', '${safeTitle}', '${song.thumbnail}', '${safeArtist}')" 
                                        class="btn" style="position: absolute; top: 10px; right: 10px; background: #27AE60; padding: 8px 12px; font-size: 12px;">
                                    <i class="fas fa-plus"></i> Ekle
                                </button>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    resultsDiv.innerHTML = html;
                    
                } else {
                    resultsDiv.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--secondary-text-color);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>"${query}" için sonuç bulunamadı</p>
                            <p style="font-size: 14px;">Farklı anahtar kelimeler deneyin</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('❌ Collaborative playlist search error:', error);
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #E74C3C;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>Arama sırasında hata oluştu</p>
                        <p style="font-size: 14px;">${error.message}</p>
                    </div>
                `;
            }
        }

        // Arama sonucundan ortak çalma listesine şarkı ekle
        function addSongToCollaborativePlaylistFromSearch(playlistId, videoId, title, thumbnail, artist) {
            console.log('🎵 Adding song from search to collaborative playlist:', { playlistId, videoId, title, artist });
            
            // Şarkıyı ortak listeye ekle
            addSongToCollaborativePlaylist(playlistId, videoId, title, thumbnail, artist);
            
            // Başarı mesajı
            showNotification(`"${title}" ortak listeye eklendi!`, 'success');
            
            // Arama modalını kapat ve ortak liste modalını aç
            setTimeout(() => {
                const modal = document.querySelector('.modal');
                if (modal) modal.remove();
                openCollaborativePlaylist(playlistId);
            }, 1000);
        }
        
        // Ortak çalma listesinin tüm şarkılarını çal
        function playAllCollaborativePlaylist(playlistId) {
            const currentUser = localStorage.getItem('h_sound_username');
            const collabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            const playlist = collabPlaylists.find(p => p.id === playlistId);
            
            if (!playlist || playlist.songs.length === 0) {
                showNotification('Bu listede çalınacak şarkı yok!', 'warning');
                return;
            }
            
            // Global playlist'i güncelle ve ilk şarkıyı çal
            window.playlist = [...playlist.songs];
            window.currentSongIndex = 0;
            
            const firstSong = playlist.songs[0];
            playSong(firstSong.videoId, firstSong.title, firstSong.thumbnail, firstSong.artist);
            
            showNotification(`"${playlist.name}" listesi çalınıyor (${playlist.songs.length} şarkı)`, 'success');
            
            // Modal'ı kapat
            const modal = document.querySelector('.modal');
            if (modal) modal.remove();
        }

        // Ortak çalma listesinden şarkı kaldır
        function removeFromCollaborativePlaylist(playlistId, songIndex) {
            if (!confirm('Bu şarkıyı ortak listeden kaldırmak istediğinizden emin misiniz?')) return;
            
            const currentUser = localStorage.getItem('h_sound_username');
            let collabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            
            const playlistIndex = collabPlaylists.findIndex(p => p.id === playlistId);
            if (playlistIndex === -1) return;
            
            const playlist = collabPlaylists[playlistIndex];
            const removedSong = playlist.songs[songIndex];
            playlist.songs.splice(songIndex, 1);
            
            // Kendi listesini güncelle
            localStorage.setItem(`h_sound_collab_playlists_${currentUser}`, JSON.stringify(collabPlaylists));
            
            // Arkadaşların listelerini de güncelle
            playlist.collaborators.forEach(collaborator => {
                if (collaborator !== currentUser) {
                    let friendCollabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${collaborator}`) || '[]');
                    const friendPlaylistIndex = friendCollabPlaylists.findIndex(p => p.id === playlistId);
                    if (friendPlaylistIndex !== -1) {
                        friendCollabPlaylists[friendPlaylistIndex].songs.splice(songIndex, 1);
                        localStorage.setItem(`h_sound_collab_playlists_${collaborator}`, JSON.stringify(friendCollabPlaylists));
                    }
                }
            });
            
            showNotification(`"${removedSong.title}" ortak listeden kaldırıldı`, 'info');
            openCollaborativePlaylist(playlistId); // Modal'ı yenile
        }

        // Ortak çalma listesine şarkı ekle
        function addToCollaborativePlaylist(videoId, title, thumbnail, artist) {
            console.log('🎵 Adding to collaborative playlist:', title);
            
            const currentUser = localStorage.getItem('h_sound_username');
            if (!currentUser) {
                showNotification('Ortak liste kullanmak için giriş yapın!', 'warning');
                return;
            }
            
            const collabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            console.log('Collaborative playlists:', collabPlaylists);
            
            if (collabPlaylists.length === 0) {
                showNotification('Önce bir ortak çalma listesi oluşturun!', 'warning');
                return;
            }
            
            // Ortak liste seçim modalı göster
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close-btn" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-users"></i> Ortak Listeye Ekle</h3>
                    <p><strong>${title}</strong> - ${artist}</p>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${collabPlaylists.map((playlist, index) => `
                            <button class="btn" onclick="addSongToCollaborativePlaylist('${playlist.id}', '${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}', '${artist.replace(/'/g, "\\'")}'); this.parentElement.parentElement.parentElement.remove();" 
                                    style="width: 100%; margin: 5px 0; text-align: left;">
                                <i class="fas fa-users"></i> ${playlist.name} (${playlist.songs.length} şarkı)
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            console.log('✅ Collaborative playlist selection modal shown');
        }

        // Şarkıyı ortak çalma listesine ekle
        function addSongToCollaborativePlaylist(playlistId, videoId, title, thumbnail, artist) {
            console.log('🎵 Adding song to collaborative playlist:', { playlistId, videoId, title, artist });
            
            const currentUser = localStorage.getItem('h_sound_username');
            let collabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            
            const playlistIndex = collabPlaylists.findIndex(p => p.id === playlistId);
            if (playlistIndex === -1) {
                console.error('❌ Collaborative playlist not found:', playlistId);
                showNotification('Ortak çalma listesi bulunamadı!', 'error');
                return;
            }
            
            const playlist = collabPlaylists[playlistIndex];
            const song = { videoId, title, thumbnail, artist, addedBy: currentUser, addedDate: Date.now() };
            
            // Duplikasyon kontrolü
            if (playlist.songs.some(s => s.videoId === videoId)) {
                console.log('⚠️ Song already exists in collaborative playlist');
                showNotification('Bu şarkı zaten ortak listede!', 'warning');
                return;
            }
            
            // Şarkıyı ekle
            playlist.songs.push(song);
            localStorage.setItem(`h_sound_collab_playlists_${currentUser}`, JSON.stringify(collabPlaylists));
            
            // Arkadaşların listelerini de güncelle
            playlist.collaborators.forEach(collaborator => {
                if (collaborator !== currentUser) {
                    let friendCollabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${collaborator}`) || '[]');
                    const friendPlaylistIndex = friendCollabPlaylists.findIndex(p => p.id === playlistId);
                    if (friendPlaylistIndex !== -1) {
                        friendCollabPlaylists[friendPlaylistIndex].songs.push(song);
                        localStorage.setItem(`h_sound_collab_playlists_${collaborator}`, JSON.stringify(friendCollabPlaylists));
                    }
                }
            });
            
            console.log('✅ Song added to collaborative playlist successfully');
            showNotification(`"${title}" şarkısı "${playlist.name}" ortak listesine eklendi!`, 'success');
        }

        // Ortak çalma listesini sil
        function deleteCollaborativePlaylist(playlistId) {
            if (!confirm('Bu ortak çalma listesini silmek istediğinizden emin misiniz?')) return;
            
            const currentUser = localStorage.getItem('h_sound_username');
            const collabPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${currentUser}`) || '[]');
            const playlist = collabPlaylists.find(p => p.id === playlistId);
            
            if (!playlist) return;
            
            // Kendi listesinden kaldır
            const updatedPlaylists = collabPlaylists.filter(p => p.id !== playlistId);
            localStorage.setItem(`h_sound_collab_playlists_${currentUser}`, JSON.stringify(updatedPlaylists));
            
            // Arkadaşların listesinden de kaldır (simülasyon)
            playlist.collaborators.forEach(collaborator => {
                if (collaborator !== currentUser) {
                    const friendPlaylists = JSON.parse(localStorage.getItem(`h_sound_collab_playlists_${collaborator}`) || '[]');
                    const updatedFriendPlaylists = friendPlaylists.filter(p => p.id !== playlistId);
                    localStorage.setItem(`h_sound_collab_playlists_${collaborator}`, JSON.stringify(updatedFriendPlaylists));
                }
            });
            
            showNotification('Ortak çalma listesi silindi', 'info');
            showFriendsPage(); // Sayfayı yenile
        }

        // Uygulamayı başlat
        function initializeApp() {
            initializeUserRole();
            setupGlobalThumbnailErrorHandling();
            
            // Sidebar dilini güncelle
            updateSidebarLanguage();
            
            // Ses politikası için kullanıcı etkileşimi hazırla
            setupAudioContext();
            
            // YouTube IFrame API'yi yükle (sadece HTTP/HTTPS protokolünde)
            if (window.location.protocol !== 'file:') {
                loadYouTubeIFrameAPI();
            } else {
                console.log('ℹ️ File protocol detected - YouTube IFrame API disabled, using simple iframe fallback');
            }
            
            showHomePage();
            loadLocalData();
            setupInfiniteScroll();
            console.log('🎉 H-Sound ready!');
        }
        
        // Ses politikası için kullanıcı etkileşimi hazırla
        function setupAudioContext() {
            let audioContextInitialized = false;
            
            function initializeAudioOnInteraction() {
                if (!audioContextInitialized) {
                    console.log('🔊 Initializing audio context on user interaction');
                    
                    // Ses test et
                    if (youtubePlayer && youtubePlayerReady) {
                        try {
                            youtubePlayer.unMute();
                            youtubePlayer.setVolume(100);
                            console.log('🔊 Audio context initialized - YouTube player unmuted');
                        } catch (error) {
                            console.log('⚠️ Could not initialize audio:', error);
                        }
                    }
                    
                    audioContextInitialized = true;
                    
                    // Event listener'ları kaldır
                    document.removeEventListener('click', initializeAudioOnInteraction);
                    document.removeEventListener('touchstart', initializeAudioOnInteraction);
                    document.removeEventListener('keydown', initializeAudioOnInteraction);
                }
            }
            
            // İlk kullanıcı etkileşiminde ses bağlamını başlat
            document.addEventListener('click', initializeAudioOnInteraction);
            document.addEventListener('touchstart', initializeAudioOnInteraction);
            document.addEventListener('keydown', initializeAudioOnInteraction);
            
            console.log('🎧 Audio context setup complete - waiting for user interaction');
        }

        // Global functions for Background Music Manager
        window.nextSong = function() {
            console.log('🎵 Next song called from background music manager');
            playNextSong();
        };

        window.previousSong = function() {
            console.log('🎵 Previous song called from background music manager');
            playPreviousSong();
        };

        window.updatePlayPauseButton = function() {
            console.log('🎵 Update play/pause button called from background music manager');
            const playPauseBtn = document.getElementById('play-pause-btn');
            if (playPauseBtn) {
                if (isPlaying) {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                }
            }
        };
    </script>
    
    <!-- Background Music Manager for APK -->
    <script src="background-music.js"></script>
</body>
</html>

